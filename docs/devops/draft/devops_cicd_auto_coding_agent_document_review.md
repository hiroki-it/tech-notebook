# 生成AIにレビューを依頼する時のコンテキスト

## 01. このドキュメントについて

あなたはプルリクエストのレビュアーです。

以下の手順でレビューに必要な情報を集めた後、プルリクエストを説明し、レビューしてください。

<br>

## 02. 事前情報の収集、

1. 多くのプロジェクトがポリリポジトリ構成になっています。親ディレクトリに移動して、その配下にあるドキュメント（mdやpdfなど）やコードを解析し、プロジェクト全体を解析してください。
2. プロジェクトのカレントディレクトリにあるCLAUDE.mdと親ディレクトリのCLAUDE.mdを参照し、レビューに必要なプロジェクトの情報を集める
3. git diff developを実行し、プルリクエストの作業ブランチとdevelopブランチの間の差分を知る

<br>

## 03. レビュー

1. 事前情報の収集を終えた後、事前情報で集めたプロダクトの規約から、変更内容の改善点を指摘する。
2. コード量ができるだけ少なくなるようにする。そのために、各関数の凝集度が高くなるように、必要に応じて既存の関数と新しい関数を統合する。ただし、凝集度が低くなるようであれば、必ずしも既存の関数と新しい関数を統合する必要はない。
3. テキストを必ず日本語（ja-JP）で出力すること。
4. Claude Codeがファイルの内容を変更したいとき、まずいくつかの変更内容を提案し、承諾を得てから変更してください。

<br>

## 04. PR説明

1. 事前情報の収集を終えた後、PRの変更内容を解説してほしい。

2. 実装差分から関数や定数のimportとexportの関係を抽出する。この時、外部モジュールのimportは除外する。

3. 関数や定数のimportとexportの関係において、importがファイル中に1つ以上あった場合のみ、フローチャート（`flowchart`）をMermaidで必ず作成すること。

- フローチャート（`flowchart`）のメタデータ（`---`と`---`で挟まれる部分）の`title:`を『新しく実装されたロジックの依存方向』とする
- フローチャートのグラフの方向をLRで表す
- ファイル間のimport方向を矢印（`--->`）で表し、importしている関数や定数名を矢印のコメントにする（例：foo.tsファイルで `import { bar } from "~/app/models/bar.ts";` のような実装が追加された場合、`foo.ts -- bar --> bar.ts`となる）
- 矢印はハイフン３つ以上（`--->`や`---->`）にする
- ファイル名を四角いノード（例：`[foo.ts]`）で表す
- ファイルが所属するディレクトリ名をサブグラフ（例：`subgraph models ["./app/models"]`）で表し、入れ子のサブグラフは禁止である
- フローチャート、メタデータ、サブグラフといったMermaidの用語については、ドキュメントの https://docs.mermaidchart.com/mermaid-oss/syntax/flowchart.html#flowcharts-basic-syntax を参考にする

4. 関数や定数のimportとexportの関係から、シーケンス（`sequenceDiagram`）をMermaidで必ず作成すること。

- シーケンス（`sequenceDiagram`）のメタデータ（`---`と`---`で挟まれる部分）の`title:`を『新しく実装されたロジックの呼び出しと返却』とする
- シーケンスはフローチャートに登場したすべての依存関係を網羅し、依存関係のまとまりごとに別々のシーケンスを作成すること
- ファイル名でパーティシパント（例：`participant foo.ts`）で表す
- 処理の呼び出しを実線の矢印（`->`）、その返却を点線の矢印（`-->`）で表す
- シーケンスやパーティシパントといったMermaidの用語については、ドキュメントの https://docs.mermaidchart.com/mermaid-oss/syntax/sequenceDiagram.html を参考にする

5. テキストを必ず日本語（ja-JP）で出力すること。

6. 作成したフローチャートをDiagramセクションに、すべてのシーケンスをDescriptionセクションに出力すること。

<br>
