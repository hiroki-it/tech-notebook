---
title: 【IT技術の知見】通信データの暗号化技術＠セキュリティ
description: 通信データの暗号化技術＠セキュリティの知見を記録しています。
---

# 通信データの暗号化技術＠セキュリティ

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

> ℹ️ 参考：https://hiroki-it.github.io/tech-notebook-mkdocs/about.html

<br>

## 01. 通信データを暗号化する目的

### 盗聴（通信データの盗み取り）を防ぐため

『共通鍵暗号方式』や『公開鍵暗号方式』によって実現される。暗号アルゴリズムに基づく暗号方式を使用してデータを暗号化することによって、通信データの盗聴を防ぐ。

![盗聴_改竄_成りすまし](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/盗聴_改竄_成りすまし_1.png)

<br>

### 改竄（通信データの書き換え）を防ぐため

『デジタル署名』や『ハッシュ関数』によって実現される。相手に送ったデータと相手が受け取ったデータが同じか否かを確認することによって、通信データの改竄を防ぐ。

![盗聴_改竄_成りすまし](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/盗聴_改竄_成りすまし_2.png)

<br>

### 成りすましを防ぐため

『デジタル署名』によって実現される。正しい相手であることを証明することによって、成りすましを防ぐ。

![盗聴_改竄_成りすまし](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/盗聴_改竄_成りすまし_3.png)

<br>

## 01-02. 暗号アルゴリズム

通信データの暗号化のほとんどは、『共通鍵暗号方式』や『公開鍵暗号方式』によって実現される。それらの方式は、以下のアルゴリズムによって実装される。

<br>

### 共通鍵暗号アルゴリズム

共通鍵暗号方式を実装するためのアルゴリズム

#### ▼ DES 暗号：Data Encryption Standard

#### ▼ AES 暗号：Advanced Encryption Standard

<br>

### 公開鍵暗号アルゴリズム

公開鍵暗号方式を実装するためのアルゴリズム

#### ▼ RSA 暗号：Rivest-Shamir-Adleman cryptosystem

<br>

## 01-03. 暗号アルゴリズムに基づく暗号方式

### 暗号方式の種類一覧

|                        |       共通鍵暗号方式       |     公開鍵暗号方式     |
| ---------------------- | :------------------------: | :--------------------: |
| **暗号化アルゴリズム** |   共通鍵暗号アルゴリズム   | 公開鍵暗号アルゴリズム |
| **アルゴリズムの種類** |    RC4、DES、3DES、AES     |      RSA、ElGamal      |
| **暗号化に要する時間** |          より短い          |        より長い        |
| **作成される暗号鍵**   |           共通鍵           |     秘密鍵、公開鍵     |
| **鍵の配布方法**       | メール（盗聴に気を付ける） |      メール、PKI       |
| **鍵の再利用**         |   再利用するべきではない   |    再利用してもよい    |

<br>

### 共通鍵暗号方式

#### ▼ 共通鍵暗号方式とは

サーバーから受信者（クライアント）にあらかじめ秘密鍵を渡しておく。鍵の受け渡しを工夫しないと、共通鍵が盗聴される可能性がある（**鍵配送問題**）。

**＊例＊**

エクセルのファイルロック

**長所**：処理が速い

**短所**：鍵の配布が大変

![p437](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/p437.png)

#### ▼ 共通鍵の再利用の可否

各受信者（クライアント）は、サーバーから、受信者ごとに作成された共通鍵をもらう。鍵の再利用をするべきではない。

![共通鍵の再利用](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/共通鍵の再利用.png)

<br>

### 公開鍵暗号方式

#### ▼ 公開鍵暗号方式とは

![公開鍵暗号方式](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/公開鍵暗号方式.png)

公開鍵暗号方式でも記載の通り、共通鍵暗号方式の鍵配送問題を解決すべく開発された。『RSA暗号』などによって実装される。受信者（クライアント）の公開鍵で暗号化した場合、受信者の秘密鍵でのみ復号可能。すなわち、第三者に復号（解読）されることはないと判断可能。

**＊サーバーが行うこと＊**

1. サーバーは、受信者（クライアント）から公開鍵をもらう。
2. 公開鍵を使用して、情報を暗号化する。

**＊受信者（クライアント）が行うこと＊**

1. 受信者（クライアント）は、秘密鍵で情報を復号する。  

#### ▼ 公開鍵の再利用の可否

各受信者（クライアント）は、サーバーから、異なるサーバーで再利用される公開鍵をもらう。ただし、サーバーごとに異なる秘密鍵と公開鍵を使用しても良い。

![公開鍵の再利用](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/公開鍵の再利用.png)

<br>

### ハイブリッド暗号方式

共通鍵暗号方式と公開鍵暗号方式を組み合わせた暗号方式。両方の方式の長所と短所を補う。

![ハイブリッド暗号](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/ハイブリッド暗号.png)

<br>

## 02. 暗号ダイジェスト（デジタル署名）について

### 暗号ダイジェスト（デジタル署名）を使用した暗号化技術

#### ▼ 暗号ダイジェスト（デジタル署名）とは

『公開鍵暗号方式とは逆の仕組み（※つまり、公開鍵暗号方式ではない）』と『ハッシュ関数』を利用した暗号化。『成りすまし』と『改竄』を防げる。

![デジタル署名](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/デジタル署名.png)

**＊サーバーが行うこと＊**

1. サーバーは、受信者（クライアント）にあらかじめ公開鍵を配布しておく。
2. 平文をハッシュ化し、ダイジェストにする。
3. ダイジェストを秘密鍵で暗号化し、暗号ダイジェスト（デジタル署名）を作成する。
4. 『平文』、『暗号ダイジェスト（デジタル署名）』を送信する。

**＊受信者（クライアント）が行うこと＊**

1. 受信者（クライアント）は、『平文』と『暗号ダイジェスト（デジタル署名）』を受信する。
2. 平文をハッシュ化し、ダイジェストにする。
3. 上記```2```個のダイジェストが同一なら、『成りすまし』と『改竄』が行われていないと判断

#### ▼ 暗号ダイジェスト（デジタル署名）のメリット

（1）改竄を防げる

サーバーから送られた『平文』と『暗号ダイジェスト』のどちらかが、通信の途中で改竄された場合、これらのダイジェストが同じになることは確率的にありえない。したがって、確かに改竄されていないと判断可能。

（２）成りすましを防げる

特定の秘密鍵を持つのは、特定のサーバーだけ。したがって、確かにサーバーによって暗号化されたものだと判断可能。

#### ▼ 暗号ダイジェスト（デジタル署名）のデメリット

**★★公開鍵の成りすましを防げない★★**

二者間だけのやり取りでは、あらかじめ受信者に渡される公開鍵が偽の送信者のものであっても、確かめる術がない。これを保障する仕組みに、PKI（公開鍵基盤）がある。

<br>

### 暗号ダイジェスト（デジタル署名）と公開鍵暗号方式を使用した暗号化技術

『成りすまし』と『改竄』を防げるデジタル署名に、『盗聴』を防げる公開鍵暗号方式を組み込んだ暗号化技術。

![デジタル署名と暗号化](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/デジタル署名と暗号化.png)

<br>

### ハッシュ関数によるハッシュ化

何かのデータを入力すると、規則性のない一定の桁数の値を出力する演算手法。

![ハッシュ関数](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/ハッシュ関数.png)

<br>

### PKI：Public Key Infrastructure（公開鍵基盤）による公開鍵の検証

#### ▼ ドメインの正当性の検証

秘密鍵とデジタル証明書はドメインの正当性（偽のサイトではないこと）を担保するものである。デジタル署名に使用した秘密鍵に対応する公開鍵は、成りすました人物による偽の公開鍵である可能性がある。第三者機関の認証局によって、公開鍵を検証するインフラのことを、公開鍵基盤という。

#### ▼ 公開鍵の検証の仕組み

![デジタル証明書（SSL証明書）](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/デジタル証明書（SSL証明書）.gif)

多くの場合、サーバーの提供会社が中間認証局をもっている。

**＊例＊**

| サーバー提供者 | 中間認証局名    | ルート認証局名 |
| ------------ | --------------------- | -------------- |
| AWS          | Amazon Trust Services | Starfield社    |
| GCP          | Google Trust Services |                |

**＊サーバーが行うこと＊**

1. サーバーは、公開鍵と秘密鍵を作り、認証局に公開鍵とデジタル署名を提出する。
2. 認証局から、暗号ダイジェスト（デジタル署名）を含むデジタル証明書（S/MIME証明書、SSL証明書）を発行してもらう。デジタル証明書が、公開鍵の本人証明になる。デジタル証明書は、S/MIMEで使用する場合には、『S/MIME証明書』、SSL/TLSで使用する場合には、『SSL証明書』という。
3. 受信者（クライアント）にメール、暗号ダイジェスト（デジタル署名）を含むデジタル証明書を送信する。

**＊受信者（クライアント）が行うこと＊**

1. 受信者（クライアント）は、暗号ダイジェスト（デジタル署名）を含むデジタル証明書（S/MIME証明書、SSL証明書）を受信する。
2. 認証局からもらった公開鍵を使用して、デジタル証明書の暗号ダイジェスト（デジタル署名）部分を復号し、ハッシュ値が同じなら、認証局そのものが成りすましでないと判断する。

#### ▼ 認証局そのものの成りすましの防止策

デジタル証明書（S/MIME証明書、SSL証明書）を発行する認証局そのものが、成りすましの可能性がある。そこで、認証局をランク付けし、ルート認証局が下位ランクの認証局に権限を与えることにより、下位の認証局の信頼性を持たせている。注意点として、ルート認証局は専門機関から厳しい審査を受けているため、ルート認証局自体がなりすましである可能性は非常に低い。

> ℹ️ 参考：https://zeropasoakita.livedoor.blog/archives/20294837.html

![認証局自体の成りすまし防止](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/認証局自体の成りすまし防止.png)

<br>

## 03. その他のセキュリティ技術

### メール受信におけるセキュリティ

#### ▼ OP25B（Outbound Port 25 Blocking）

#### ▼ SPF（Sender Policy Framework）

<br>

### パスワードの保存方法

平文で保存しておくと、流出した時に勝手に使用されてしまうため、ハッシュ値で保存するべきである。

![ハッシュ値で保存](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/ハッシュ値で保存.png)

<br>

### 生体認証

![生体認証-1](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/生体認証-1.png)

![生体認証-2](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/生体認証-2.png)

<br>

### Web beacon

webページに、サーバーに対してHTTPリクエストを送信するプログラムを設置し、送信されたリクエストを集計するアクセス解析方法。例えば、1x1の小さなGif『画像』などを設置する。

<br>

