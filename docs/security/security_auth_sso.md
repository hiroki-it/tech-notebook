---
title: 【IT技術の知見】認可＠認証/認可
description: 認可＠認証/認可の知見を記録しています。
---

# 認可＠認証/認可

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

> ↪️ 参考：https://hiroki-it.github.io/tech-notebook/

<br>


## 02. SSO：Single Sign On

### SSOとは

Webサイトごとに認証フェーズと認可フェーズを行うのではなく、認証フェーズは他のWebサイトに統一的に委譲し、認可フェーズだけはWebサイトごとに実施する。

セキュリティ強度の向上というよりは、利便性の向上のために使用することが多い。

そのため別途、二要素認証などと組み合わせて、セキュリティ強度を向上させた方が良い。

二要素認証とSSOを組み合わせる場合、認証フェーズの委譲先で二要素認証を追加することになる (例：GitHubアカウントを用いたSSO時に、ワンタイムパスワードの入力も要求される) 。

> ↪️ 参考：https://www.idnetworks.co.jp/wP/2014/04/04/sso-with-2fa/

<br>

### SSOの仕組み

![sso](https://raw.githubusercontent.com/hiroki-it/tech-notebook-images/master/images/sso.jpg)

`【１】`

: APIクライアント (あるいは認証プロキシ) が、HTTPリクエストにIDとパスワードを設定し、IPプロバイダーにリクエストする。

`【２】`

: IDプロバイダーが、クライアントを『認証』し、クライアント側にアクセストークンを発行。

`【３】`

: クライアントが、HTTPリクエストのヘッダーにアクセストークンを設定してリクエストする。

`【４】`

: アクセストークンが『認可』されれば、API側がデータをレスポンスする。

SSOには、認証フェーズと認可フェーズがあり、`3`個の役割が定義されている。

| 役割            | 説明                                                                 | 例                                          |
| --------------- | -------------------------------------------------------------------- | ------------------------------------------- |
| APIクライアント | APIに対して、リクエストを送信したいサーバーのこと。                  | Ouath認証の仕組みにおけるクライアント。     |
| IDプロバイダー  | トークンを作成するサーバーのこと。                                   | Ouath認証の仕組みにおける認可サーバー。     |
| APIサーバー     | クライアントに対して、リソースのレスポンスを返信するサーバーのこと。 | Ouath認証の仕組みにおけるリソースサーバー。 |

> ↪️ 参考：https://japan.zdnet.com/article/35126144/

<br>

### APIクライアント

#### ▼ IDプロバイダーとの通信

APIクライアントは、IDプロバイダーにIDとパスワードを送信する必要がある。

ただし、代わりに認証プロキシ (例：oauth2-proxy、dex、など) を使用しても良い。

APIクライアントが認証プロキシにリクエストを送信した後、認証プロキシはIDプロバイダーからアクセストークンを取得し、APIクライアントを認証する。

#### ▼ ステータスコードの選定

認証フェーズにて、誤ったトークンが発行されたことを表現したい場合、`401`ステータスを使用する。

認可フェーズにて、正しいトークンが発行されたが、トークンの所有者に参照権限がないことを表現したい場合、`403`ステータスを使用する。

<br>

### IDプロバイダー

#### ▼ IDプロバイダーの種類

- Auth0
- Facebook
- KeyCloak
- AWS Cognito
- Google Auth

![auth0_sso](https://raw.githubusercontent.com/hiroki-it/tech-notebook-images/master/images/auth0_sso.png)

> ↪️ 参考：https://speakerdeck.com/lmi/ginzarails-vol35-presentation?slide=25

<br>
