---
title: 【IT技術の知見】SRE：Site Reliability Engineering
description: SRE：Site Reliability Engineeringの知見を記録しています。
---

# SRE：Site Reliability Engineering

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

参考：https://hiroki-it.github.io/tech-notebook-mkdocs/about.html

<br>

## 01. SREの見解集

### SREとは

#### ▼ 引用：[サイトリライアビリティエンジニアリング](https://www.amazon.co.jp/dp/4873117917)

サイトの信頼性向上を目的としたエンジニアリング手法のこと。

<br>

### サイトの『信頼性』とは

#### ▼ 引用：[サイトリライアビリティエンジニアリング](https://www.amazon.co.jp/dp/4873117917)

信頼性とは、『システムが求められる機能を、定められた条件下で、定められた期間にわたり、障害を起こすことなく実行する確率』のこと。

#### ▼ 引用：[SRE実践の手引](https://eh-career.com/engineerhub/entry/2019/12/05/103000)

SREの具体的な行動を明確にするためには、サイトの信頼性を表す指標（SLI）と、指標の具体的な目標値（SLO）を定義する必要がある。エラーバジェットの残量を考慮に入れ、リスクを取りながら、サイトの信頼性の維持に努める。

#### ▼ 引用：[SREの基本と組織への導入](https://dev.classmethod.jp/articles/202105-report-gcd21-d3-infra-01/)

ソフトウェアの最も重要な機能は信頼性であり、信頼性の程度はサイトのユーザーによって決められるべきである。ユーザーは、SLIを信頼性の指標とし、SLOに至った場合に信頼できるサイトと見なす。

#### ▼ 引用：[組織の信頼性のマインドセット](https://cloud.google.com/blog/ja/products/devops-sre/the-five-phases-of-organizational-reliability)

プロダクトの信頼性は、そのシステムのアーキテクチャ/プロセス/文化/開発組織のマインドセットによって決まる。

<br>

### SREが有用な業態

#### ▼ 引用：[サイトリライアビリティエンジニアリング](https://www.amazon.co.jp/dp/4873117917)

SREが信頼性を向上させるソフトウェアは、サイトやそれに類似するサービスである。原子力発電所、航空機、医療機器、その他安全性が極めて重要なソフトウェアなどの信頼性については考えない。

#### ▼ 引用：[SRE実践の手引](https://eh-career.com/engineerhub/entry/2019/12/05/103000)

SREには、継続的な改善によって、システムの信頼性を向上させようとする思想がある。そのため、アジャイル開発を採用できないシステム（例：人命にかかわるようなシステム）を扱っている業態や、サイトを扱っていても納品後に改善作業がないような業態（例：受託会社）では、有効に機能しない。

<br>

### SREの土台となる文化

#### ▼ 引用：[SREの探求](https://www.amazon.co.jp/dp/4873119618)

チームが成功するか否かの最重要な指標は、在職期間の長さ、年功序列、給与水準の程度ではなく、心理的安全性の程度である。心理的安全性は、一般的に以下の時に低くなる。もちろん、個人で『安全』と感じる状態は異なるため、アンケートしても良い。

- もし失敗したら、チームは自分を非難するだろう。

- チームは独自の文化を持っており、新しい文化を持つメンバーが溶け込みにくい。

- チームは、困っているものに手を差し伸べるのが遅い。

- チームの目的を達成する上で、自分のスキルを発揮するよりも優先すべきことがある。

- チームのセンシティブな問題について正直に話し合うことは気まずい。

一方で技術には、より正しい理解やベタープラクティスがある。他の人の提案がこれと異なっていた時に、その人に心理的安全性を下げずに、正しい情報やベタープラクティスに軌道修正する方法が難しい。エンジニアに関係なく、ビジネススキルみたいな話になる。そこで、心理的安全性だけを最適化するわけではなく、チームの生産性などの他の要素も考慮に入れながら、バランスの良い最適化を図るようにする。

#### ▼ 引用：[SRE実践の手引](https://eh-career.com/engineerhub/entry/2019/12/05/103000)

改善のきっかけは失敗であることが前提にあるため、失敗が許されない文化がある会社組織でも機能しない。

<br>

### SREの組み込み方

SREとアプリケーションチームの間で、どのようにコミュニケーションを行なっていくかは、SREの組み込み方によって異なる。

参考：https://x-tech5.co.jp/2022/02/21/204/

<br>

## 01-02. SREのアンチパターン集

### 引用：[SREの探求](https://www.amazon.co.jp/dp/4873119618)



| アンチパターン                                            | パターンの説明                                               | パターンの問題点                                             | パターンの解決策                                             | 補足                                                         |
| --------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| サイトリライアビリティオペレーション                      | 今までのシステム運用（例：NOC）をSREingと言い換えるだけの方法のこと。 | ・SREerの作業内容には、システム運用だけなく、開発も含まれる。またこの開発では、できるだけ人の手を離れていて、障害の発生頻度が少ないようなシステムを構築する必要がある。<br>・　NOCのような場所は、作業に集中できる環境ではない。 | ▼ 作業時間<br>SREerは、勤務時間の半分以上を、システム運用ではなく開発に割り当てる。<br><br>▼ 作業場所<br>NOCのように、24時間365日、システムのすぐそばでオンコール担当者がこれの面倒を見るのではなく、リモートでどこからでもすぐに対応できるようにする。この時、オンコール担当者がメトリクスの時系列データの共有リンクをインシデントに関心がある人に共有すれば、共通の視点でインシデントを見ることができる。 | NTTドコモのNOCの様子。参考：https://k-tai.watch.impress.co.jp/img/ktw/docs/1077/992/html/02.jpg.html<br>![noc_ntt-docomo](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/noc_ntt-docomo.jpeg) |
| 画面を見つめる人間                                        | エラーイベントからアラートを手動でアラートを作成すること。また、作成した全てのアラートを通知し、手動でインシデントか否かを判断してしまうこと。 | インシデントの解決作業のせいで、それ以外の業務に集中できない。 | ▼ アラート通知前の自動解決<br>エラーイベントのアラートが作成された時、すぐにオンコール担当者に通知するのでなく、システムに自動的に解決させるようにする。<br><br>▼ 通知後の自動タスク化<br>解決できなかったエラーイベントをインシデントか否か判断してタスク化する作業も自動化する。 |                                                              |
| 群衆によるインシデント対応                                | インシデントの担当者を無秩序に配置してしまうこと。           | ・様々な仮説が入り混じり、むしろ解決が長引く。<br>・インシデントの解決作業のせいで、それ以外の業務に集中できない。 | インシデントが発生した時に、無秩序的ではなく、組織的に担当者を配置する。インシデントの対応の組織化については、インシデントコマンドシステムが役立つ。 |                                                              |
| 根本原因 = ヒューマンエラー                               | ヒューマンエラーが、インシデントの根本原因（ただ一つの原因）であると見なしてしまうこと。 | ヒューマンエラーが根本原因だったとしても、人間には様々な状況が背景にあり、不正確な原因しか突き止められない。 | ▼ インシデントの発生時には解決に注力する<br>インシデントが発生した時に、ヒューマンエラーを原因と見なし、原因になった犯人を突き止めようとしない。犯人を突き止めて、インシデントを解決した気にならないようにする。あくまで、インシデントそのものを解決することだけに専念する。<br><br>▼ 事後評価ではインシデントの原因が一つだと考えない<br>インシデントの事後評価では、ヒューマンエラー、ソフトウェア、ハードウェア、といった特定の何か一つが根本の原因と判断しない。あらゆる側面から、複雑に絡み合う複数の原因や、寄与要因（潜在的な原因）を突き止める。 | よりよい事後評価にするために、ポストモーテムを採用する。<br>参考：https://sreake.com/blog/5point-good-postmortem/ |
| ページャーの引き渡し                                      | 開発に携わっていない人にオンコールを任せてしまうこと。（ページャー：ポケベル） | ・自分自身の開発したシステムが本番環境でどのように振る舞うのか、といったことを学ぶ機会を奪う。<br>・アプリ領域に関係するインシデントを迅速に解決できなくなる。 | オンコールは全てのエンジニアの仕事であり、アプリ開発チームはSREerにオンコールを全て丸投げしないようにする。アプリ開発者もオンコールの担当になるようなルール（例：交代制、二次オンコール担当）を設ける。 |                                                              |
| マジックスモークを消すのは私だ！                          | インシデントの発生を予防するための様々な行動よりも、インシデントの解決を最も高く評価すること。 | ・現場のエンジニアが、忍耐的な作業にモチベーションを感じてしまう<br>・インシデントの担当者は適切に休めず、幸福度が下がる。 | インシデントを予防できるシステムを開発する。インシデントの解決よりも、こういったシステムを開発することをより高く評価するような文化を普及させる。 |                                                              |
| アラートリライアビリティエンジニアリング                  | あらゆるものをエラーベントと見なし、アラートを通知してしまうこと。 | アラートが通知されるたびに、それ以外の作業が中断されてしまう。 | ユーザーの満足度に影響を与える問題（例：UX、単一障害点の異常、レプリカ数の過剰な減少）が発生した場合は、アラートを通知する。 | ユーザーの満足度に影響を与えるクリティカルジャーニー中のエラーイベントを監視すると良い。<br>参考：https://speakerdeck.com/arisgi/yoriyi-wei-falsearujian-shi-womu-zhi-site-wai-xing-jian-shi-falseyou-xiao-huo-yong?slide=19 |
| ペットを散歩させてくれるドッグウォーカーを雇う            | インフラのプロビジョニングツールを、イミュータブルなインフラを構築するためではなく、既存のミュータブルなインフラを冗長化させるために使用してしまうこと。 | よくわからず...                                              | インフラのプロビジョニングツールは、イミュータブルなインフラを構築するために使用する。 |                                                              |
| スピードバンプエンジニアリング                            | 機能変更からリリースまでの間に、関門になるステップを設けてしまうこと。 | 関門となるステップ（例：変更管理委員会）が、必ずしも、機能変更のリリースに良い付加効果をもたらすわけでもなく、またユーザーからの評価を提供してくれるわけでもない。<br>・不要なステップがあると、変更、リリース、ユーザー評価のサイクルの速度が落ちるため、システムの信頼性が高まりにくくなる。 | ▼ 最小限の関門ステップ<br>関門ステップを設けるとしても、特定の状況下（例：機能ではなくプロダクト全体のリリース）で、プロダクトの内容には無関係なステップ（例：キャパシティプランニングなど）のみにする。<br><br>▼ エラーバジェットの導入<br>エラーバジェットを導入し、優先順位決めや承認のスピードを上げる。 | エラーバジェットの求め方。<br>参考：https://speakerdeck.com/yukaneko/sre-hefalsedi-bu-pagerduty-x-datadog-woshi-yong-sitapin-zhi-guan-li?slide=6 |
| 設計の難所                                                | システム設計時のSREerのコンサルがボトルネックになってしまう。 | SREerは、あらゆるシステムの設計でコンサル（例：派遣型、窓口型）する必要がある。しかし、システムの数が多くなると、コンサルのステップがボトルネックになり、リリースの頻度が低くなる。 | コンサルをフレームワーク化（例：チェックリスト）したり、ツールで自動的にコンサルできるようにする。 |                                                              |
| 棒が多すぎてニンジンが不足                                | SREingの実現に必要なツールをアプリ開発チームに導入したい時に、まずは提案するのではなく、使用を強制してしまうこと。 | SREingはプッシュ型ではなくプル型であり、アプリ開発チームから課題を聞き出す必要がある。ツールをプッシュ型で強制的に導入した結果、エンジニアの開発がより非効率になることがある。 | アプリ開発者チームから、開発の効率性に関する課題を聞き出し、それに合ったツールを提案する。 |                                                              |
| プロダクションの延期                                      | リリース前にエラーイベントの原因になりそうなこを未然に全て解決しようとしてしまうこと。 | 機能変更からリリースまでに必要以上に時間がかかると、ユーザーからの評価が遅くなる。 | ▼ テストの自動化<br>あらゆるエラーイベントを予防するために、機能変更のリリース前にテストを行うことは重要であるが、リリースまでに必要以上に時間がかからないようにする。そのために、テストを自動化して時間を短縮する。<br><br>▼ ユーザーからの評価を素早く得る<br>ユーザーからの評価を素早く得られるTesting in production（例：ダークローンチ、カナリアリリース）を採用する。<br><br>▼ ロールフォワード、ロールバックの自動化<br>リリース前の予防を完璧にしない代わりに、リスクヘッジとして、リリース後のロールフォワードとロールバックを自動的に実行できるようにしておく。 | Progressive deliveryを採用し、ユーザーからの評価を素早くえつつ、自動ロールバックでリスクヘッジする。 <br>参考：https://speakerdeck.com/tozastation/3-shake-inc-niokeru-progressive-dellivery-dao-ru-madefalsenao-mitoqu-rizu-mi-cndt2021 |
| リカバリ時間ではなく障害回避の最適化（```MTTF > MTTR```） | MTTFを重要視し、MTTRを軽視してしまうこと。<br>![mtxx](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/mtxx.png) | 障害は発生するものであり、MTTFを最適化することは現実的ではない。 | ▼ 回復力の向上<br>自己修復能力のあるシステム、自動的なロールバック、を採用する。<br><br>▼ 回復力の維持<br>定期的にTesting in production（例：カナリアリリース中のテスト、カオスエンジニアリング）を実行し、回復力を維持する。 |                                                              |
| 依存性地獄                                                | システムが新旧様々なコンポーネントからなる場合に、コンポーネント間の依存関係が闇になってしまっていること。 | 新旧コンポーネント間の依存関係が闇になっており、とある機能変更の影響範囲を人間が予測することは不可能である。 | 機能変更によって、コンポーネント間にどのような依存関係が新しく追加されるかを自動的に検出し、記録できるようにする。 |                                                              |
| 小回りの利かないガバナンス                                | 組織単位ではなく、プロジェクト単位で承認/予算策定/成果が設計されてしまうこと。 | プロジェクト単位で承認/予算策定/成果が求められると、種々の問題（例：予算策定硬直、不要な機能がそのまま、開閉が繰り返されるプロジェクト）が起こり、アジャイル開発を実現できない。 | 組織単位で承認/予算策定/成果を設計する。また、各組織は、目標（例：方針管理、Catchball、OKR）までのプロセスに対して、自由に承認/予算策定/成果を設計する。 |                                                              |
| 不適切な「おやおや」のSLO                                 | ビジネスとは無関係にSLOを決めてしまっていること。また、一度決まったSLOが更新されないままになってしまうこと。 | ユーザーニーズに基づいたSLOではないため、いずれシステムの不備（例：スループット不足、過負荷、ハードウェアキャパシティ不足）が浮き彫りになる。また、SLOが最新の状況に則していないと、ユーザーからの評価を下げることになる。 | ビジネス側と話し合い、ユーザーニーズ、ビジネスの収益、に基づいたSLOを設定する。また定期的に更新する。 | クリティカルジャーニーをビジネス側と話し合い、これの満足度に影響を与えるメトリクスをSLIとする。<br>参考：<br>・https://codezine.jp/article/detail/16020?p=2<br>・https://medium.com/google-cloud-jp/sre-slo-d7c6aee1fb0e |
| ファイアウォール越しにAPIを投げ渡す                       | パートナーに機能（例：API）を提供するようなビジネスをしている場合、パートナーのSLOに無関心で、自社のSLOのみを守ろうとしてしまうこと。 | 自社がパートナーの問題に無関心になることによって、チーム間の無関心で起こる問題と同じようなことが起こる。 | ▼ 共通認識からなるSLIとSLO<br>自社とパートナーの間でSLIを共有し、自社とパートナーのシステムを合わせたSLOを設定する。<br>▼ インシデントを共通管理<br>自社とパートナーの間でインシデントを共通管理する。インシデントを協働的に解決できるように、対処の権限をお互いに与える。 |                                                              |
| 運用チームの修復                                          | 運用手法のみを改善すればSREingを実践できる、と考えてしまうこと。 | SREingの実践のために、ビジネス（例：優先順位付け、計画と実行、意思決定）、システム（例：設計、構築、トイル、ヒューマンエラー）、チーム（コミュニケーション）も改善する必要がある。 | 上層部から理解が得られず、SREingを十分に実践できなくとも、少なくともシステムとチームは改善できる。 |                                                              |
| 最後にもう一言                                            | SREingのアンチパターンは、変化し続けること。                 | 筆者が集めたアンチパターンは、全体のほんの一部分でしかない。 | SREingの失敗事例を、自社内外問わず、共有していく必要がある。 | Twitterアカウント```@BlakeBisset```宛に ```#SREantipatterns```をつけて共有してほしい。 |



<br>

## 01-03. SLI/SLO/SLAの決め方

### SLI/SLOの決め方

#### ▼ 引用：・[SREの基本と組織への導入](https://dev.classmethod.jp/articles/202105-report-gcd21-d3-infra-01/)、・[これからはじめる 実践 SRE/SLOの監視をやってみよう](https://medium.com/google-cloud-jp/sre-slo-d7c6aee1fb0e)


CUJ（クリティカルジャーニー）の満足度に影響を与えるメトリクス（リクエストとレスポンスの可用性/遅延/品質、データ処理のカバレッジ/正確性/鮮度/スループット、ストレージのスループット/遅延、など）をSLIとし、満足と判断する最低限の閾値をSLOに設定するとよい。

**＊例＊**

ECサイトであれば、以下がCUJとなる。

1. 商品を検索する。
2. 商品をカートに追加する。
3. 商品を購入する。

参考：https://speakerdeck.com/arisgi/yoriyi-wei-falsearujian-shi-womu-zhi-site-wai-xing-jian-shi-falseyou-xiao-huo-yong?slide=19

#### ▼ 引用：[SREの探求](https://www.amazon.co.jp/dp/4873119618)

MTTxメトリクスとそのダッシュボードを作成すると良い。MTTxメトリクスについては、以下のリンクを参考にせよ。

参考：https://hiroki-it.github.io/tech-notebook-mkdocs/observability/observability_monitoring.html

#### ▼ 引用：[SREの探求](https://www.amazon.co.jp/dp/4873119618)

可用性やQoS：Quality of Serviceに関するメトリクスをSLIに選択すると良い。具体的には、可用性は稼働時間を基に定量化できる。SLOは、サイト提供者会社内部で決める目標値である。

参考：

- https://qiita.com/hz1_d/items/ca24e1d131bf475e23b1
- https://www.linkedin.com/pulse/high-availability-vs-fault-tolerance-jon-bonso

#### ▼ 引用：[優れたSLOを策定するには](https://cloud.google.com/blog/ja/products/gcp/building-good-slos-cre-life-lessons)

<br>

### SLAの決め方

#### ▼ 引用：[SREの探求](https://www.amazon.co.jp/dp/4873119618)

SLAは、サイト提供会社と利用者の合意で決める目標値である。違反の規約が無ければ、SLAでなくSLOである。SLAの補償期間は一日単位で設定すると良い。SLA違反の場合には、返金を補償とする場合があるが、これ以外の補償方法でも良い。

#### ▼ 引用：[ガイドライン](https://www.meti.go.jp/policy/netsecurity/secdoc/contents/downloadfils/080121saasgl.pdf)

経産省がSLAのガイドラインを策定している。

<br>

## 01-04. SLOの達成方法

### SLOの評価

#### ▼ 引用：[SREの探求](https://www.amazon.co.jp/dp/4873119618)

SLOを達成したか否かを判断する場合に、ヒストグラムが有効である。以下の図では、横軸に各リクエストのレイテンシー（ミリ秒）と縦軸にリクエスト数（個）を表している。また、分位ボックス（```q(n)```）により全データの何パーセントの集合かを表しており、例えば、```q(0.99)```は、```99%```以上が5```ms```未満であることを示す。LT（ロングテール）の先にある見えない最大値は```120```msである。単なる最小値/最大値/中央値/平均値であると表面的な結果しか得られない。しかし、このようなヒストグラムを使用すれば、各リクエストがどの程度のレイテンシーに、どのくらい分布しているか、を正確に知られる。例えば、SLOを『```5```ms未満のレイテンシー』に設定としたとして、ヒストグラムから```99.4597```%がこれを満たしていると結論付けられる。

![slo_histogram](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/slo_histogram.png)

<br>

### SLOを達成のための行動

#### ▼ 引用：[Site Reliability Engineeringとは](https://www.nic.ad.jp/ja/materials/iw/2017/proceedings/s15/s15-fujisaki.pdf)

- 可用性の向上（障害ドメインと更新ドメインを考慮した冗長化）
- パフォーマンスの向上（レイテンシーの抑制 ）
- 開発効率の向上（変更管理、ツール）
- 適切なモニタリング
- インシデント管理
- キャパシティプランニング

<br>

## 02. ドキュメンテーション

### ドキュメントの種類

| 種類      | 例                                                                                            |
|---------|----------------------------------------------------------------------------------------------|
| サービス概要  | アーキテクチャ、コンポーネント間の依存関係、ステークホルダー、プロダクト責任者                                                      |
| 手順書     |                                                                                              |
| ポストモーテム | 参考：https://hiroki-it.github.io/tech-notebook-mkdocs/observability/observability_monitoring.html |
| ポリシー    | リリースノート、命名規則、など                                                                              |
| SLA     | 参考：https://hiroki-it.github.io/tech-notebook-mkdocs/observability/observability_monitoring.html |

<br>

### 品質

#### ▼ 品質の種類

| 品質名     | 説明                                                         |
| -------- | ------------------------------------------------------------ |
| 構造品質 | 表記と文法の正しさのこと。機能品質よりは重要度が低い。       |
| 機能品質 | ドキュメントの有用さのこと。ドキュメントをコードと同じディレクトリなどでバージョン管理し、コードの変更に合わせてドキュメントも変更する。有用性の品質を保つとともに、ドキュメントの場所を明確にする。 |

#### ▼ 品質を保つツールの導入

esaなどのドキュメント作成ツールを使用すると、フィードバックをもらいやすくなる、誰でも気軽に作成更新できる、構造/機能品質を高めるための機能がある、ことで、機能品質を高めやすくなる。

<br>

## 03. その他情報収集

### 企業

#### ▼ Wantedly

SREチームのValueから、SREに必要な技術がわかる。

参考：https://gist.github.com/south37/85d97e02d7816a31053971d63c164880

#### ▼ 3-shake、Topotal

提供しているサービスから、SREに必要な技術がわかる。

参考：

- https://sreake.com/
- https://topotal.com/services/sre-as-a-service

<br>

### ニュース

#### ▼ SREウィークリー

参考：https://sreweekly.com/about-sre-weekly-2/

