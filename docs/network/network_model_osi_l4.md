---
title: 【IT技術の知見】L4＠OSI参照モデル
description: L4＠OSI参照モデルの知見を記録しています。
---

# `L4`＠OSI参照モデル

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

> ↪️：https://hiroki-it.github.io/tech-notebook/

<br>

## 01. トランスポート層 (`L4`)

### トランスポート層とは

アプリケーション層のプロトコルを適切なアプリケーションに振り分けるプロトコル (例：TCP、UDP、など) を処理するレイヤーである。

> ↪️：https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E5%B1%A4

<br>

### トランスポート層の仕組み

#### ▼ 全体像

クライアントからのリクエスト時に、ネットワーク層から渡されたパケットのポート番号情報を元に、アプリケーション層の特定のプロセスにパケットを渡す。

また反対に、レスポンス時にアプリケーション層のプロセスから出力されたパケットに情報を付加し、ネットワーク層に渡す。

この時、各アプリケーションはプロセスとして稼働していることに留意する。

![トランスポート層からアプリケーション層へのパケットの移動](https://raw.githubusercontent.com/hiroki-it/tech-notebook-images/master/images/トランスポート層からアプリケーション層へのパケットの移動.PNG)

#### ▼ クライアントからのリクエスト時 (図の 『`➡︎`』 )

`【１】`

: ネットワーク層でプライベートIPアドレスを使用して、リクエスト先のパソコンを識別する。

`【２】`

: トランスポート層で、ポート番号を元にして、アプリケーション層のプロセスにパケットを送信する。

**＊例＊**

インバウンド通信を待ち受けるポート番号を`8080`と設定した場合、リクエスト時に以下の様にポート番号を指定すると、`nginx`プロセスにリクエストを送信できる。

```yaml
GET http://127.0.0.1:8080
```

#### ▼ クライアントへのレスポンス時 (図の 『`←`』 )

`【１】`

: パケットの通過したポート番号をヘッダー情報として追加する。

`【２】`

: ネットワーク層へ送信する。

<br>

## 02. ソケットのプロトコル

### ソケット

#### ▼ ソケットとは

トランスポート層に存在し、受信した通信をアプリケーション層の各プロセスに振り分ける受け口をソケットという。

送信元のサーバーが宛先に対して、『`192.168.1.1:50001` (送信元IPアドレス:送信ポート) 』『`10.0.0.1:80` (宛先IPアドレス:宛先ポート) 』といったように、IPアドレスとポート番号の組合せで指定する。

#### ▼ ソケット接続とは

ソケット間のネットワーク接続をソケット接続という。

<br>

### Unixドメインソケット

#### ▼ Unixドメインソケットとは

Unixで使用されるソケットのこと。

ソケットファイルを介して、同じOS上のプロセス間でパケットを送受信する。

![unix-domain-socket](https://raw.githubusercontent.com/hiroki-it/tech-notebook-images/master/images/unix-domain-socket.png)

> ↪️：
>
> - https://en.wikipedia.org/wiki/Unix_domain_socket
> - https://ascii.jp/elem/000/001/415/1415088/
> - https://blog.bnikka.com/server/unix-socket.html

#### ▼ 通信方法

プロトコルを『`unix:`』としてパケットを送受信する。

```bash
unix://./etc/foo.sock
```

ソケットファイル (`.sock`ファイル) 自体にファイルとしての実体はなく、エンドポイントのように働く。

同じOS上で稼働するコンテナのプロセス間の通信でも使用できる。

> ↪️：https://www.miketheman.net/2021/12/28/container-to-container-communication/

<br>
