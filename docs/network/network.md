---
title: 【IT技術の知見】ネットワーク
description: ネットワークの知見を記録しています。
---

# ネットワーク

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

> ℹ️ 参考：https://hiroki-it.github.io/tech-notebook-mkdocs/about.html

<br>

## 01. ネットワークの全体像

ネットワークには、『インターネット』『WAN』『LAN』がある。自宅内LAN、学内LAN、企業内LAN、企業WANなど、さまざまなネットワークがあり、インターネットは、それぞれのネットワークを互いに接続しているネットワークである。

![network](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/network.png)

<br>

## 02. LAN：Local Area Network

### LANとは

限定された領域だけで通信できるネットワークのこと。LAN内では、各機器はプライベートIPアドレスで識別されている。LAN内に設置されたNATルーターが、WAN内のグローバルIPアドレスとLAN内のプライベートIPアドレスを相互変換する。

> ℹ️ 参考：http://qa.elecom.co.jp/faq_detail.html?id=4159&category=152

![network_lan](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/network_lan.jpeg)

<br>

### LANの構成

#### ▼ サブネット

LANは、バリアセグメント、パブリックサブネット（非武装地帯）、プライベートサブネット（内部ネットワーク）、に分割できる。AWSやGCPでも、VPCを同様のサブネットに分割すると良い。

> ℹ️ 参考：
>
> - https://www.techtarget.com/searchsecurity/definition/DMZ
> - https://www.ntt.com/business/services/network/internet-connect/ocn-business/bocn/knowledge/archive_09.html

![internal_dmz_external](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/internal_dmz_external.png)

#### ▼ パブリックサブネット内のサーバー

攻撃の影響がプライベートサブネットに広がる可能性を防ぐために、外部から直接的にリクエストを受ける。そのため、『DNSサーバー』『プロキシサーバー』『webサーバー』『メールサーバー』は、パブリックサブネットに設置すると良い。

#### ▼ プライベートサブネット内のサーバー

外部から直接的にリクエストを受けない。そのため、『dbサーバー』は、プライベートサブネットに設置すると良い。

<br>

## 02-02. ルーター

### ルーター

#### ▼ ルーターとは

異なるネットワーク間（LANとLAN、LANとWAN、など）で通信できるようにし、加えて同時に複数の送信先に通信をルーティングする。

#### ▼ 設置場所

ルーターは、パブリックネットワーク、各プライベートネットワークの入り口、各プライベートネットワーク間で共有、といった方法で設置する。プライベートネットワークの入り口に設置する場合、例えば、自宅内に設置するルーターがある。インターネットサービスプロバイダーから貸出されるモデムでアナログ信号をデジタル信号に変換した後、これにルーターを接続し、自宅内/外のネットワークを繋ぐ。

> ℹ️ 参考：
>
> - https://xtech.nikkei.com/atcl/nxt/column/18/01842/032200010/
> - https://michisugara.jp/modem_router

![router](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/router.png)

#### ▼ ルーターの種類

> ℹ️ 参考：
>
> - https://xtech.nikkei.com/atcl/nxt/column/18/00780/052700006/
> - https://book.mynavi.jp/support/pc/5081/pdf/154.pdf

| ルーター名                           | 設置場所                                           | 役割                                                         |
| ------------------------------------ | -------------------------------------------------- | ------------------------------------------------------------ |
| コアルーター                         | インターネットサービスプロバイダー内のネットワーク | 同じプロバイダーや異なるプロバイダーのネットワーク間を繋ぐ。 |
| センタールーター                     | 一般企業内の拠点間WANネットワーク                  | 本社と支社のネットワーク間を繋ぐ。                           |
| エッジルーター（エッジゲートウェイ） | 一般企業内の拠点間WANネットワーク                  | 異なる支社や営業所のネットワーク間を繋ぐ。                   |
| ブロードバンドルーター、Wifiルーター | 自宅内のネットワーク                               | 自宅内/外のネットワーク間を繋ぐ。ブロードバンドルーターであれば有線、Wifiルーターであれば無線で接続することになる。 |

#### ▼ ルーティング

受信した通信を適切な宛先に転送すること。通信の宛先を制御することを表す場合、単に『転送する』よりも『ルーティングする』と表現した方が良い。

> ℹ️ 参考：https://www.infraexpert.com/study/routing.html

#### ▼ ホップバイホップルーティング

ネットワーク内でルーターがルーターに通信をルーティングする時、各ルーターが最適なルーティング先を選択すること。

> ℹ️ 参考：https://ascii.jp/elem/000/000/444/444681/3/

![router_hop-by-hop-routing](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/router_hop-by-hop-routing.jpeg)

<br>

### NATルーター

#### ▼ NATルーターとは

NATの機能を持つルーターのこと。

#### ▼ NAT（静的NAT）：Network Address Transalation

![nat-router](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/nat-router.png)

| 設置場所                                                 | 機能                                                         |
| -------------------------------------------------------- | ------------------------------------------------------------ |
| パブリックネットワークとプライベートネットワークの境目   | NATルーターがグローバルIPアドレスを持ち、パブリックネットワークとプライベートネットワークの双方向への通信時に、プライベートIPアドレスに相互変換する。 |
| プライベートネットワークとプライベートネットワークの境目 | NATルーターがプライベートIPアドレスを持ち、プライベートネットワークとプライベートネットワークの双方向への通信時に、プライベートIPアドレスに相互変換する。 |

種類の異なるネットワーク間で、IPアドレスを相互変換する。1つのIPアドレスに対して、1つの内部IPアドレスを紐付けられる。図で言う上側のアウトバウンド通信時の送信元IPアドレスの変換を『SNAT』といい、下側のインバウンド通信時の送信先IPアドレスの変換を『SNAT』という。1つの通信で両方が必要である。

> ℹ️ 参考：
>
> - https://www.vtv.co.jp/intro/mcu/about_mcu9-3.html
> - https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1282815592

#### ▼ 外部IPアドレス、内部IPアドレス、ターゲットIPアドレス

かなり重要。NATルーターの文脈で、外部IPアドレス、内部IPアドレス、ターゲットIPアドレスという用語が使用されることがある。これは、DNATとSNATで意味合いが異なることに注意する。

| 場合       | 外部IPアドレス                                               | 内部IPアドレス                                               | ターゲットIPアドレス                                         |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| DNATの場合 | NATルーターが同一ネットワーク内に公開するIPアドレス。        | NATルーターを通過した後、送信先IPアドレスがこれに書き換えられる。 | 無し                                                         |
| SNATの場合 | NATルーターが同一ネットワーク内に公開するIPアドレス。NATルーターを通過した後、送信元IPアドレスがこれに書き換えられる。 | NATルーターが待ち受ける送信元IPアドレス。そのIPアドレスが送信元に指定されていた場合のみ、ルールが適用される。 | NATルーターが待ち受ける送信先IPアドレス。そのIPアドレスが送信先に指定されていた場合のみ、ルールが適用される。 |

#### ▼ DNAT：Destination NAT

![グローバルからプライベートへのnat変換](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/グローバルからプライベートへのnat変換.png)

NATルーターの機能のうち、送信先IPアドレスを変換すること（```グローバルIPアドレス``` → ```プライベートIPアドレス```、```プライベートIPアドレス``` → ```プライベートIPアドレス```）。NATルーター自体を複数のプライベートネットワークで共有することがある。

> ℹ️ 参考：https://rainbow-engine.com/dnat-snat-difference/

**＊例＊**

NATルーターは、プライベートネットワークに入る時に、パケットのヘッダ情報における『宛先』のグローバルIPアドレスをプライベートIPアドレスに変換する。

#### ▼ SNAT：Source NAT

![プライベートからグローバルへのnat変換](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/プライベートからグローバルへのnat変換.png)

NATルーターの機能のうち送信元IPアドレスを変換すること（```プライベートIPアドレス``` → ```グローバルIPアドレス```、```プライベートIPアドレス``` → ```プライベートIPアドレス```）。NATルーター自体を複数のプライベートネットワークで共有することがある。

> ℹ️ 参考：https://rainbow-engine.com/dnat-snat-difference/

  **＊例＊**

NATルーターは、プライベートネットワークから出る時に、パケットのヘッダ情報における『送信元』のプライベートIPアドレスをグローバルIPアドレスに変換する。例えば、GoogleでWebページを見ながら、Gmailアプリケーションを起動している場合、リクエストにおけるパケット情報として…

| 送信元プライベートIPアドレス |  ⇄   | 送信元グローバルIPアドレス |
| :--------------------------: | :--: | :------------------------: |
|      ```192.168.1.1```       |      |      ```200.1.1.1```       |

1. 『送信元プライベートIPアドレス』『送信先グローバルIPアドレス』『メールサーバーでPOP3プロトコルを受信する```110```番ポート』を指定して、メールサーバーにリクエストを送信する。

```yaml
GET https://example.com:110
```

2. 『送信元プライベートIPアドレス』『送信先グローバルIPアドレス』『webサーバーでHTTPプロトコルを受信する```80```番ポート』を指定して、webサーバーにリクエストを送信する。ただし。```80```番ポートは、省略可能。

```yaml
GET https://example.com:80
```

3. 『送信元プライベートIPアドレス』『送信先グローバルIPアドレス』『DNSサーバーでTCPプロトコルを受信する```53```番ポート』を指定して、DNSサーバーにリクエストを送信する。

```yaml
GET https://example.com:53
```

4. これらの『送信元プライベートIPアドレス』が、NATルーターで、グローバルIPアドレスに変換される。

<br>

### NAPTルーター

#### ▼ NAPTルーターとは

NAPTの機能を持つルーターのこと。

#### ▼ NAPT（動的NAT、IPマスカレード）：Network Address Port Translation

![napt-router](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/napt-router.png)

| 設置場所                                                 | 機能                                                         |
| -------------------------------------------------------- | ------------------------------------------------------------ |
| パブリックネットワークとプライベートネットワークの境目   | NAPTルーターがグローバルIPアドレスを持ち、パブリックネットワークとプライベートネットワークの双方向への通信時に、プライベートIPアドレスに相互変換する。 |
| プライベートネットワークとプライベートネットワークの境目 | NAPTルーターがプライベートIPアドレスを持ち、プライベートネットワークとプライベートネットワークの双方向への通信時に、プライベートIPアドレスに相互変換する。 |

『IPマスカレード』ともいう。種類の異なるネットワーク間で、IPアドレスとポート番号を変換すること。1つのIPアドレスに対して、複数の内部IPアドレスを紐付けられる。AWSやGCPなどで使用されているようなNATルーターはこちらであり、IPアドレスとポート番号の両方を指定することにより、VPC内のプライベートIPアドレスに単一のパブリックIPアドレスを割り当てるようになっている。

> ℹ️ 参考：
>
> - https://www.vtv.co.jp/intro/mcu/about_mcu9-3.html
> - https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1282815592

#### ▼ DNAT時の変換

プライベートネットワークから出る時に、パケットのヘッダ情報における『送信元』のプライベートIPアドレスをグローバルIPアドレスに変換する。ただし、異なるプライベートIPアドレスが同じグローバルIPに変換されてしまうため、これを識別するために、ポート番号を複数の異なるポート番号に変換し、グローバルIPアドレスに付け加える。

**＊例＊**

| 送信元プライベートIPアドレス | 変換前ポート番号 |  ⇄   | 送信元グローバルIPアドレス | 変換後ポート番号 |
| :--------------------------: | :--------------: | :--: | :------------------------: | :--------------: |
|      ```192.168.2.1```       |   ```50011```    |      |   ```130.X.X.X:50011```    |   ```50011```    |
|      ```192.168.3.1```       |   ```50011```    |      |   ```130.X.X.X:50012```    |   ```50012```    |

![napt変換](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/napt変換.png)

#### ▼ SNAT時の変換

プライベートネットワークに入る時に、付け加えられたポート番号を元に、パケットのヘッダ情報における『宛先』のグローバルIPアドレスを、異なるプライベートIPアドレスに変換し分ける。

![napt変換_2](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/napt変換_2.png)

<br>

## 02-03. フォワード/リバースプロキシサーバー

### 機能

#### ▼ 代理ルーティング

![フォワードプロキシサーバーとリバースプロキシサーバー](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/フォワードプロキシサーバーとリバースプロキシサーバー.png)

> ℹ️ 参考：https://qiita.com/att55/items/162950627dc593c72f23

| サーバー名                 | 機能                                                         |
| -------------------------- | ------------------------------------------------------------ |
| フォワードプロキシサーバー | 特定のクライアントのアウトバウンド通信を、不特定多数のサーバーに代理でルーティングする。 |
| リバースプロキシサーバー   | 不特定のクライアントからのインバウンド通信を、特定のサーバーに代理でルーティングする。 |

#### ▼ キャッシュ

![プロキシサーバーのキャッシュ機能](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/プロキシサーバーのキャッシュ機能.png)

> ℹ️ 参考：https://software.fujitsu.com/jp/manual/manualfiles/M100003/B1WN9491/07Z201/ihs02/ihs00016.htm

| サーバー名                 | 機能                                                         |
| -------------------------- | ------------------------------------------------------------ |
| フォワードプロキシサーバー | クライアント側にて、代理ルーティングのレスポンスのキャッシュを作成する。 |
| リバースプロキシサーバー   | サーバー側にて、代理ルーティングのレスポンスのキャッシュを作成する。 |

<br>

### 設置場所

#### ▼ 物理サーバーの場合

フォワードプロキシサーバーはプロバイダの会社に、リバースプロキシサーバーはリクエスト先の社内ネットワークに設置されている。

![proxy-server](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/proxy-server.png)

#### ▼ クラウド上の場合

クラウドの場合も、仮想環境が作成されるだけで、設置場所は同じである。

<br>

## 03. WAN：Wide Area Network

### WANとは

![network_wan](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/network_wan.png)

異なるLAN間のハブになるネットワークのこと。インターネットサービスプロバイダーがサービスとして提供している。WAN内では、各LANはグローバルIPアドレスで識別されている。各LANがWANに接続するためには、DTE（例：ブロードバンドルーター、Wifiルーター）、DCE（例：モデム）、電柱にあるアクセス回線、が必要になる。

> ℹ️ 参考：
>
> - https://qiita.com/hymnofpeace/items/7f09a7a10e843552a8cb
> - https://xtech.nikkei.com/it/article/COLUMN/20080715/310872/

<br>

### WANの歴史

![network_wan_history](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/network_wan_history.png)

<br>

### WANの種類

#### ▼ 専用線方式

データの送信元と送信先が決まっており、特定のユーザーがアクセス回線を専有する。他のLANから閉じられた専用のアクセス回線であり、特定のLAN間でのみデータ通信を行う。

> ℹ️ 参考：http://makiyamashinji.web.fc2.com/emprus/design/wan.html

#### ▼ 回線交換方式

データの送信元と送信先が決まっておらず、複数のユーザーでWAFを共有する。ただし、特定のユーザーのデータがアクセス回線を通過している間、他のユーザーはアクセス回線を使用できない。少数対少数でデータ通信を行うため、送信時に、送信者と受信者の宛先情報は不要である。

> ℹ️ 参考：
>
> - https://www.itpassportsiken.com/kakomon/28_haru/q71.html
> - https://www.infraexpert.com/study/wan3.html

![waf_circuit-switching-system](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/waf_circuit-switching-system.png)

#### ▼ パケット交換方式

パケット化されたデータの送信元と送信先が決まっておらず、複数のユーザーでWAFを共有する。複数のユーザーでアクセス回線を同時に使用できる。対多数でデータ通信を行うため、送信時に、送信者と受信者の宛先情報が必要になる。

> ℹ️ 参考：
>
> - https://www.itpassportsiken.com/kakomon/28_haru/q71.html
> - https://www.infraexpert.com/study/wan3.html

![waf_packet-switching-system](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/waf_packet-switching-system.png)

<br>

## 04. IPアドレス

### IPアドレスとは

ネットワーク内の機器の位置情報のこと。ネットワーク内のLAN内のルーターを境に、グローバルIPアドレスとプライベートIPアドレスに分けられる。IPアドレスの例示では、```x```を使用しないようにする。

> ℹ️ 参考：https://qiita.com/Targoyle/items/1c5454a41ea4519b0c5f

![ip-address](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/ip-address.png)

<br>

### IPアドレスの種類

#### ▼ グローバルIPアドレス

プロバイダが提供するIPアドレスである。パブリックネットワーク内に同じIPアドレスは存在せず、Network Information Centerへの使用申請が必要。プライベートIPアドレスの番号でなければ、グローバルIPアドレスである。NATはグローバルIPアドレスを持っており、プライベートネットワークとプライベートネットワーク間の双方向への通信時に、プライベートIPアドレスと相互変換する。

#### ▼ プライベートIPアドレス

LAN内で使用される。異なるプライベートネットワーク間では、同じIPアドレスが存在する。プライベートIPアドレスは、RFC1918で推奨された範囲を使用することが多い。

> ℹ️ 参考：https://atmarkit.itmedia.co.jp/aig/06network/privateip.html

| RFC1918推奨のCIDRブロック | IPアドレス                                | 個数           |
| ------------------------- | ----------------------------------------- | -------------- |
| ```10.0.0.0/8```          | ```10.0.0.0``` ～ ```10.255.255.255```    | ```16777216``` |
| ```172.16.0.0/12```       | ```172.16.0.0``` ~ ```172.31.255.255```   | ```1048576```  |
| ```192.168.0.0/16```      | ```192.168.0.0``` ~ ```192.168.255.255``` | ```65536```    |

  <br>

### bitとの関係

例えば、プライベートIPアドレスの```4```個のオクテット（第一オクテットから第四オクテットまで）が```1```Byteのサイズをもち、IPアドレス全体で```4```Byteのサイズを持つ。ちなみに、```172```から始まるIPアドレスは、クラスBである。

![IPアドレスとbitの関係](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/IPアドレスとbitの関係.png)

<br>

### ネットワーク部、ホスト部

#### ▼ ネットワーク部、ホスト部とは

IPアドレスのオクテットは、ネットワーク部とホスト部に分類できる。

> ℹ️ 参考：https://qiita.com/mogulla3/items/efb4c9328d82d24d98e6

![ip-address_portion](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/ip-address_portion.png)

#### ▼ クラスによるホスト部とネットワーク部の定義

IPアドレスをクラスとして分類し、各クラスでIPアドレスのネットワーク部とホスト部を定義する方法。設定したIPアドレスの属するクラスによって、使用できるIPアドレスの範囲が決まってしまう。ホスト部とネットワーク部の定義方法が4種類しかないため、IPアドレスのパターン数（最大パソコン数）が多すぎたり、少なすぎたりしてしまう。

|        使用できるIPアドレスの範囲        | クラス | ネットワーク部のオクテット | ホスト部のオクテット |             二進数で見た時（n：ネ、h：ホ）              | IPアドレスのパターン数（最大パソコン数） |     備考     |
| :--------------------------------------: | :----: | :------------------------: | -------------------- |:-----------------------------------------:| :--------------------------------------: | :----------: |
|  ```0.0.0.0``` 〜 ```127.255.255.255```  |   A    |          第一のみ          | 第二から第四         | ```0*.*.*.*``` |      ```2^24```（```16777216```）個      |      -       |
| ```128.0.0.0``` 〜 ```191.255.255.255``` |   B    |        第一から第二        | 第三から第四         | ```10*.*.*.*``` |       ```2^16```（```65536```）個        | よく使用する |
| ```192.0.0.0``` 〜 ```223.255.255.255``` |   C    |        第一から第三        | 第四のみ             | ```110*.*.*.*``` |         ```2^8```（```256```）個         |      -       |
| ```224.0.0.0``` 〜 ```239.255.255.255``` |   D    |             -              | -                    |             ```1110*.*.*.*```             |                    -                     |      -       |
| ```240.0.0.0``` 〜 ```255.255.255.255``` |   E    |             -              | -                    |             ```1111*.*.*.*```             |                    -                     |      -       |

#### ▼ サブネットマスクよるネットワーク部とホスト部の定義

『```1```』あるいは『```0```』で、IPアドレスのネットワーク部とホスト部を定義し、IPアドレスの後ろに記述する方法（例：```192.168.42.23/24```）。設定したIPアドレスに対して、使用できるIPアドレスの範囲を自由に定義できる。ネットワーク部を『```1```』、ホスト部を『```0```』で表す。サブネットマスクの表記方法には、二進数形式、IPアドレス形式、```1```の個数で表すCIDR形式による表現方法がある。

|                   二進数形式                    |        IPアドレス形式        |  CIDR形式   | IPアドレスのパターン数（最大PC数） | 備考       |
|:------------------------------------------:|:----------------------:|:---------:|:-------------------:|----------|
| ```/10000000.00000000.00000000.00000000``` |    ```/128.0.0.0```    | ```/1```  |                     |          |
| ```/11000000.00000000.00000000.00000000``` |    ```/192.0.0.0```    | ```/2```  |                     |          |
|                    ...                     |          ...           |    ...    |                     |          |
| ```/11111111.00000000.00000000.00000000``` |    ```/255.0.0.0```    | ```/8```  | ```2^24```<br>（```16777216```）個 |          |
|                    ...                     |          ...           |    ...    |                     |          |
| ```/11111111.11111110.00000000.00000000``` |   ```/255.254.0.0```   | ```/15``` |                     |          |
| ```/11111111.11111111.00000000.00000000``` |   ```/255.255.0.0```   | ```/16``` |  ```2^16```<br>（```65536```）個   | よく使用する範囲 |
|                                            |          ...           |    ...    |                     |          |
| ```/11111111.11111111.11111110.00000000``` |  ```/255.255.254.0```  | ```/23``` |                     |          |
| ```/11111111.11111111.11111111.00000000``` |  ```/255.255.255.0```  | ```/24``` |    ```2^8```<br>（```256```）個    |          |
|                    ...                     |          ...           |    ...    |                     |          |
| ```/11111111.11111111.11111111.11111110``` | ```/255.255.255.254``` | ```/31``` |                     |          |
| ```/11111111.11111111.11111111.11111111``` | ```/255.255.255.255``` | ```/32``` |         ```1```個          | よく使用する範囲 |

**＊例＊**

プライベートIPアドレスが```192.168.0.0```（```11000000.10101000.00000000.00000000```）で、使いたいIPアドレスのパターン数が65536個、または16777216個の場合、サブネットマスクの表記、使用できるIPアドレスの範囲は以下の様になる。

| 使いたいIPアドレスのパターン数 |                 二進数形式による表記                  |          IPアドレス形式           |       CIDR形式       |      |         使用できるIPアドレスの範囲          |
| ------------------------------ | :---------------------------------------------------: | :-------------------------------: | :------------------: | ---- | :-----------------------------------------: |
| ```16777216```個                     | ```192.168.0.0/11111111.00000000.00000000.00000000``` |    ```192.168.0.0/255.0.0.0```    | ```192.168.0.0/24``` | ⇒    |  ```192.168.0.1``` 〜 ```192.168.0.254```   |
| ```65536```個                        | ```192.168.0.0/11111111.11111111.00000000.00000000``` |   ```192.168.0.0/255.255.0.0```   | ```192.168.0.0/16``` | ⇒    | ```192.168.0.1``` 〜  ```192.168.255.254``` |
| ```1```個                            | ```192.168.0.0/11111111.11111111.11111111.11111111``` | ```192.168.0.0/255.255.255.255``` | ```192.168.0.0/32``` | ⇒    |              ```192.168.0.0```              |

<br>

## 04-02. URL、メールアドレス

### URL、メールアドレスとは

ネットワーク内での位置情報であるIPアドレスに紐づき、ネットワーク上のIPアドレスの場所を人間にわかる識別子にしたもの。

> ℹ️ 参考：https://xtech.nikkei.com/atcl/nxt/column/18/00780/062000012/

<br>

### 構造

URLは『```プロトコル + 完全修飾ドメイン名 + パス```』から、メールアドレスは『```ユーザ名 + 完全修飾ドメイン名```』から構成される。

![URLと電子メールの構造](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/URLと電子メールの構造.png)

<br>

### 完全修飾ドメイン名

#### ▼ 完全修飾ドメイン名の構成

完全修飾ドメイン名は、所属ネットワークを指すドメイン名と、そのネットワークにおける具体的なサーバーを指すホスト名からなる。ただし、サーバーのホスト名が『www』である場合、クライアントはURLの指定時にホスト名を省略できる。例えば、『```www.example.com```』という完全修飾ドメイン名をURLで指定する場合、『```example.com```』としても良い。

> ℹ️ 参考：https://ascii.jp/elem/000/000/419/419685/2/

![domain_namespace](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/domain_namespace.png)

#### ▼ サブドメイン

完全修飾ドメイン名は、ドメイン名の子関係にあるサブドメイン名を持てる。ホスト名（以下では省略されている）と、ドメイン名の間につける。

![サブドメイン](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/サブドメイン.png)

<br>

## 04-03. 名前解決

### 名前解決、正引き、逆引きとは

![IPアドレスと完全修飾ドメイン名のマッピング1](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/IPアドレスと完全修飾ドメイン名のマッピング4.png)

URLやメールアドレスのドメイン名とIPアドレスを相互変換すること。特に、ドメイン名を基にIPアドレスを返却させるような問い合わせを『正引き』、反対にIPアドレスを基にドメイン名を返却させるような問い合わせを『逆引き』という。例えば、外部webサーバーのグローバルIPアドレスが『203.142.205.139』であると知っている場合、URLのプロトコル部分以下を『```203.142.205.139```』としてリクエストすれば、外部webサーバーが提供するサイトにアクセスできる。しかし、グローバルIPアドレスは数字の羅列であるため、人間には覚えにくい。そこで、グローバルIPアドレスの代わりに、完全修飾ドメイン名をURLの一部として使用する。

> ℹ️ 参考：
>
> - https://xtech.nikkei.com/atcl/nxt/column/18/00780/062000012/
> - https://www.kagoya.jp/howto/it-glossary/network/nameresolution/

<br>

### 名前解決の要素

#### ▼ ```/etc/hosts```ファイル

ドメイン名とIPアドレスのマッピングを管理する。名前解決でDNSサーバに問い合わせる前に参照される。もし```/etc/hosts```ファイルで名前解決が行われた場合は、DNSサーバば使用されない。webサーバーのIPアドレスがDNSサーバーに登録されていない時、またはDNSサーバーが不具合の時に、DNSサーバーの代わりとして使用する。

> ℹ️ 参考：https://www.looklinux.com/etchosts-vs-etcresolv-conf-in-linux/

**＊実行例＊**

```bash
127.0.0.1 localhost
255.255.255.255	broadcasthost
::1             localhost
*.*.*.* example.com
<IPアドレス> <ドメイン名>
```

#### ▼ ```/etc/resolv.conf```ファイル

名前解決に使用するDNSサーバーのIPアドレスや、問い合わせで使用するドメイン名の後に付与する文字列を定義する。名前解決では、まず最初に、```/etc/resolv.conf```ファイルに定義されたDNSサーバに問い合わせる。

> ℹ️ 参考：https://linuc.org/study/knowledge/507/

**＊例＊**

もし、```example```というドメイン名で問い合わせを行った場合、実際には```example.foo```が使用される。また、この問い合わせに失敗した場合は、```search```値が左から順に使用される。

```bash
nameserver  *.*.*.*
domain      foo # ドメイン名の後に付与する文字列
search      bar   baz # domain値で問い合わせに失敗した場合に使用する文字列
```

```bash
$ nslookup example # 実際には、example.fooとなる
```

#### ▼ DNSサーバー（ネームサーバー、権威DNSサーバー）

『ネームサーバー』『権威DNSサーバー』ともいう。ドメイン名とIPアドレスのマッピングを管理する。

> ℹ️ 参考：https://www.quora.com/What-is-the-difference-if-any-between-DNS-server-and-name-server

#### ▼ キャッシュDNSサーバー

ルートサーバーは世界に13機しか存在しておらず、現実的には、世界中の名前解決の全てのリクエストを処理できない。そこで、IPアドレスとドメイン名の関係をキャッシュするキャッシュDNSサーバーが使用されている。基本的には、キャッシュDNSサーバーとDNSサーバーは区別される。ただし、Amazon Route53のように、キャッシュDNSサーバーとDNSサーバーの機能を両立しているものもある。

<br>

### 名前解決の仕組み

![名前解決の仕組み](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/名前解決の仕組み.png)

（１）クライアントPCは、```www.example.com```にマッピングされるIPアドレスのキャッシュを検索する。キャッシュが無ければ、クライアントPCはドメイン名をキャッシュDNSサーバーに問い合わせる。

（２）キャッシュDNSサーバーは、IPアドレスのキャッシュを検索する。キャッシュが無ければ、キャッシュDNSサーバーはドメイン名をDNSサーバーに問い合わせる。

（３）DNSサーバーは、IPアドレスを検索する。また、キャッシュDNSサーバーにこれを返却する。

|      完全修飾ドメイン名      | DNSサーバー |     IPアドレス      |
| :--------------------------: | :-------------: | :-------------------: |
| ```http://www.example.com``` |        ⇄        | ```203.142.205.139``` |

（４）キャッシュDNSサーバーは、IPアドレスをNATに返却する。この時、IPv4アドレスのネットワーク間変換が起こる。

（５）NATは、IPアドレスをクライアントPCに返却する。

（６）クライアントPCは、返却されたIPアドレスを基にWebページにリクエストを送信する。

<br>

## 05. 通信の方向/位置

### インバウンド/アウトバウンド

![inbound_outbound](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/inbound_outbound.png)

サーバーを中心とした方向で通信を見た時、サーバーに流入する方向をインバウンドという。反対に、サーバーから流出する方向をアウトバウンドという。

> ℹ️ 参考：
>
> - https://www.amazon.co.jp/dp/B0043D2EKO/
> - https://www.oreilly.com/library/view/http-the-definitive/1565925092/ch03s01.html

<br>

### アップストリーム/ダウンストリーム

![upstream_downstream](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/upstream_downstream.png)

通信の送受信全体の中の位置で通信を見た時、通信が送信された前半の位置を相対的にアップストリームという。反対に、通信が受信される後半の位置を相対的にダウンストリームという。

> ℹ️ 参考：
>
> - https://www.amazon.co.jp/dp/B0043D2EKO/
> - https://www.oreilly.com/library/view/http-the-definitive/1565925092/ch03s01.html

<br>

## 06. ネットワーク速度の指標

### 指標の種類

| 指標名                      | 説明                                                         | 補足                                                         |
| --------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| レスポンスタイム            | リクエストを送信してから、サーバーが処理を実行し、レスポンスが返信されるまでに要する時間のこと。 |                                                              |
| レイテンシー                | リクエストを送信してから、レスポンスが返信されるまで要する時間のこと。サーバーの処理時間は含まない。 |                                                              |
| Connection Time（接続時間） | リクエストを送信する前に、サーバーとのTCP接続の確立に要する時間のこと。 | リクエストとレスポンスの送受信の前後に行われるTCP接続の確立を『スリーウェイハンドシェイク』という。 |
| Bandwidth（帯域幅）         | 一度に送受信できるデータの最大サイズのこと。                   |                                                              |
| スループット（伝送速度）    | 単位時間当たりの送信できる最大のデータサイズのこと。           | 他からの影響を受けた実際のスループットを『実効スループット』という。 |

<br>

### スループット（伝送速度）

#### ▼ 伝送とは

サーバーからクライアントPCにデータを送信すること。相互の送信は、通信と呼ぶ。

#### ▼ スループットとは

単位時間当たりの送信できる最大のデータサイズのこと。実際には、スループットは、『プロバイダ』、『光回線』、『自宅の有線/無線』の```3```個に影響されるため、スループットで期待されるデータサイズを満たせないことが多い。実際のスループットを『実効スループット』という。

![伝送速度](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/伝送速度.png)

#### ▼ 伝送秒数の求め方

```mathematica
(伝送秒数)
= データサイズ(bit) ÷ スループット(bit/s) × 伝送効率
```

#### ▼ トラフィックとは

とあるネットワーク地点でのスループットのこと。

> ℹ️ 参考：https://xtech.nikkei.com/it/article/Keyword/20070222/262872/

![トラフィック](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/トラフィック.png)

総務省のデータで、日本のブロードバンド大手5社の総トラフィックを年次でグラフ化したものがある。

> ℹ️ 参考：https://xtech.nikkei.com/atcl/nxt/column/18/00525/112900001/

![トラフィックのグラフ](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/トラフィックのグラフ.png)

<br>
