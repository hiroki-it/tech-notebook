---
title: 【IT技術の知見】パッケージ管理＠Python
description: パッケージ管理＠Pythonの知見を記録しています。
---

# パッケージ管理＠Python

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

> - https://hiroki-it.github.io/tech-notebook/

<br>

## 01. PIP：Package Installer for Python

### セットアップ

> - https://pip.pypa.io/en/stable/installation/

<br>

### `requirements.txt` ファイル

要件とするパッケージのバージョンを指定する。

```requirements
flask==3.0.2
flask-bootstrap==3.3.7.1
flask-json==0.4.0

...
```

<br>

### `pip.conf` ファイル

`pip` コマンドのオプションを設定する。

```ini
[global]
break-system-packages = true
timeout = 60
```

> - https://pip.pypa.io/en/stable/topics/configuration/

<br>

## 01-02. pipコマンド

### cache

#### ▼ purge

全てパッケージのキャッシュを削除する。

```bash
$ pip3 cache purge
```

> - https://qiita.com/yknaka_/items/d9f444f37cb418088081#pip201%E4%BB%A5%E9%99%8D%E3%81%AE%E5%A0%B4%E5%90%88

#### ▼ remove

指定したパッケージのキャッシュを削除する。

```bash
$ pip3 cache remove <パッケージ名>
```

> - https://qiita.com/yknaka_/items/d9f444f37cb418088081#pip201%E4%BB%A5%E9%99%8D%E3%81%AE%E5%A0%B4%E5%90%88

<br>

### check

#### ▼ checkとは

インストールされているパッケージ間の依存関係を正しく解決できるか否かを確認する。

```bash
$ pip3 check

No broken requirements found.
```

解決できなかった場合は、以下のようなエラーが出力される。

```bash
$ pip3 check

wagtail 2.6.1 has requirement django-modelcluster<5.0,>=4.2, but you have django-modelcluster 5.0.
```

<br>

### install

#### ▼ installとは

指定したパッケージをインストールする。

```bash
$ pip3 install <パッケージ名>
```

> - https://pip-python3.readthedocs.io/en/latest/reference/pip_install.html#pip-install

#### ▼ --upgrade

pip自身を含む、指定したパッケージをアップグレードする。

アップグレード後は、`pip3 check` コマンドで依存関係が正しいかを確認し、`pip3 freeze` コマンドで要件ファイルも更新する必要がある。

```bash
$ pip3 install --upgrade <パッケージ名>

# 依存関係を確認する。
$ pip3 check

# 要件ファイルを更新する。
$ pip3 freeze > requirements.txt
```

アップグレードできるパッケージを一括でアップグレードする場合は、パイプラインと組み合わせる必要がある。

```bash
$ pip3 freeze --local \
    | grep -v '^\-e' \
    | cut -d = -f 1  \
    | xargs -n1 pip3 install -U
```

> - https://gist.github.com/e8l/c20ab194091dd02fafe7

pip自身をアップグレードする。

```bash
$ pip3 install --upgrade pip
```

> - https://stackoverflow.com/questions/56499418/what-is-the-use-of-upgrading-pip

#### ▼ --user

```bash
$ pip3 install --user <パッケージ名>
```

#### ▼ -r

バージョン管理とrequirements.txtファイルを元にパッケージをインストールする。

```bash
$ pip3 install -r requirements.txt
```

指定したディレクトリにパッケージをインストールもできる。

```bash
$ pip3 install -r requirements.txt --prefix=/usr/local
```

<br>

### freeze

#### ▼ freezeとは

pipでインストールされたパッケージを元に、要件ファイルを作成する。

```bash
# インストールのため
$ pip3 freeze > requirements.txt

# 上書きする場合
$ pip3 freeze >| requirements.txt
```

```bash
# アンインストールのため
$ pip3 freeze > uninstall.txt
```

> - https://pip-python3.readthedocs.io/en/latest/reference/pip_freeze.html

<br>

### list

#### ▼ listとは

現在インストールされているパッケージの一覧を取得する。

```bash
$ pip3 list

Package                    Version
-------------------------- -------
click                      8.0.3
ghp-import                 2.0.2

...

wheel                      0.37.1
zipp                       3.7.0
```

・-o

アップグレードできるパッケージの一覧を取得する。

```bash
$ pip3 list -o

Package            Version Latest Type
------------------ ------- ------ -----
click              8.0.3   8.0.4  wheel
importlib-metadata 4.10.0  4.11.2 wheel

...

pyparsing          3.0.6   3.0.7  wheel
setuptools         60.5.0  60.9.3 wheel
```

<br>

### show

#### ▼ showとは

pipでインストールしたパッケージ情報を取得する。

```bash
$ pip3 show sphinx

Name: Sphinx
Version: 3.2.1
Summary: Python documentation generator
Home-page: http://sphinx-doc.org/
Author: Georg Brandl
Author-email: georg@python.org
License: BSD
# インストール場所
Location: /usr/local/lib/python3.8/site-packages
# このパッケージの依存先
Requires: sphinxcontrib-applehelp, imagesize, docutils, sphinxcontrib-serializinghtml, snowballstemmer, sphinxcontrib-htmlhelp, sphinxcontrib-devhelp, sphinxcontrib-jsmath, setuptools, packaging, Pygments, babel, alabaster, sphinxcontrib-qthelp, requests, Jinja2
# このパッケージを依存先としているパッケージ
Required-by: sphinxcontrib.sqltable, sphinx-rtd-theme, recommonmark
```

> - https://pip-python3.readthedocs.io/en/latest/reference/pip_show.html

<br>

### uninstall

#### ▼ uninstallとは

指定したパッケージをアンインストールする。

キャッシュが残っているので、`pip3 cache remove` コマンドで指定したパッケージのキャッシュも削除しておく。

```bash
$ pip3 uninstall -y <パッケージ名>

$ pip3 cache remove <パッケージ名>
```

`uninstall.txt` ファイルを元にパッケージをアンインストールもできる。

キャッシュが残っているので、`pip3 cache purge` コマンドでキャッシュも全て削除しておく。

```bash
$ pip3 uninstall -y -r uninstall.txt

$ pip3 cache purge
```

> - https://pip-python3.readthedocs.io/en/latest/reference/pip_uninstall.html

<br>

## 02. PIP Compile

### セットアップ

> - https://pip.pypa.io/en/stable/installation/

<br>

### `requirements.in` ファイル

`requirements.txt` ファイルの元になるファイル。

記法は `requirements.txt` ファイルと同じである。

```requirements
flask==3.0.2
flask-bootstrap==3.3.7.1
flask-json==0.4.0

...
```

`pip-compile` コマンドを実行すると、`requirements.txt` ファイルを作成できる。

```requirements
#
# This file is autogenerated by pip-compile with Python 3.13
# by the following command:
#
#    pip-compile --generate-hashes requirements.in
#
flask==3.0.2 \
    --hash=sha256:3232e0e9c850d781933cf0207523d1ece087eb8d87b23777ae38456e2fbe7c6e \
    --hash=sha256:822c03f4b799204250a7ee84b1eddc40665395333973dfb9deebfe425fefcb7d
    # via
    #   -r requirements.in
    #   flask-bootstrap
    #   flask-json
flask-bootstrap==3.3.7.1 \
    --hash=sha256:cb08ed940183f6343a64e465e83b3a3f13c53e1baabb8d72b5da4545ef123ac8
    # via -r requirements.in
flask-json==0.4.0 \
    --hash=sha256:07945d66024f3b77694ce1db5d1fe83940f2aa3bcad8a608535686be67e4bc48 \
    --hash=sha256:1c1b87a657daa2179fc19f1ffc78204a716c7c5139673dc5038772db4d9f1988
    # via -r requirements.in

...

```

<br>

### 02-02. pip-compileコマンド

#### ▼ --generate-hashes

```bash
$ pip-compile --generate-hashes requirements.in
```

> - https://pip-tools.readthedocs.io/en/latest/cli/pip-compile/

#### ▼ --dry-run

```bash
$ pip-compile --generate-hashes requirements.in --dry-run
```

> - https://pip-tools.readthedocs.io/en/latest/cli/pip-compile/

<br>
