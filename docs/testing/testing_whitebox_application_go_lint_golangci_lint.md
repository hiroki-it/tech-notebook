---
title: 【IT技術の知見】golangci-lint＠静的解析
description: golangci-lint＠静的解析の知見を記録しています。
---

# golangci-lint＠静的解析

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

> - https://hiroki-it.github.io/tech-notebook/

<br>

## 01. golangci-lintとは

Goの様々な静的解析ツールをまとめて実行できる。

<br>

## 02. CIへの導入

### GitLab CI

```yaml
variables:
  GO_VERSION: "1.19.13"

stages:
  - lint

golangci:
  stage: lint
  image: golangci/golangci-lint:latest-alpine
  script:
    # 有効にしている静的解析の一覧を表示する
    # GitLab CIでは色が無効になってしまうため、有効化する
    - golangci-lint linters --color always
    # 静的解析を実行する
    - golangci-lint run -v --go ${GO_VERSION}
```

<br>

## 02. .golangci.yml

### run

```yaml
# 実行のオプションを設定する
run:
  concurrency: 4
  timeout: 5m
  issues-exit-code: 2
  # testファイルがあるか否かを設定する
  tests: false
  build-tags:
    - mytag
  skip-dirs:
    - src/external_libs
    - autogenerated_by_my_lib
  skip-dirs-use-default: false
  skip-files:
    - .*\.my\.go$
    - lib/bad.go
  modules-download-mode: readonly
  allow-parallel-runners: false
  allow-serial-runners: true
  print-resources-usage: true
  # Goのバージョンを指定する
  go: 1.20
```

<br>

### output

```yaml
# 結果の出力形式を設定する
output:
  format: json
  print-issued-lines: false
  print-linter-name: false
  uniq-by-line: false
  path-prefix: ""
  sort-results: true
```

<br>

### linters-settings

```yaml
# 使用するリンターにオプションを設定する
linters-settings:
  # staticcheckにオプションを設定する
  staticcheck:
    go: 1.20
    checks: [ "all" ]

  ...

  custom:
    example:
      path: /path/to/example.so
      description: This is an example usage of a plugin linter.
      original-url: github.com/golangci/example-linter
```

<br>

### linters

```yaml
# 使用するリンターを選ぶ
linters:
  disable-all: false
  enable:

    ...

    - gofmt
    - gosec
    - govet

    # staticcheckを使用する
    - staticcheck

    ...

  enable-all: false
  disable:
    - golint

    ...

  presets:
    - bugs
    - comment
    - complexity
    - error
    - format
    - import
    - metalinter
    - module
    - performance
    - sql
    - style
    - test
    - unused
  fast: true
```

<br>

### issues

```yaml
# 検証するルールを設定する
issues:
  exclude:
    - abcdef
  exclude-rules:
    - path: _test\.go
      linters:
        - gocyclo
        - errcheck
        - dupl
        - gosec
    - path-except: _test\.go
      linters:
        - forbidigo
    - path: internal/hmac/
      text: weak cryptographic primitive
      linters:
        - gosec
    - linters:
        - staticcheck
      text: "SA9003:"
    - linters:
        - lll
      source: "^//go:generate "
  exclude-use-default: false
  exclude-case-sensitive: false
  include:
    - EXC0001
    - EXC0002
    - EXC0003
    - EXC0004
    - EXC0005
    - EXC0006
    - EXC0007
    - EXC0008
    - EXC0009
    - EXC0010
    - EXC0011
    - EXC0012
    - EXC0013
    - EXC0014
    - EXC0015
  max-issues-per-linter: 0
  max-same-issues: 0
  new: true
  new-from-rev: HEAD
  new-from-patch: path/to/patch/file
  fix: true
  whole-files: true
```

<br>

### severity

```yaml
# 重要度を設定する
severity:
  default-severity: error
  case-sensitive: true
  rules:
    - linters:
        - dupl
      severity: info
```

> - https://github.com/golangci/golangci-lint/blob/master/.golangci.reference.yml

<br>

## 03. コマンド

### グローバル

#### ▼ --color

コマンドの実行結果に色をつける。

CIによっては、実行時に色がなくなってしまうが、`always`を有効化すると色がつくようになる。

```bash
$ golangci-lint linters --color always
```

<br>

### run

#### ▼ --go

Goのバージョンを指定して実行する。

```bash
$ golangci-lint run --go <バージョン>
```

#### ▼ --config

設定ファイルを指定する。

```bash
$ golangci-lint run --config .golangci.yml
```

<br>

### linters

有効/無効になっている解析の一覧を取得できる。

```bash
$ golangci-lint linters

# Enabled by your configuration linters:
errcheck: errcheck is a program for checking for unchecked errors in Go code. These unchecked errors can be critical bugs in some cases [fast: false, auto-fix: false]
gosimple: Linter for Go source code that specializes in simplifying code [fast: false, auto-fix: false]
govet: Vet examines Go source code and reports suspicious constructs. It is roughly the same as 'go vet' and uses its passes. [fast: false, auto-fix: false]
ineffassign: Detects when assignments to existing variables are not used [fast: true, auto-fix: false]
staticcheck: It's a set of rules from staticcheck. It's not the same thing as the staticcheck binary. The author of staticcheck doesn't support or approve the use of staticcheck as a library inside golangci-lint. [fast: false, auto-fix: false]
unused: Checks Go code for unused constants, variables, functions and types [fast: false, auto-fix: false]

# Disabled by your configuration linters:
asasalint: check for pass []any as any in variadic func(...any) [fast: false, auto-fix: false]
asciicheck: checks that all code identifiers does not have non-ASCII symbols in the name [fast: true, auto-fix: false]

...
```

<br>
