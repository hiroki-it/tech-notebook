# GitHub

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

参考：https://hiroki-it.github.io/tech-notebook-mkdocs/md/about.html

<br>

## 01. 作業者の場合

### Issue

#### ・作成

テンプレートを元に、Issueを作成する。

#### ・削除

リポジトリの管理者権限があれば削除できる。

<br>

### PullReq

#### ・作成

テンプレートを元に、PullReqを作成する。

#### ・削除

不可能のため、クローズするしかない。犯した罪は背負って生きていかなければならない。

参照：https://stackoverflow.com/questions/18318097/delete-a-closed-pull-request-from-github

<br>

### ブランチの種類

#### ・featureブランチ

機能を作成/更新/削除するリクエストを作成するためのブランチ。

#### ・developブランチ（staging）

ステージング環境に機能をデプロイするためのブランチ。stagingブランチとしてもよい。

#### ・mainブランチ

本番環境に機能をデプロイするためのブランチ。productionブランチとしてもよい。

#### ・hotfixブランチ

リリース後に修正点が見つかった場合、修正用ブランチを作成し、これを速やかにリリースする必要がある。

（１）Issueを作成する。

（２）mainブランチから、『```hotfix/<issue番号>```』の名前でブランチを作成する。

（３）PullReqを作成し、マージの向き先を```main```ブランチとする。

（４）速攻でapproveをもらい、mainブランチにマージする。この時、hotfixブランチは後でdevelopブランチにマージするため、削除しないようにする。

（５）パッチ番号を1つ増やしたタグを付与し、再リリースする。

（６）リリース後、エラーが解決されたら、ローカルPCでhotfixブランチをdevelopブランチにマージする。

<br>



### コミットの粒度

データベースからフロント出力までに至る実装をコミットする場合、以下の3つを意識する。

- データベースからコミット
- 関連性のある実装をまとめてコミット
- 一回のコミットがもつコード量が少なくなるようにコミット

<br>

## 01-02. コンフリクトの解決

### 解決方法

#### ・Gitを用いて

（１）```git status```を行い、特定のファイルでのコンフリクトが表示される。

```bash
Unmerged paths:
  (use "git restore --staged <file>..." to unstage)
  (use "git add <file>..." to mark resolution)
        both modified:   foo/bar.twig
```

（２）コンフリクトしていたコード行を取捨選択する。

```php
<?php
/// Phpstromにて、コンフリクトしていたコード行を取捨選択する。
```

（３）一度```add```を行い、コンフリクトの修正をGitに認識させる。

```bash
$ git add foo/bar.twig
```

（４）```git status```を行い、以下が表示される。コンフリクトが解決されたが、マージされていないと出力される。差分のファイルがたくさん表示される場合があるが、問題ない。

```bash
All conflicts fixed but you are still merging.

Changes to be committed:
        modified:   foo.twig
        modified:   foo.php
```

（５）```git commit```（```-m```はつけてはいけない）を行い、vimエディタが表示される。

```bash
 Merge branch "ブランチ名" into ブランチ名
```

（６）```:wq```でエディタを終了すれば、コンフリクトを解決したマージコミットが作成される。

（７）```git status```を行う。場合によっては、差分のコミット数が表示されるが問題ない。

```bash
Your branch is ahead of "origin/feature/update_foo" by 10 commits.

```

（８）プッシュする。この時、マージコミットを作成する時、基点ブランチ以外からマージしていると、差分のコミットが1つにまとまらず、

参考：http://www-creators.com/archives/1938

#### ・GitHubを用いて

PullReq上に『Resolve conflicts』ボタンが出現し、ここからコンフリクトを修正できる。

参考：

- https://docs.github.com/ja/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/resolving-a-merge-conflict-on-github
- https://qiita.com/Kto_pi/items/4fd6bdec72e852763315

#### ・エディタを用いて

エディタの例として、PHPStormを用いる。一番簡単かもしれない。

<br>

### ブランチの特徴別対応方法

#### ・feature vs. develop

featureブランチからdevelopブランチへのマージ時にコンフリクトが起きた場合、featureブランチ上のファイルでコンフリクトを解決し、PullReq上にそのままプッシュする。

#### ・develop vs. main

developブランチからmainブランチへのマージ時にコンフリクトが起きた場合、一旦developブランチからコンフリクト解決用のブランチを作成する。このfeatureブランチ上のファイルでコンフリクトを解決し、PullReqを新たに作成する。

<br>

### 基点ブランチからの変更の取り込み

一つの基点ブランチから数段階の派生ブランチが作成されている場合、基点ブランチから一段目、一段目から二段目、というように順にマージを行わないと、コンフリクトの原因になる。

（１）基点ブランチから、一段目の派生ブランチにマージし、これをプッシュする。ここでプッシュしないと、2番目のブランチが1つ目のブランチとの差分を検出してしまい、大量の差分コミットがgithubに表示されてしまう。

（２）一段目のブランチから二段目のブランチにマージし。これをプッシュする。

<br>

## 02. レビュアーの場合

### レビュー観点

#### ・ビジネスルールや仕様通りか

実装の条件文や、コメントから、ビジネスルールや仕様を理解する。

1. 条件文で```var_dump```メソッド を行う。
2. どういった入力がされた時に```true``` として判断しているのかを確認。例えば、受注済区分値が設定されているときに、それが失注区分値に変わった場合、値を返却しているならば、そこから、『失注』のビジネスルールが垣間見える。
3. 定数に添えられたコメントから、仕様を理解。

#### ・バリデーションは適切か

正しく区別して```empty```メソッド や```isset```メソッド などを使えているかを確認する

#### ・冗長になっていないか

重複する処理を```foreach```メソッドにまとめられないかを確認する。また、変数の格納が重複していないかを確認する。

<br>

## 03. テンプレート

### 配置場所

リポジトリの直下に```.github```ディレクトリを配置し、```ISSUE_TEMPLATE.md```や```PULL_REQUEST_TEMPLATE.md```の名前でファイルを置く。Issueのテンプレートに関して、代わりに```ISSUE_TEMPLATE```ディレクトリを置き、任意の名前のmdファイルを置くと、複数のテンプレートを作成できる。

参考：https://qiita.com/nyamogera/items/3fe6985b45fbd5377184

```
project/
└── .github
    ├── ISSUE_TEMPLATE.md
    └── PULL_REQUEST_TEMPLATE.md
```

```
project/
└── .github
    ├── ISSUE_TEMPLATE
    |   ├── FIX.md
    |   └── UPDATE.md
    |
    └── PULL_REQUEST_TEMPLATE.md
```

<br>

### Issue

#### ・Issueの分割

1つのIssueとブランチにたくさんの実装をコミットすることは望ましくない。そこで、大きな対応を個々の対応に分割する。そして、大きな対応に関する基点Issueと基点ブランチを作成し、個々の対応に関連する子Issueと子ブランチを作成していく。個別の対応が終わったら、親ブランチへマージしていく。

#### ・タイトル

タイトルは『〇〇する。』とする。句読点の有無は好み。

#### ・内容

内容は『背景』と『対応方針』さえ伝われば、文言自体はそのリポジトリのルールに合わせる。

**＊例＊**

```markdown
# 背景
<!-- Issue作成の理由になった要望やバグを記載する -->
<!-- 関連するIssueやPullReqがあればリンクを共有する -->


# 対応方針
<!-- どのような方法で対応する予定なのかを箇条書きで記載する -->
<!-- 方法に関するドキュメントや技術記事があればリンクを共有する -->
```

<br>

### PullReq

#### ・タイトル

タイトルは『〇〇した。』とする。句読点の有無は好み。

#### ・WIP

実装途中のPullReqであり、実装方法などを質問したい場合、タイトルに『WIP』とつけておく。レビューしてもらいたくなったら、これをはずす。レビュー修正時に、実装に時間がかかりそうであったら、再び付けても良い。

#### ・内容

内容は『対応内容』と『レビューしてほしいところ』さえ伝われば、文言自体はそのリポジトリのルールに合わせる。もし、レビュー期限や動作確認手順を知らせる必要があれば『レビュー期限』『確認手順』の項目を設ける。

**＊例＊**

```markdown
# リリース予定日
<!-- リリース予定日を記載する -->


# 対応内容
<!-- どのように対応したのか箇条書きで記載する -->
<!-- 関連するIssueやPullReqがあればリンクを共有する -->


# レビューしていただきたいところ
<!-- 対応内容の中で適切かどうかが不安なものを記載する -->
```



