# SRE：Site Reliability Engineering

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

参考：https://hiroki-it.github.io/tech-notebook-mkdocs/md/about.html

<br>

## 01. SREに関する見解

### SREとは

#### ・参考：サイトリライアビリティエンジニアリング

URL：https://www.amazon.co.jp/dp/4873117917

サイトの信頼性向上を目的としたエンジニアリング手法のこと。

<br>

### サイトの『信頼性』とは

#### ・参考：サイトリライアビリティエンジニアリング

URL：https://www.amazon.co.jp/dp/4873117917

信頼性とは、『システムが求められる機能を、定められた条件下で、定められた期間にわたり、障害を起こすことなく実行する確率』のこと。

#### ・参考：SRE実践の手引

URL：https://eh-career.com/engineerhub/entry/2019/12/05/103000

SREの具体的な行動を明確にするためには、サイトの信頼性を表す指標（SLI）と、指標の具体的な目標値（SLO）を定義する必要がある。エラーバジェットの残量を考慮に入れ、リスクを取りながら、サイトの信頼性の維持に努める。

#### ・参考：SREの基本と組織への導入

URL：https://dev.classmethod.jp/articles/202105-report-gcd21-d3-infra-01/

ソフトウェアの最も重要な機能は信頼性であり、信頼性の程度はサイトのユーザーによって決められるべきである。ユーザーは、SLIを信頼性の指標とし、SLOに至った場合に信頼できるサイトと見なす。

<br>

### SLOとSLIの決め方

#### ・参考：SREの基本と組織への導入

URL：https://dev.classmethod.jp/articles/202105-report-gcd21-d3-infra-01/

クリティカルジャーニーに関連するメトリクスをSLIに選ぶとよい。具体的には、リクエストとレスポンスの可用性/遅延/品質、データ処理のカバレッジ/正確性/鮮度/スループット、ストレージのスループット/遅延、に関するメトリクスが有用である。

<br>

### 信頼性の目標値を達成するための行動

#### ・参考：Site Reliability Engineeringとは

URL：https://www.nic.ad.jp/ja/materials/iw/2017/proceedings/s15/s15-fujisaki.pdf

- 可用性の向上（障害ドメインと更新ドメインを考慮した冗長化）
- パフォーマンスの向上（レイテンシーの抑制 ）
- 開発効率の向上（変更管理、
- 適切なモニタリング
- インシデント管理
- キャパシティプランニング

<br>

### SREが有用な業態/会社組織の特徴

#### ・参考：サイトリライアビリティエンジニアリング

URL：https://www.amazon.co.jp/dp/4873117917

SREが信頼性を向上させるソフトウェアは、サイトやそれに類似するサービスである。原子力発電所、航空機、医療機器、その他安全性が極めて重要なソフトウェアなどの信頼性については考えない。

#### ・参考：SRE実践の手引

URL：https://eh-career.com/engineerhub/entry/2019/12/05/103000

SREには、継続的な改善によって、システムの信頼性を向上させようとする思想がある。そのため、アジャイル開発を採用できないシステム（例：人命にかかわるようなシステム）を扱っている業態や、サイトを扱っていても納品後に改善作業がないような業態（例：受託会社）では、有効に機能しない。また、改善のきっかけは失敗であることが前提にあるため、失敗が許されない文化がある会社組織でも機能しない。

<br>

## 02. SREのアンチパターン集

### 参考：『SREの探求』より

URL：https://www.amazon.co.jp/dp/4873119618

| アンチパターン                                           | 説明                                                         |
| -------------------------------------------------------- | ------------------------------------------------------------ |
| サイトリライアビリティオペレーション                     | SREの対象には開発も含まれ、運用だけではない。勤務時間の半分以上を、優れたソフトウェアやネットワークの開発に割くようにする。 |
| 全てのイベントに手動で対応すること                       | イベントが検知された後に、全てイベントに対して、問題点の判断/タスク化/対応を手動で行うことがないようにする。問題点の対応が自動化可能であれば、自動化しておく。 |
| インシデントに無秩序に対応すること                       | インシデントが起こった時に、組織が無秩序にインシデントに対応しないようにする。インシデントコマンドシステムを用いて、インシデント対応のチームを組織化するようにする。 |
| インシデントの原因をヒューマンエラーにすること           | インシデントが起こった時に、ヒューマンエラーを原因と見なし、責任を追及しないようにする。責任の所在を決めて、インシデントを解決した気になってはならない。あくまで、インシデントを解消することだけに専念する。例えば、Backlogなどのタスクツールに使用すると、インシデントだけに集中できる。 |
| 開発に携わっていない人に運用を任せること                 | オンコールは全てのエンジニアの仕事であり、プロダクト開発チームがSREにオンコールを全て丸投げしないようにする。当番制などで、プロダクト開発者もオンコールに対応する機会を持つようにする。 |
| インシデント担当であることに誇りを持つこと               | インシデントを解消することは素晴らしいが、称賛されることに固執し、自分だけがインシデント担当にならないようにする。当番制でインシデントに担当するようにする。 |
| 何でもかんでも監視すること                               | 何でもかんでも監視すると、アラートだらけになってしまい、作業が中断されてしまう。サイト全体の稼働に関係するようなテレメトリーのみを監視するようにする。 |
| ツールを押し付けること                                   | プロダクト開発チームに開発効率化ツールを押し付けてはいけない。SREはプッシュ型ではなくプル型であり、プロダクト開発チームから課題を吸い出すように行動する必要がある。プロダクト開発チームの課題に合ったツールを開発/導入し、開発効率を上げ、喜ばれることが使命である。 |
| リリース前にインシデントの原因を全て解決しようとすること | インシデントを防ぐためにリリース前にテストを行うことは重要であるが、リリースに慎重になり過ぎる必要はない。リリースが延長されれば、ユーザーのフィードバックの獲得がおくれてしまう。 |
| 障害修復時間を軽視すること                               | 障害を回避することばかりにとらわれ、障害の修復容易性や時間短縮化を疎かにしないこと。障害を回避することはもちろん、障害は起こり得るものとして、これの修復時間を短くすることにも注力する。例えば、Terraformのリリースの粒度をできるだけ小さくすれば、ロールバックの時間を短縮できる。 |
| ソフトウェアのコンポーネント間の依存関係が闇             | ソフトウェアのコンポーネント間の依存関係が闇になってしまうと、これは人間の能力では想定することが不可能になる。コンポーネント間の依存関係をリアルタイムに把握できるような仕組みを持つようにする。 |
| プロジェクト自体に承認/予算/成果物が必要               | プロジェクト自体に承認/予算/成果物の提出のフローが必要になると、継続的なリリースが妨げられる（ウォーターフォール的な開発）。予算を組織にあたえ、開発/改善/リリースに投資するようにさせるべきである（アジャイル的な開発）。 |
| ビジネスとは無関係にSLOを決めること                      | SLOは、プロダクトの利用者に価値あるビジネスを提供するためにある。エンジニアだけで、収集されたテレメトリーからいくつかSLIを選び、それぞれに対して単純にSLOを決めないようにする。そのために、プロダクトの設計段階からビジネスサイドを巻き込み、価値のあるビジネスを提供できるようなSLOを決める。 |
| 公開するAPIのSLOを勝手に決めること                       | APIを公開し、有料でクライアントに用いてもらう場合に、SLOを勝手に決めてはいけない。そのために、クライアントとミーティングを開き、お互いに共通認識を持ってSLOを決めるようにする。 |
| SREによる改善の対象を運用のみと考えること                | SREによって改善するアクションは運用だけではない。組織的な意思決定の方法、ソフトウェア設計構築方法、チーム間のコミュニケーション方法も含まれる。 |

<br>

## 03. ドキュメンテーション

### ドキュメントの種類

| 種類           | 例                                                           |
| -------------- | ------------------------------------------------------------ |
| サービス概要   | アーキテクチャ、コンポーネント間の依存関係、ステークホルダー、プロダクト責任者 |
| 手順書         |                                                              |
| ポストモーテム | 参考：https://hiroki-it.github.io/tech-notebook-mkdocs/md/observability_monitering/monitering.html |
| ポリシー       | リリースノート、命名規則、など                               |
| SLA            | 参考：https://hiroki-it.github.io/tech-notebook-mkdocs/md/observability_monitering/monitering.html |

<br>

### 品質

#### ・品質の種類

| 種類     | 説明                                                         |
| -------- | ------------------------------------------------------------ |
| 構造品質 | 表記と文法の正しさのこと。機能品質よりは重要度が低い。       |
| 機能品質 | ドキュメントの有用さのこと。ドキュメントをソースコードと同じディレクトリなどでバージョン管理し、コードの変更に合わせてドキュメントも変更するようにする。有用性の品質を保つとともに、ドキュメントの場所を明確にする。 |

#### ・品質を保つツールの導入

esaなどのドキュメント作成ツールを用いると、フィードバックをもらいやすくなる、誰でも気軽に作成更新できる、構造/機能品質を高めるための機能がある、ことで、機能品質を高めやすくなる。

<br>

## 04. SREの事例集

### Wantedly

SREチームのValueから、SREの技術的な使命がわかる。

参考：[https://gist.github.com/south37/85d97e02d7816a31053971d63c164880](https://gist.github.com/south37/85d97e02d7816a31053971d63c164880)

<br>

### Topotal

提供しているサービス（SRE as a Service）から、SREの技術的な使命がわかる。

参考：https://topotal.com/services/sre-as-a-service

<br>

## 05. その他

### SREに入門しよう

<iframe class="speakerdeck-iframe" frameborder="0" src="https://speakerdeck.com/player/9ef17a127836454eba769084baddf60f" title="SREに入門しよう" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" style="border: 0px; background: padding-box padding-box rgba(0, 0, 0, 0.1); margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 560px; height: 314px;"></iframe>
