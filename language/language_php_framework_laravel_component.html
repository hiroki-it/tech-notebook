
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="認証/認可＠Laravelの知見を記録しています。">
      
      
        <meta name="author" content="Hiroki Hasegawa">
      
      
        <link rel="canonical" href="https://hiroki-it.github.io/tech-notebook/language/language_php_framework_laravel_component.html">
      
      
        <link rel="prev" href="language_php_logic_debug.html">
      
      
        <link rel="next" href="language_php_framework_laravel_eloquent_orm.html">
      
      
      <link rel="icon" href="../assets/images/logo_v2.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.3.1">
    
    
      
        <title>【IT技術の知見】コンポーネント＠Laravel - 俺の技術ノート</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+Japanese:300,300i,400,400i,700,700i%7CNoto+Sans+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans Japanese";--md-code-font:"Noto Sans Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/css/custom.css">
    
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-HPJGWKTH9W"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-HPJGWKTH9W",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-HPJGWKTH9W",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="dark" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#laravel" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="https://hiroki-it.github.io/tech-notebook/" title="俺の技術ノート" class="md-header__button md-logo" aria-label="俺の技術ノート" data-md-component="logo">
      
  <img src="../assets/images/logo_v2.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            俺の技術ノート
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              【IT技術の知見】コンポーネント＠Laravel
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hiroki-it/" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHubアカウントはこちら
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  当サイトについて

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../about.html" class="md-tabs__link">
        
  
    
  
  『俺』

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../system/index.html" class="md-tabs__link">
          
  
    
  
  🌳 システム

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../software/index.html" class="md-tabs__link">
          
  
    
  
  🧬 ソフトウェア

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../software/application/index.html" class="md-tabs__link">
          
  
    
  
  🚀 アプリ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../software/middleware/index.html" class="md-tabs__link">
          
  
    
  
  🤝🏻 ミドルウェア

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../software/basic/index.html" class="md-tabs__link">
          
  
    
  
  🐧 OS

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="index.html" class="md-tabs__link">
          
  
    
  
  🔠 言語

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../testing/index.html" class="md-tabs__link">
          
  
    
  
  🧪 テスト

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../hardware/index.html" class="md-tabs__link">
          
  
    
  
  💻 ハードウェア

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../network/index.html" class="md-tabs__link">
          
  
    
  
  🌏 ネットワーク

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../security/index.html" class="md-tabs__link">
          
  
    
  
  🔐 セキュリティ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../cloud_computing/index.html" class="md-tabs__link">
          
  
    
  
  ⛅️ 3大クラウド

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../virtualization/index.html" class="md-tabs__link">
          
  
    
  
  📦 仮想化

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../infrastructure_as_code/index.html" class="md-tabs__link">
          
  
    
  
  ⚙️ IaC

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../infrastructure_as_code/kubernetes/index.html" class="md-tabs__link">
          
  
    
  
  ☸️ K8s

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../infrastructure_as_code/kubernetes_addon/index.html" class="md-tabs__link">
          
  
    
  
  ⏬ K8sアドオン

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../infrastructure_as_code/cncf_projects/index.html" class="md-tabs__link">
          
  
    
  
  🌊 CNCF

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../devops/index.html" class="md-tabs__link">
          
  
    
  
  ♾️ DevOps

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../devops/cicd/index.html" class="md-tabs__link">
          
  
    
  
  🔄 CI/CD

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../observability/index.html" class="md-tabs__link">
          
  
    
  
  🔎 可観測性

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../software_development_methodology/index.html" class="md-tabs__link">
          
  
    
  
  👥 開発手法

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://hiroki-it.github.io/tech-notebook/" title="俺の技術ノート" class="md-nav__button md-logo" aria-label="俺の技術ノート" data-md-component="logo">
      
  <img src="../assets/images/logo_v2.png" alt="logo">

    </a>
    俺の技術ノート
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hiroki-it/" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHubアカウントはこちら
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    当サイトについて
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../about.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    『俺』
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../system/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🌳 システム
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../software/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🧬 ソフトウェア
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../software/application/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🚀 アプリ
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../software/middleware/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🤝🏻 ミドルウェア
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../software/basic/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🐧 OS
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    🔠 言語
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_8">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            🔠 言語
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_type.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    言語の種類
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_process_mode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    言語別の処理方式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="language_data_description_language_json.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ データ記述言語
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" checked>
        
          <label class="md-nav__link" for="__nav_8_5" id="__nav_8_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ■ PHP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            ■ PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_php.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_php_command.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コマンド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="language_php_class_based.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ クラスベース
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="language_php_logic_validation.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ ロジック
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5_5" checked>
        
          <label class="md-nav__link" for="__nav_8_5_5" id="__nav_8_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ■ フレームワーク
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_5_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_5_5">
            <span class="md-nav__icon md-icon"></span>
            ■ フレームワーク
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5_5_1" checked>
        
          <label class="md-nav__link" for="__nav_8_5_5_1" id="__nav_8_5_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ■ Laravel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_5_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_5_5_1">
            <span class="md-nav__icon md-icon"></span>
            ■ Laravel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    コンポーネント
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="language_php_framework_laravel_component.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    コンポーネント
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="このページの内容">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      このページの内容
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    はじめに
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#01-laravel" class="md-nav__link">
    01. Laravelの全体像
  </a>
  
    <nav class="md-nav" aria-label="01. Laravelの全体像">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ライフサイクル
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    コンポーネントのコード
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#02-application" class="md-nav__link">
    02. Application
  </a>
  
    <nav class="md-nav" aria-label="02. Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app" class="md-nav__link">
    App
  </a>
  
    <nav class="md-nav" aria-label="App">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    ▼ 設定方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appphp" class="md-nav__link">
    ▼ app.phpファイルの基本設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#03-config" class="md-nav__link">
    03. Config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#04-console" class="md-nav__link">
    04. Console
  </a>
  
    <nav class="md-nav" aria-label="04. Console">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command" class="md-nav__link">
    Command
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#05-database" class="md-nav__link">
    05. Database
  </a>
  
    <nav class="md-nav" aria-label="05. Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db" class="md-nav__link">
    DB
  </a>
  
    <nav class="md-nav" aria-label="DB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    ▼ 設定方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdbredis" class="md-nav__link">
    ▼ RDBとRedisの選択
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    エンドポイントに応じた設定
  </a>
  
    <nav class="md-nav" aria-label="エンドポイントに応じた設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    ▼ 単一のエンドポイント
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    ▼ 複数のエンドポイント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis" class="md-nav__link">
    Redis
  </a>
  
    <nav class="md-nav" aria-label="Redis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    ▼ クエリキャッシュ管理
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#06-eventlistener" class="md-nav__link">
    06. Event/Listener
  </a>
  
    <nav class="md-nav" aria-label="06. Event/Listener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event" class="md-nav__link">
    Event
  </a>
  
    <nav class="md-nav" aria-label="Event">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event_1" class="md-nav__link">
    ▼ Eventとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    ▼ 構成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquentcrud" class="md-nav__link">
    ▼ EloquentモデルのCRUDイベント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listener" class="md-nav__link">
    Listener
  </a>
  
    <nav class="md-nav" aria-label="Listener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listener_1" class="md-nav__link">
    ▼ Listenerとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    ▼ 構成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    ▼ イベントとリスナーの紐付け
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquentcrud_1" class="md-nav__link">
    ▼ 任意のEloquentモデルCRUDイベントの検知
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#07-exception" class="md-nav__link">
    07. Exception
  </a>
  
    <nav class="md-nav" aria-label="07. Exception">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laravel_1" class="md-nav__link">
    Laravelにおけるエラーハンドリング
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    例外スロー
  </a>
  
    <nav class="md-nav" aria-label="例外スロー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    ▼ 例外
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    ▼ スタックトレース
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    ロギング
  </a>
  
    <nav class="md-nav" aria-label="ロギング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    ▼ reportメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    異常系レスポンスの返信
  </a>
  
    <nav class="md-nav" aria-label="異常系レスポンスの返信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#render" class="md-nav__link">
    ▼ renderメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#08-facade" class="md-nav__link">
    08. Facade
  </a>
  
    <nav class="md-nav" aria-label="08. Facade">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#facade" class="md-nav__link">
    Facade
  </a>
  
    <nav class="md-nav" aria-label="Facade">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#facade_1" class="md-nav__link">
    ▼ Facadeとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_2" class="md-nav__link">
    ▼ Facadeを使用しない場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_3" class="md-nav__link">
    ▼ Facadeの静的プロキシを使用する場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_4" class="md-nav__link">
    ▼ Facadeを使用した方が良い場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_5" class="md-nav__link">
    ▼ 標準登録されたFacadeクラスの種類
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth" class="md-nav__link">
    Authファサード
  </a>
  
    <nav class="md-nav" aria-label="Authファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#auth_1" class="md-nav__link">
    ▼ Authファサードとは
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#db_1" class="md-nav__link">
    DBファサード
  </a>
  
    <nav class="md-nav" aria-label="DBファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db_2" class="md-nav__link">
    ▼ DBファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction" class="md-nav__link">
    ▼ transactionメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begintransactioncommitrollback" class="md-nav__link">
    ▼ beginTransactionメソッド、commitメソッド、rollbackメソッド、
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route" class="md-nav__link">
    Routeファサード
  </a>
  
    <nav class="md-nav" aria-label="Routeファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#route_1" class="md-nav__link">
    ▼ Routeファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    ▼ ヘルスチェックへの対応
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#middleware" class="md-nav__link">
    ▼ middlewareメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefix" class="md-nav__link">
    ▼ prefixメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wherepattern" class="md-nav__link">
    ▼ whereメソッド、patternメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group" class="md-nav__link">
    ▼ groupメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storageファサード
  </a>
  
    <nav class="md-nav" aria-label="Storageファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage_1" class="md-nav__link">
    ▼ Storageファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    ▼ ローカルストレージ (非公開) の場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    ▼ ローカルストレージ (公開) の場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    ▼ クラウドストレージの場合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator" class="md-nav__link">
    Validatorファサード
  </a>
  
    <nav class="md-nav" aria-label="Validatorファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validator_1" class="md-nav__link">
    ▼ Validatorファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatorfails" class="md-nav__link">
    ▼ Validatorクラス、failsメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    ▼ validateメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#08-02" class="md-nav__link">
    08-02. よく使用するグローバルヘルパー関数
  </a>
  
    <nav class="md-nav" aria-label="08-02. よく使用するグローバルヘルパー関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    ヘルパー関数
  </a>
  
    <nav class="md-nav" aria-label="ヘルパー関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    ▼ ヘルパー関数とは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    ▼ 一覧
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth_2" class="md-nav__link">
    authヘルパー
  </a>
  
    <nav class="md-nav" aria-label="authヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authmanager" class="md-nav__link">
    ▼ AuthManagerインスタンスの返却
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    configヘルパー
  </a>
  
    <nav class="md-nav" aria-label="configヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    ▼ 環境変数ファイルの読み出し
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    ▼ 独自環境変数ファイルの作成と読み出し
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bcrypt" class="md-nav__link">
    bcryptヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirect" class="md-nav__link">
    redirectヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    responseヘルパー
  </a>
  
    <nav class="md-nav" aria-label="responseヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    ▼ JSON型データを含むレスポンス
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    ▼ Viewテンプレートのレスポンス
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route_2" class="md-nav__link">
    routeヘルパー
  </a>
  
    <nav class="md-nav" aria-label="routeヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    ▼ ルートエイリアスを基にURL作成
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path" class="md-nav__link">
    path系ヘルパー
  </a>
  
    <nav class="md-nav" aria-label="path系ヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_path" class="md-nav__link">
    ▼ base_pathヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public_path" class="md-nav__link">
    ▼ public_pathヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage_path" class="md-nav__link">
    ▼ storage_pathヘルパー
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_1" class="md-nav__link">
    urlヘルパー
  </a>
  
    <nav class="md-nav" aria-label="urlヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url_2" class="md-nav__link">
    ▼ パスを基にURL作成
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#09-factory" class="md-nav__link">
    09. Factory
  </a>
  
    <nav class="md-nav" aria-label="09. Factory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    初期値レコードの定義
  </a>
  
    <nav class="md-nav" aria-label="初期値レコードの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#faker" class="md-nav__link">
    ▼ Fakerによるランダム値作成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factory" class="md-nav__link">
    ▼ Factoryによるレコード定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hasfactory" class="md-nav__link">
    ▼ HasFactoryトレイト
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    初期ダミーデータの量産
  </a>
  
    <nav class="md-nav" aria-label="初期ダミーデータの量産">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seeder" class="md-nav__link">
    ▼ Seederによるダミーデータ量産
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-httpcontroller" class="md-nav__link">
    10. HTTP｜Controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-02-httpformrequest" class="md-nav__link">
    10-02. HTTP｜FormRequest
  </a>
  
    <nav class="md-nav" aria-label="10-02. HTTP｜FormRequest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    クエリパラメーター/メッセージボディのバリデーション
  </a>
  
    <nav class="md-nav" aria-label="クエリパラメーター/メッセージボディのバリデーション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    ▼ ルール定義 ＆ バリデーション手動実行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    ▼ ルール定義 &amp; バリデーション自動実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    パスパラメーターのバリデーション
  </a>
  
    <nav class="md-nav" aria-label="パスパラメーターのバリデーション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    ▼ ルールの定義 ＆ バリデーション自動実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    エラーメッセージ
  </a>
  
    <nav class="md-nav" aria-label="エラーメッセージ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    ▼ 標準のエラーメッセージ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    ▼ 画面上でのエラーメッセージ出力
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rule" class="md-nav__link">
    Rule
  </a>
  
    <nav class="md-nav" aria-label="Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    ▼ existsメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" class="md-nav__link">
    ▼ inメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    ▼ 独自ルール/メッセージ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    セッション
  </a>
  
    <nav class="md-nav" aria-label="セッション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    ▼ セッション変数の取得
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    ▼ フラッシュデータの設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    認証
  </a>
  
    <nav class="md-nav" aria-label="認証">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorize" class="md-nav__link">
    ▼ authorizeメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth_3" class="md-nav__link">
    ▼ Authファサード
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-03-httpmiddleware" class="md-nav__link">
    10-03. HTTP｜Middleware
  </a>
  
    <nav class="md-nav" aria-label="10-03. HTTP｜Middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_1" class="md-nav__link">
    Middlewareの仕組み
  </a>
  
    <nav class="md-nav" aria-label="Middlewareの仕組み">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_2" class="md-nav__link">
    ▼ Middlewareの種類
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beforemiddleware" class="md-nav__link">
    ▼ BeforeMiddleware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aftermiddleware" class="md-nav__link">
    ▼ AfterMiddleware
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#middleware_3" class="md-nav__link">
    標準のMiddleware
  </a>
  
    <nav class="md-nav" aria-label="標準のMiddleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryptcookies" class="md-nav__link">
    ▼ EncryptCookies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#startsession" class="md-nav__link">
    ▼ StartSession
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifycsrftoken" class="md-nav__link">
    ▼ VerifyCsrfToken
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    コール方法のカスタマイズ
  </a>
  
    <nav class="md-nav" aria-label="コール方法のカスタマイズ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kernel" class="md-nav__link">
    ▼ Kernel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-04-httprequest" class="md-nav__link">
    10-04. HTTP｜Request
  </a>
  
    <nav class="md-nav" aria-label="10-04. HTTP｜Request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    リクエストパラメーターの取得
  </a>
  
    <nav class="md-nav" aria-label="リクエストパラメーターの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    ▼ クエリパラメーター/メッセージボディ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    ▼ クエリパラメーター
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    ▼ パスパラメータ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    バリデーション
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-logging" class="md-nav__link">
    11. Logging
  </a>
  
    <nav class="md-nav" aria-label="11. Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    ログの出力先
  </a>
  
    <nav class="md-nav" aria-label="ログの出力先">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    ▼ 設定方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php-fpm" class="md-nav__link">
    ▼ PHP-FPMのログについて
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stack" class="md-nav__link">
    ▼ stackキー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single" class="md-nav__link">
    ▼ singleキー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daily" class="md-nav__link">
    ▼ dailyキー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stderr" class="md-nav__link">
    ▼ stderrキー
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    ログの出力
  </a>
  
    <nav class="md-nav" aria-label="ログの出力">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error" class="md-nav__link">
    ▼ errorメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#info" class="md-nav__link">
    ▼ infoメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-migration" class="md-nav__link">
    12. Migration
  </a>
  
    <nav class="md-nav" aria-label="12. Migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    テーブルの作成/削除
  </a>
  
    <nav class="md-nav" aria-label="テーブルの作成/削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updown" class="md-nav__link">
    ▼ upメソッド、downメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    カラムの追加/変更/削除
  </a>
  
    <nav class="md-nav" aria-label="カラムの追加/変更/削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    ▼ なし
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renamecolumn" class="md-nav__link">
    ▼ renameColumnメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change" class="md-nav__link">
    ▼ changeメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropcolumn" class="md-nav__link">
    ▼ dropColumnメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    よく使用するカラムタイプ
  </a>
  
    <nav class="md-nav" aria-label="よく使用するカラムタイプ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bigincrements" class="md-nav__link">
    ▼ bigIncrementsメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unsignedbiginteger" class="md-nav__link">
    ▼ unsignedBigIntegerメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    ▼ stringメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestamp" class="md-nav__link">
    ▼ timestampメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-notification" class="md-nav__link">
    13. Notification
  </a>
  
    <nav class="md-nav" aria-label="13. Notification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artisan" class="md-nav__link">
    artisanコマンド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    通知内容
  </a>
  
    <nav class="md-nav" aria-label="通知内容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notification" class="md-nav__link">
    ▼ Notification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    ▼ Eメール通知内容の定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sms" class="md-nav__link">
    ▼ SMS通知内容の定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slack" class="md-nav__link">
    ▼ Slack通知内容の定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#db_3" class="md-nav__link">
    ▼ DB通知内容の定義
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    受信チャンネル (通知方法)
  </a>
  
    <nav class="md-nav" aria-label="受信チャンネル (通知方法)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel" class="md-nav__link">
    ▼ Channel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    通知対象モデル
  </a>
  
    <nav class="md-nav" aria-label="通知対象モデル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notifiablenotify" class="md-nav__link">
    ▼ Notifiableトレイトのnotifyメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notification_1" class="md-nav__link">
    ▼ Notificationファサード
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    ▼ オンデマンド通知
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-resource" class="md-nav__link">
    14. Resource
  </a>
  
    <nav class="md-nav" aria-label="14. Resource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    レスポンスデータ作成前のデータ型変換
  </a>
  
    <nav class="md-nav" aria-label="レスポンスデータ作成前のデータ型変換">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    ▼ データ型変換の必要性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquent" class="md-nav__link">
    ▼ 単一のEloquentモデルの配列化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquent-collection" class="md-nav__link">
    ▼ 複数のEloquentモデル (Collection型) の配列化
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-routing" class="md-nav__link">
    15. Routing
  </a>
  
    <nav class="md-nav" aria-label="15. Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apiphp" class="md-nav__link">
    api.phpファイル
  </a>
  
    <nav class="md-nav" aria-label="api.phpファイル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_4" class="md-nav__link">
    ▼ Middlewareの適用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webphp" class="md-nav__link">
    web.phpファイル
  </a>
  
    <nav class="md-nav" aria-label="web.phpファイル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_5" class="md-nav__link">
    ▼ Middlewareの適用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guestphp" class="md-nav__link">
    guest.phpファイル
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    暗黙のモデル結合
  </a>
  
    <nav class="md-nav" aria-label="暗黙のモデル結合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    ▼ コントローラー使用時
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-security" class="md-nav__link">
    16. Security
  </a>
  
    <nav class="md-nav" aria-label="16. Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csrf" class="md-nav__link">
    CSRF対策
  </a>
  
    <nav class="md-nav" aria-label="CSRF対策">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    ▼ アプリケーション側の対応
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http" class="md-nav__link">
    ▼ HTTPクライアントツール側の対応
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xss" class="md-nav__link">
    ▼ XSS対策
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    ▼ 常時HTTPS化
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#17-seeder" class="md-nav__link">
    17. Seeder
  </a>
  
    <nav class="md-nav" aria-label="17. Seeder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    初期データの定義
  </a>
  
    <nav class="md-nav" aria-label="初期データの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db_4" class="md-nav__link">
    ▼ DBファサードによる定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv" class="md-nav__link">
    ▼ CSVファイルによる定義
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seeder_1" class="md-nav__link">
    Seederの実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18-serviceprovider" class="md-nav__link">
    18. ServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="18. ServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serviceprovider" class="md-nav__link">
    ServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="ServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serviceprovider_1" class="md-nav__link">
    ▼ ServiceProviderの用途
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serviceprovider_2" class="md-nav__link">
    ▼ ServiceProviderのコール
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicecontainer" class="md-nav__link">
    ServiceContainer
  </a>
  
    <nav class="md-nav" aria-label="ServiceContainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servicecontainer_1" class="md-nav__link">
    ▼ ServiceContainer、バインド、リゾルブとは
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appserviceprovider" class="md-nav__link">
    AppServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="AppServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    ▼ 単一のクラスをバインド/リゾルブ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    ▼ 複数のクラスをバインド/リゾルブ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    ▼ インターフェースをバインドし、実装クラスをリゾルブ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make" class="md-nav__link">
    ▼ makeメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registerboot" class="md-nav__link">
    ▼ registerメソッドとbootメソッドの違い
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrationmacroserviceprovider" class="md-nav__link">
    MigrationMacroServiceProvider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routeserviceprovider" class="md-nav__link">
    RouteServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="RouteServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    ▼ 全てのルーティングへの処理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    ▼ リクエスト数制限
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventserviceprovider" class="md-nav__link">
    EventServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="EventServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eventlistener" class="md-nav__link">
    ▼ EventとListenerの登録
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#19-session" class="md-nav__link">
    19. Session
  </a>
  
    <nav class="md-nav" aria-label="19. Session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    セッションの操作
  </a>
  
    <nav class="md-nav" aria-label="セッションの操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    ▼ 設定ファイル
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    ▼ よく使用する操作メソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store" class="md-nav__link">
    ▼ セッションデータがStoreクラスに至るまで
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-views" class="md-nav__link">
    20. Views
  </a>
  
    <nav class="md-nav" aria-label="20. Views">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    データの出力
  </a>
  
    <nav class="md-nav" aria-label="データの出力">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    ▼ データの出力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    ▼ バリデーションメッセージの出力
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    要素の共通化
  </a>
  
    <nav class="md-nav" aria-label="要素の共通化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include" class="md-nav__link">
    ▼ @include (サブビュー)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    要素の継承
  </a>
  
    <nav class="md-nav" aria-label="要素の継承">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yieldextendssectionendsection" class="md-nav__link">
    ▼ @yield、@extends、@section、@endsection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sectionshowextendsparent" class="md-nav__link">
    ▼ @section、@show、@extends、@parent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stackpush" class="md-nav__link">
    ▼ @stack、@push
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twig" class="md-nav__link">
    Twigとの互換
  </a>
  
    <nav class="md-nav" aria-label="Twigとの互換">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blade" class="md-nav__link">
    ▼ Bladeで実装した場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twig_1" class="md-nav__link">
    ▼ Twigで実装した場合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_php_framework_laravel_eloquent_orm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ︎Eloquent ORM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_php_framework_laravel_package.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    専用パッケージ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_php_framework_laravel_package_auth.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認証/認可系パッケージ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_php_framework_laravel_command.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コマンド
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="language_php_framework_symfony_component.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ Symfony
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="language_php_package_management.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ パッケージ
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="language_js_prototype_based.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ JavaScript
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="language_go.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ Go
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="language_python.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ■ Python
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="language_r.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../testing/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🧪 テスト
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../hardware/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    💻 ハードウェア
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../network/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🌏 ネットワーク
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../security/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🔐 セキュリティ
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../cloud_computing/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ⛅️ 3大クラウド
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../virtualization/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    📦 仮想化
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../infrastructure_as_code/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ⚙️ IaC
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../infrastructure_as_code/kubernetes/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ☸️ K8s
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../infrastructure_as_code/kubernetes_addon/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ⏬ K8sアドオン
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../infrastructure_as_code/cncf_projects/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🌊 CNCF
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../devops/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ♾️ DevOps
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../devops/cicd/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🔄 CI/CD
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../observability/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    🔎 可観測性
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../software_development_methodology/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    👥 開発手法
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="このページの内容">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      このページの内容
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    はじめに
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#01-laravel" class="md-nav__link">
    01. Laravelの全体像
  </a>
  
    <nav class="md-nav" aria-label="01. Laravelの全体像">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ライフサイクル
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    コンポーネントのコード
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#02-application" class="md-nav__link">
    02. Application
  </a>
  
    <nav class="md-nav" aria-label="02. Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app" class="md-nav__link">
    App
  </a>
  
    <nav class="md-nav" aria-label="App">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    ▼ 設定方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appphp" class="md-nav__link">
    ▼ app.phpファイルの基本設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#03-config" class="md-nav__link">
    03. Config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#04-console" class="md-nav__link">
    04. Console
  </a>
  
    <nav class="md-nav" aria-label="04. Console">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command" class="md-nav__link">
    Command
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#05-database" class="md-nav__link">
    05. Database
  </a>
  
    <nav class="md-nav" aria-label="05. Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db" class="md-nav__link">
    DB
  </a>
  
    <nav class="md-nav" aria-label="DB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    ▼ 設定方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdbredis" class="md-nav__link">
    ▼ RDBとRedisの選択
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    エンドポイントに応じた設定
  </a>
  
    <nav class="md-nav" aria-label="エンドポイントに応じた設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    ▼ 単一のエンドポイント
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    ▼ 複数のエンドポイント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis" class="md-nav__link">
    Redis
  </a>
  
    <nav class="md-nav" aria-label="Redis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    ▼ クエリキャッシュ管理
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#06-eventlistener" class="md-nav__link">
    06. Event/Listener
  </a>
  
    <nav class="md-nav" aria-label="06. Event/Listener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event" class="md-nav__link">
    Event
  </a>
  
    <nav class="md-nav" aria-label="Event">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event_1" class="md-nav__link">
    ▼ Eventとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    ▼ 構成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquentcrud" class="md-nav__link">
    ▼ EloquentモデルのCRUDイベント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listener" class="md-nav__link">
    Listener
  </a>
  
    <nav class="md-nav" aria-label="Listener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listener_1" class="md-nav__link">
    ▼ Listenerとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    ▼ 構成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    ▼ イベントとリスナーの紐付け
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquentcrud_1" class="md-nav__link">
    ▼ 任意のEloquentモデルCRUDイベントの検知
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#07-exception" class="md-nav__link">
    07. Exception
  </a>
  
    <nav class="md-nav" aria-label="07. Exception">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laravel_1" class="md-nav__link">
    Laravelにおけるエラーハンドリング
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    例外スロー
  </a>
  
    <nav class="md-nav" aria-label="例外スロー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    ▼ 例外
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    ▼ スタックトレース
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    ロギング
  </a>
  
    <nav class="md-nav" aria-label="ロギング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    ▼ reportメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    異常系レスポンスの返信
  </a>
  
    <nav class="md-nav" aria-label="異常系レスポンスの返信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#render" class="md-nav__link">
    ▼ renderメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#08-facade" class="md-nav__link">
    08. Facade
  </a>
  
    <nav class="md-nav" aria-label="08. Facade">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#facade" class="md-nav__link">
    Facade
  </a>
  
    <nav class="md-nav" aria-label="Facade">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#facade_1" class="md-nav__link">
    ▼ Facadeとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_2" class="md-nav__link">
    ▼ Facadeを使用しない場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_3" class="md-nav__link">
    ▼ Facadeの静的プロキシを使用する場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_4" class="md-nav__link">
    ▼ Facadeを使用した方が良い場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facade_5" class="md-nav__link">
    ▼ 標準登録されたFacadeクラスの種類
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth" class="md-nav__link">
    Authファサード
  </a>
  
    <nav class="md-nav" aria-label="Authファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#auth_1" class="md-nav__link">
    ▼ Authファサードとは
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#db_1" class="md-nav__link">
    DBファサード
  </a>
  
    <nav class="md-nav" aria-label="DBファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db_2" class="md-nav__link">
    ▼ DBファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction" class="md-nav__link">
    ▼ transactionメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begintransactioncommitrollback" class="md-nav__link">
    ▼ beginTransactionメソッド、commitメソッド、rollbackメソッド、
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route" class="md-nav__link">
    Routeファサード
  </a>
  
    <nav class="md-nav" aria-label="Routeファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#route_1" class="md-nav__link">
    ▼ Routeファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    ▼ ヘルスチェックへの対応
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#middleware" class="md-nav__link">
    ▼ middlewareメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefix" class="md-nav__link">
    ▼ prefixメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wherepattern" class="md-nav__link">
    ▼ whereメソッド、patternメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group" class="md-nav__link">
    ▼ groupメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storageファサード
  </a>
  
    <nav class="md-nav" aria-label="Storageファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage_1" class="md-nav__link">
    ▼ Storageファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    ▼ ローカルストレージ (非公開) の場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    ▼ ローカルストレージ (公開) の場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    ▼ クラウドストレージの場合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator" class="md-nav__link">
    Validatorファサード
  </a>
  
    <nav class="md-nav" aria-label="Validatorファサード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validator_1" class="md-nav__link">
    ▼ Validatorファサードとは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatorfails" class="md-nav__link">
    ▼ Validatorクラス、failsメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    ▼ validateメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#08-02" class="md-nav__link">
    08-02. よく使用するグローバルヘルパー関数
  </a>
  
    <nav class="md-nav" aria-label="08-02. よく使用するグローバルヘルパー関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    ヘルパー関数
  </a>
  
    <nav class="md-nav" aria-label="ヘルパー関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    ▼ ヘルパー関数とは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    ▼ 一覧
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth_2" class="md-nav__link">
    authヘルパー
  </a>
  
    <nav class="md-nav" aria-label="authヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authmanager" class="md-nav__link">
    ▼ AuthManagerインスタンスの返却
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    configヘルパー
  </a>
  
    <nav class="md-nav" aria-label="configヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    ▼ 環境変数ファイルの読み出し
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    ▼ 独自環境変数ファイルの作成と読み出し
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bcrypt" class="md-nav__link">
    bcryptヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirect" class="md-nav__link">
    redirectヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    responseヘルパー
  </a>
  
    <nav class="md-nav" aria-label="responseヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    ▼ JSON型データを含むレスポンス
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    ▼ Viewテンプレートのレスポンス
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route_2" class="md-nav__link">
    routeヘルパー
  </a>
  
    <nav class="md-nav" aria-label="routeヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    ▼ ルートエイリアスを基にURL作成
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path" class="md-nav__link">
    path系ヘルパー
  </a>
  
    <nav class="md-nav" aria-label="path系ヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_path" class="md-nav__link">
    ▼ base_pathヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public_path" class="md-nav__link">
    ▼ public_pathヘルパー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage_path" class="md-nav__link">
    ▼ storage_pathヘルパー
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_1" class="md-nav__link">
    urlヘルパー
  </a>
  
    <nav class="md-nav" aria-label="urlヘルパー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url_2" class="md-nav__link">
    ▼ パスを基にURL作成
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#09-factory" class="md-nav__link">
    09. Factory
  </a>
  
    <nav class="md-nav" aria-label="09. Factory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    初期値レコードの定義
  </a>
  
    <nav class="md-nav" aria-label="初期値レコードの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#faker" class="md-nav__link">
    ▼ Fakerによるランダム値作成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factory" class="md-nav__link">
    ▼ Factoryによるレコード定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hasfactory" class="md-nav__link">
    ▼ HasFactoryトレイト
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    初期ダミーデータの量産
  </a>
  
    <nav class="md-nav" aria-label="初期ダミーデータの量産">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seeder" class="md-nav__link">
    ▼ Seederによるダミーデータ量産
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-httpcontroller" class="md-nav__link">
    10. HTTP｜Controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-02-httpformrequest" class="md-nav__link">
    10-02. HTTP｜FormRequest
  </a>
  
    <nav class="md-nav" aria-label="10-02. HTTP｜FormRequest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    クエリパラメーター/メッセージボディのバリデーション
  </a>
  
    <nav class="md-nav" aria-label="クエリパラメーター/メッセージボディのバリデーション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    ▼ ルール定義 ＆ バリデーション手動実行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    ▼ ルール定義 &amp; バリデーション自動実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    パスパラメーターのバリデーション
  </a>
  
    <nav class="md-nav" aria-label="パスパラメーターのバリデーション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    ▼ ルールの定義 ＆ バリデーション自動実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    エラーメッセージ
  </a>
  
    <nav class="md-nav" aria-label="エラーメッセージ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    ▼ 標準のエラーメッセージ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    ▼ 画面上でのエラーメッセージ出力
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rule" class="md-nav__link">
    Rule
  </a>
  
    <nav class="md-nav" aria-label="Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    ▼ existsメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" class="md-nav__link">
    ▼ inメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    ▼ 独自ルール/メッセージ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    セッション
  </a>
  
    <nav class="md-nav" aria-label="セッション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    ▼ セッション変数の取得
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    ▼ フラッシュデータの設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    認証
  </a>
  
    <nav class="md-nav" aria-label="認証">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorize" class="md-nav__link">
    ▼ authorizeメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth_3" class="md-nav__link">
    ▼ Authファサード
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-03-httpmiddleware" class="md-nav__link">
    10-03. HTTP｜Middleware
  </a>
  
    <nav class="md-nav" aria-label="10-03. HTTP｜Middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_1" class="md-nav__link">
    Middlewareの仕組み
  </a>
  
    <nav class="md-nav" aria-label="Middlewareの仕組み">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_2" class="md-nav__link">
    ▼ Middlewareの種類
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beforemiddleware" class="md-nav__link">
    ▼ BeforeMiddleware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aftermiddleware" class="md-nav__link">
    ▼ AfterMiddleware
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#middleware_3" class="md-nav__link">
    標準のMiddleware
  </a>
  
    <nav class="md-nav" aria-label="標準のMiddleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryptcookies" class="md-nav__link">
    ▼ EncryptCookies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#startsession" class="md-nav__link">
    ▼ StartSession
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifycsrftoken" class="md-nav__link">
    ▼ VerifyCsrfToken
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    コール方法のカスタマイズ
  </a>
  
    <nav class="md-nav" aria-label="コール方法のカスタマイズ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kernel" class="md-nav__link">
    ▼ Kernel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-04-httprequest" class="md-nav__link">
    10-04. HTTP｜Request
  </a>
  
    <nav class="md-nav" aria-label="10-04. HTTP｜Request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    リクエストパラメーターの取得
  </a>
  
    <nav class="md-nav" aria-label="リクエストパラメーターの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    ▼ クエリパラメーター/メッセージボディ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    ▼ クエリパラメーター
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    ▼ パスパラメータ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    バリデーション
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-logging" class="md-nav__link">
    11. Logging
  </a>
  
    <nav class="md-nav" aria-label="11. Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    ログの出力先
  </a>
  
    <nav class="md-nav" aria-label="ログの出力先">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    ▼ 設定方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php-fpm" class="md-nav__link">
    ▼ PHP-FPMのログについて
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stack" class="md-nav__link">
    ▼ stackキー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single" class="md-nav__link">
    ▼ singleキー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daily" class="md-nav__link">
    ▼ dailyキー
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stderr" class="md-nav__link">
    ▼ stderrキー
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    ログの出力
  </a>
  
    <nav class="md-nav" aria-label="ログの出力">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error" class="md-nav__link">
    ▼ errorメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#info" class="md-nav__link">
    ▼ infoメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-migration" class="md-nav__link">
    12. Migration
  </a>
  
    <nav class="md-nav" aria-label="12. Migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    テーブルの作成/削除
  </a>
  
    <nav class="md-nav" aria-label="テーブルの作成/削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updown" class="md-nav__link">
    ▼ upメソッド、downメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    カラムの追加/変更/削除
  </a>
  
    <nav class="md-nav" aria-label="カラムの追加/変更/削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    ▼ なし
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renamecolumn" class="md-nav__link">
    ▼ renameColumnメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change" class="md-nav__link">
    ▼ changeメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropcolumn" class="md-nav__link">
    ▼ dropColumnメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    よく使用するカラムタイプ
  </a>
  
    <nav class="md-nav" aria-label="よく使用するカラムタイプ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bigincrements" class="md-nav__link">
    ▼ bigIncrementsメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unsignedbiginteger" class="md-nav__link">
    ▼ unsignedBigIntegerメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    ▼ stringメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestamp" class="md-nav__link">
    ▼ timestampメソッド
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-notification" class="md-nav__link">
    13. Notification
  </a>
  
    <nav class="md-nav" aria-label="13. Notification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artisan" class="md-nav__link">
    artisanコマンド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    通知内容
  </a>
  
    <nav class="md-nav" aria-label="通知内容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notification" class="md-nav__link">
    ▼ Notification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    ▼ Eメール通知内容の定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sms" class="md-nav__link">
    ▼ SMS通知内容の定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slack" class="md-nav__link">
    ▼ Slack通知内容の定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#db_3" class="md-nav__link">
    ▼ DB通知内容の定義
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    受信チャンネル (通知方法)
  </a>
  
    <nav class="md-nav" aria-label="受信チャンネル (通知方法)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel" class="md-nav__link">
    ▼ Channel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    通知対象モデル
  </a>
  
    <nav class="md-nav" aria-label="通知対象モデル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notifiablenotify" class="md-nav__link">
    ▼ Notifiableトレイトのnotifyメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notification_1" class="md-nav__link">
    ▼ Notificationファサード
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    ▼ オンデマンド通知
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-resource" class="md-nav__link">
    14. Resource
  </a>
  
    <nav class="md-nav" aria-label="14. Resource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    レスポンスデータ作成前のデータ型変換
  </a>
  
    <nav class="md-nav" aria-label="レスポンスデータ作成前のデータ型変換">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    ▼ データ型変換の必要性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquent" class="md-nav__link">
    ▼ 単一のEloquentモデルの配列化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquent-collection" class="md-nav__link">
    ▼ 複数のEloquentモデル (Collection型) の配列化
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-routing" class="md-nav__link">
    15. Routing
  </a>
  
    <nav class="md-nav" aria-label="15. Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apiphp" class="md-nav__link">
    api.phpファイル
  </a>
  
    <nav class="md-nav" aria-label="api.phpファイル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_4" class="md-nav__link">
    ▼ Middlewareの適用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webphp" class="md-nav__link">
    web.phpファイル
  </a>
  
    <nav class="md-nav" aria-label="web.phpファイル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware_5" class="md-nav__link">
    ▼ Middlewareの適用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guestphp" class="md-nav__link">
    guest.phpファイル
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    暗黙のモデル結合
  </a>
  
    <nav class="md-nav" aria-label="暗黙のモデル結合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    ▼ コントローラー使用時
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-security" class="md-nav__link">
    16. Security
  </a>
  
    <nav class="md-nav" aria-label="16. Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csrf" class="md-nav__link">
    CSRF対策
  </a>
  
    <nav class="md-nav" aria-label="CSRF対策">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    ▼ アプリケーション側の対応
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http" class="md-nav__link">
    ▼ HTTPクライアントツール側の対応
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xss" class="md-nav__link">
    ▼ XSS対策
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    ▼ 常時HTTPS化
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#17-seeder" class="md-nav__link">
    17. Seeder
  </a>
  
    <nav class="md-nav" aria-label="17. Seeder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    初期データの定義
  </a>
  
    <nav class="md-nav" aria-label="初期データの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#db_4" class="md-nav__link">
    ▼ DBファサードによる定義
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv" class="md-nav__link">
    ▼ CSVファイルによる定義
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seeder_1" class="md-nav__link">
    Seederの実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18-serviceprovider" class="md-nav__link">
    18. ServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="18. ServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serviceprovider" class="md-nav__link">
    ServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="ServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serviceprovider_1" class="md-nav__link">
    ▼ ServiceProviderの用途
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serviceprovider_2" class="md-nav__link">
    ▼ ServiceProviderのコール
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicecontainer" class="md-nav__link">
    ServiceContainer
  </a>
  
    <nav class="md-nav" aria-label="ServiceContainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servicecontainer_1" class="md-nav__link">
    ▼ ServiceContainer、バインド、リゾルブとは
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appserviceprovider" class="md-nav__link">
    AppServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="AppServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    ▼ 単一のクラスをバインド/リゾルブ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    ▼ 複数のクラスをバインド/リゾルブ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    ▼ インターフェースをバインドし、実装クラスをリゾルブ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make" class="md-nav__link">
    ▼ makeメソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registerboot" class="md-nav__link">
    ▼ registerメソッドとbootメソッドの違い
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrationmacroserviceprovider" class="md-nav__link">
    MigrationMacroServiceProvider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routeserviceprovider" class="md-nav__link">
    RouteServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="RouteServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    ▼ 全てのルーティングへの処理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    ▼ リクエスト数制限
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventserviceprovider" class="md-nav__link">
    EventServiceProvider
  </a>
  
    <nav class="md-nav" aria-label="EventServiceProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eventlistener" class="md-nav__link">
    ▼ EventとListenerの登録
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#19-session" class="md-nav__link">
    19. Session
  </a>
  
    <nav class="md-nav" aria-label="19. Session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    セッションの操作
  </a>
  
    <nav class="md-nav" aria-label="セッションの操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    ▼ 設定ファイル
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    ▼ よく使用する操作メソッド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store" class="md-nav__link">
    ▼ セッションデータがStoreクラスに至るまで
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-views" class="md-nav__link">
    20. Views
  </a>
  
    <nav class="md-nav" aria-label="20. Views">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    データの出力
  </a>
  
    <nav class="md-nav" aria-label="データの出力">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    ▼ データの出力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    ▼ バリデーションメッセージの出力
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    要素の共通化
  </a>
  
    <nav class="md-nav" aria-label="要素の共通化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include" class="md-nav__link">
    ▼ @include (サブビュー)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    要素の継承
  </a>
  
    <nav class="md-nav" aria-label="要素の継承">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yieldextendssectionendsection" class="md-nav__link">
    ▼ @yield、@extends、@section、@endsection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sectionshowextendsparent" class="md-nav__link">
    ▼ @section、@show、@extends、@parent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stackpush" class="md-nav__link">
    ▼ @stack、@push
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twig" class="md-nav__link">
    Twigとの互換
  </a>
  
    <nav class="md-nav" aria-label="Twigとの互換">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blade" class="md-nav__link">
    ▼ Bladeで実装した場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twig_1" class="md-nav__link">
    ▼ Twigで実装した場合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="laravel">コンポーネント＠Laravel<a class="headerlink" href="#laravel" title="Permanent link">&para;</a></h1>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。</p>
<blockquote>
<ul>
<li><a href="https://hiroki-it.github.io/tech-notebook/">https://hiroki-it.github.io/tech-notebook/</a></li>
</ul>
</blockquote>
<p><br></p>
<h2 id="01-laravel">01. Laravelの全体像<a class="headerlink" href="#01-laravel" title="Permanent link">&para;</a></h2>
<h3 id="_2">ライフサイクル<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><img alt="laravel-lifecycle" src="https://raw.githubusercontent.com/hiroki-it/tech-notebook-images/master/images/laravel-lifecycle.png" /></p>
<p>大まかな処理フローは以下の通りである。</p>
<table>
<thead>
<tr>
<th></th>
<th>用語</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>リクエストを受信する。</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td><code>index.php</code>ファイル</td>
<td>エントリーポイントから処理が開始する。</td>
</tr>
<tr>
<td>3</td>
<td>Autoload</td>
<td><code>autoload.php</code>ファイルにて、パッケージを自動的にロードする。</td>
</tr>
<tr>
<td>4</td>
<td>Load App</td>
<td><code>bootstrap/app.php</code>ファイルにて、ServiceContainer (<code>Illuminate\Foundation\Application.php</code>) を実行する。</td>
</tr>
<tr>
<td>5</td>
<td>Http Kernel</td>
<td>Kernelを実行する。</td>
</tr>
<tr>
<td>6</td>
<td>・Register ServiceProviders<br>・Boot Service Providers</td>
<td>ServiceProviderの<code>register</code>メソッドや<code>boot</code>メソッドを実行する。これにより、ServiceContainerにクラスがバインドされる。</td>
</tr>
<tr>
<td>7</td>
<td>Middleware</td>
<td>BeforeMiddlewareを実行する。</td>
</tr>
<tr>
<td>8</td>
<td>・Dispatch by Router<br>・Routes Match</td>
<td><code>web.php</code>ファイル、<code>app.php</code>ファイルなどのルーティング定義を元に、Routerが実行する。</td>
</tr>
<tr>
<td>9</td>
<td>FormRequest</td>
<td>バリデーションを実行する。</td>
</tr>
<tr>
<td>10</td>
<td>Controller</td>
<td>Controllerを基点として、DBにまで処理が走る。</td>
</tr>
<tr>
<td>11</td>
<td>Resource</td>
<td>DBから取得したコレクション型データを配列型データに変換する。</td>
</tr>
<tr>
<td>12</td>
<td>Response</td>
<td>Responseを実行する。配列型データをJSON型データに変換する。</td>
</tr>
<tr>
<td>13</td>
<td>Terminate Middleware</td>
<td>AfterMiddlewareが実行される。</td>
</tr>
<tr>
<td>14</td>
<td>View</td>
<td><code>blade.php</code>ファイルを基に静的ファイルが作成される。</td>
</tr>
<tr>
<td>15</td>
<td>レスポンスを返信する。</td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li><a href="https://blog.albert-chen.com/the-integration-of-laravel-with-swoole-part-1/">https://blog.albert-chen.com/the-integration-of-laravel-with-swoole-part-1/</a></li>
</ul>
</blockquote>
<p><br></p>
<h3 id="_3">コンポーネントのコード<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>Laravelの各コンポーネントには、似たような名前のメソッドが多く内蔵されている。</p>
<p>そのため、同様の能力を実現するために、各々が異なるメソッドを使用しがちになる。</p>
<p>その時、各メソッドがブラックボックスにならないように、処理の違いをコードから確認する必要がある。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate.html">https://laravel.com/api/8.x/Illuminate.html</a></li>
</ul>
</blockquote>
<p><br></p>
<h2 id="02-application">02. Application<a class="headerlink" href="#02-application" title="Permanent link">&para;</a></h2>
<h3 id="app">App<a class="headerlink" href="#app" title="Permanent link">&para;</a></h3>
<h4 id="_4">▼ 設定方法<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nv">APP_NAME</span><span class="o">=</span>&lt;サービス名&gt;
<span class="nv">APP_ENV</span><span class="o">=</span>&lt;実行環境名&gt;
<span class="nv">APP_KEY</span><span class="o">=</span>&lt;セッションの作成やパスワードの暗号化に使用する認証キー&gt;
<span class="nv">APP_DEBUG</span><span class="o">=</span>&lt;デバッグモードの有効無効化&gt;
<span class="nv">APP_URL</span><span class="o">=</span>&lt;アプリケーションのURL&gt;
</code></pre></div>
<h4 id="appphp">▼ <code>app.php</code>ファイルの基本設定<a class="headerlink" href="#appphp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="c1">// アプリケーション名</span>
    <span class="s2">&quot;name&quot;</span>            <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;APP_NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;Laravel&quot;</span><span class="p">),</span>

    <span class="c1">// 実行環境名</span>
    <span class="s2">&quot;env&quot;</span>             <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;APP_ENV&quot;</span><span class="p">,</span> <span class="s2">&quot;production&quot;</span><span class="p">),</span>

    <span class="c1">// エラー時のデバッグ画面の有効化</span>
    <span class="s2">&quot;debug&quot;</span>           <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="nx">env</span><span class="p">(</span><span class="s2">&quot;APP_DEBUG&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>

    <span class="c1">// アプリケーションのURL</span>
    <span class="s2">&quot;url&quot;</span>             <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;APP_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">),</span>

    <span class="c1">// assetヘルパーで付与するURL</span>
    <span class="s2">&quot;asset_url&quot;</span>       <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;ASSET_URL&quot;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>

    <span class="c1">// タイムゾーン</span>
    <span class="s2">&quot;timezone&quot;</span>        <span class="o">=&gt;</span> <span class="s2">&quot;UTC&quot;</span><span class="p">,</span>

    <span class="c1">// 言語設定</span>
    <span class="s2">&quot;locale&quot;</span>          <span class="o">=&gt;</span> <span class="s2">&quot;ja&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fallback_locale&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="s2">&quot;faker_locale&quot;</span>    <span class="o">=&gt;</span> <span class="s2">&quot;ja_JP&quot;</span><span class="p">,</span>

    <span class="c1">// セッションの作成やパスワードの暗号化に使用する認証キー</span>
    <span class="s2">&quot;key&quot;</span>             <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;APP_KEY&quot;</span><span class="p">),</span>

    <span class="c1">// 暗号アルゴリズム</span>
    <span class="s2">&quot;cipher&quot;</span>          <span class="o">=&gt;</span> <span class="s2">&quot;AES-256-CBC&quot;</span><span class="p">,</span>

    <span class="c1">// サービスプロバイダー</span>
    <span class="s2">&quot;providers&quot;</span>       <span class="o">=&gt;</span> <span class="p">[</span>

    <span class="p">],</span>

    <span class="c1">// クラス名のエイリアス</span>
    <span class="s2">&quot;aliases&quot;</span>         <span class="o">=&gt;</span> <span class="p">[</span>

    <span class="p">],</span>
<span class="p">];</span>
</code></pre></div>
<p><br></p>
<h2 id="03-config">03. Config<a class="headerlink" href="#03-config" title="Permanent link">&para;</a></h2>
<p><br></p>
<h2 id="04-console">04. Console<a class="headerlink" href="#04-console" title="Permanent link">&para;</a></h2>
<h3 id="command">Command<a class="headerlink" href="#command" title="Permanent link">&para;</a></h3>
<p>artisanコマンドで実行できるコマンド処理を定義する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Log</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooCommand</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">&#39;do-foo {bar}&#39;</span><span class="p">;</span> <span class="c1">// コマンドとパラメータ</span>

    <span class="sd">/**</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;コマンドの仕様を記入します&#39;</span><span class="p">;</span> <span class="c1">// コマンドの説明文</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;START: artisan do-foo&#39;</span><span class="p">);</span>

        <span class="c1">// パラメーターを取得します。</span>
        <span class="nv">$bar</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">argument</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>

        <span class="c1">// 何らかのコマンド処理</span>

        <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;END: artisan do-foo&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>定義したCommandクラスは、以下の様に実行できる。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>command:do-foo
</code></pre></div>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/artisan.html#writing-commands">https://readouble.com/laravel/8.x/ja/artisan.html#writing-commands</a></li>
</ul>
</blockquote>
<p><br></p>
<h2 id="05-database">05. Database<a class="headerlink" href="#05-database" title="Permanent link">&para;</a></h2>
<h3 id="db">DB<a class="headerlink" href="#db" title="Permanent link">&para;</a></h3>
<h4 id="_5">▼ 設定方法<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>環境変数を<code>.env</code>ファイルに実装する。</p>
<p><code>database.php</code>ファイルから、指定された設定が選択される。</p>
<div class="highlight"><pre><span></span><code><span class="nv">DB_CONNECTION</span><span class="o">=</span>&lt;RDB名&gt;
<span class="nv">DB_HOST</span><span class="o">=</span>&lt;ホスト名&gt;
<span class="nv">DB_PORT</span><span class="o">=</span>&lt;ポート番号&gt;
<span class="nv">DB_DATABASE</span><span class="o">=</span>&lt;DB名&gt;
<span class="nv">DB_USERNAME</span><span class="o">=</span>&lt;アプリケーションユーザー名&gt;
<span class="nv">DB_PASSWORD</span><span class="o">=</span>&lt;アプリケーションユーザーのパスワード&gt;
</code></pre></div>
<h4 id="rdbredis">▼ RDBとRedisの選択<a class="headerlink" href="#rdbredis" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="c1">// 使用するDBMSを設定</span>
    <span class="s2">&quot;default&quot;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_CONNECTION&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql&quot;</span><span class="p">),</span>

    <span class="s2">&quot;connections&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="c1">// DB接続情報 (SQLite)</span>
        <span class="s2">&quot;sqlite&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="p">],</span>

        <span class="c1">// DB接続情報 (MySQL)</span>
        <span class="s2">&quot;mysql&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="p">],</span>

        <span class="c1">// DB接続情報 (pgSQL)</span>
        <span class="s2">&quot;pgsql&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="p">],</span>

        <span class="c1">// DB接続情報 (SQLSRV)</span>
        <span class="s2">&quot;sqlsrv&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="p">],</span>
    <span class="p">],</span>

    <span class="c1">// DBマイグレーションファイルのあるディレクトリ</span>
    <span class="s2">&quot;migrations&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;migrations&quot;</span><span class="p">,</span>

    <span class="c1">// Redis接続情報</span>
    <span class="s2">&quot;redis&quot;</span>       <span class="o">=&gt;</span> <span class="p">[</span>

    <span class="p">],</span>
<span class="p">];</span>
</code></pre></div>
<p><br></p>
<h3 id="_6">エンドポイントに応じた設定<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<h4 id="_7">▼ 単一のエンドポイント<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p>単一のエンドポイントしかない場合、<code>DB_HOST</code>を1つだけ設定する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="o">...</span>

    <span class="s2">&quot;default&quot;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_CONNECTION&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql&quot;</span><span class="p">),</span>

    <span class="s2">&quot;connections&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="o">...</span>

        <span class="s2">&quot;mysql&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s2">&quot;driver&quot;</span>         <span class="o">=&gt;</span> <span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span>            <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">),</span>
            <span class="s2">&quot;host&quot;</span>           <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">),</span>
            <span class="s2">&quot;port&quot;</span>           <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_PORT&quot;</span><span class="p">,</span> <span class="mi">3306</span><span class="p">),</span>
            <span class="s2">&quot;database&quot;</span>       <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_DATABASE&quot;</span><span class="p">,</span> <span class="s2">&quot;forge&quot;</span><span class="p">),</span>
            <span class="s2">&quot;username&quot;</span>       <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_USERNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;forge&quot;</span><span class="p">),</span>
            <span class="s2">&quot;password&quot;</span>       <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_PASSWORD&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s2">&quot;unix_socket&quot;</span>    <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_SOCKET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s2">&quot;charset&quot;</span>        <span class="o">=&gt;</span> <span class="s2">&quot;utf8mb4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;collation&quot;</span>      <span class="o">=&gt;</span> <span class="s2">&quot;utf8mb4_unicode_ci&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prefix&quot;</span>         <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prefix_indexes&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s2">&quot;strict&quot;</span>         <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s2">&quot;engine&quot;</span>         <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span>        <span class="o">=&gt;</span> <span class="nb">extension_loaded</span><span class="p">(</span><span class="s2">&quot;pdo_mysql&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nb">array_filter</span><span class="p">([</span>
                <span class="nx">PDO</span><span class="o">::</span><span class="na">MYSQL_ATTR_SSL_CA</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;MYSQL_ATTR_SSL_CA&quot;</span><span class="p">),</span>
            <span class="p">])</span> <span class="o">:</span> <span class="p">[],</span>
        <span class="p">],</span>
    <span class="p">],</span>

    <span class="o">...</span>

<span class="p">];</span>
</code></pre></div>
<h4 id="_8">▼ 複数のエンドポイント<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<p>複数のエンドポイントがある場合、書き込み処理と読み出し処理をそれ専用のエンドポイントに向けるようにする。</p>
<p>例えば、AWS RDSを採用している場合、プライマリーインスタンスに向け、また読み出し処理をリードレプリカに向けることにより、負荷を分散できる。</p>
<p>この場合、環境変数に<code>2</code>個のインスタンスのエンドポイントを実装する必要がある。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/database.html#contentContainer:~:text=Read%EF%BC%8FWrite%E6%8E%A5%E7%B6%9A">https://readouble.com/laravel/8.x/ja/database.html#contentContainer:~:text=Read%EF%BC%8FWrite%E6%8E%A5%E7%B6%9A</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code>DB_HOST_PRIMARY=&lt;プライマリーインスタンスのエンドポイント&gt;
DB_HOST_READ=&lt;リードレプリカのエンドポイント&gt;
</code></pre></div>
<p>注意点として、<code>sticky</code>キーを有効化しておくと良い。</p>
<p>プライマリーインスタンスにおけるデータ更新がリードレプリカに同期される前に、リードレプリカに対して読み出し処理が起こるような場合、これを防げる。</p>
<blockquote>
<ul>
<li><a href="https://imanengineer.net/laravel-how-to-configure-master-slave-db/">https://imanengineer.net/laravel-how-to-configure-master-slave-db/</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="s2">&quot;default&quot;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;DB_CONNECTION&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql&quot;</span><span class="p">),</span>

    <span class="s2">&quot;connections&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="c1">// 〜 中略 〜</span>

        <span class="s1">&#39;mysql&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>

            <span class="c1">// 〜 中略 〜</span>

            <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
            <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">),</span>
            <span class="s1">&#39;read&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="c1"># リーダーエンドポイントを設定</span>
                    <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;DB_HOST_READER&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">],</span>
            <span class="s1">&#39;write&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="c1"># クラスターエンドポイントを設定</span>
                    <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;DB_HOST_PRIMARY&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">],</span>
            <span class="s1">&#39;sticky&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>

            <span class="c1">// 〜 中略 〜</span>

        <span class="p">],</span>

        <span class="c1">// 〜 中略 〜</span>
    <span class="p">],</span>
<span class="p">];</span>
</code></pre></div>
<p><br></p>
<h3 id="redis">Redis<a class="headerlink" href="#redis" title="Permanent link">&para;</a></h3>
<h4 id="_9">▼ クエリキャッシュ管理<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p>環境変数を<code>.env</code>ファイルに実装する必要がある。</p>
<div class="highlight"><pre><span></span><code><span class="nv">CACHE_DRIVER</span><span class="o">=</span>redis
<span class="nv">REDIS_HOST</span><span class="o">=</span>&lt;Redisのホスト&gt;
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span>&lt;Redisのパスワード&gt;
<span class="nv">REDIS_PORT</span><span class="o">=</span>&lt;Redisのポート&gt;
</code></pre></div>
<p><br></p>
<h2 id="06-eventlistener">06. Event/Listener<a class="headerlink" href="#06-eventlistener" title="Permanent link">&para;</a></h2>
<h3 id="event">Event<a class="headerlink" href="#event" title="Permanent link">&para;</a></h3>
<h4 id="event_1">▼ Eventとは<a class="headerlink" href="#event_1" title="Permanent link">&para;</a></h4>
<p>ビジネスの出来事がモデリングされたイベントオブジェクトとして動作する。</p>
<h4 id="_10">▼ 構成<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>イベントに関するデータを保持するのみで、ビジネスロジックを持たない構成となる。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/events.html#defining-events">https://readouble.com/laravel/8.x/ja/events.html#defining-events</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">UserCreatedEvent</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var User</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nx">User</span> <span class="nv">$user</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>任意の場所でイベントを発行できる。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserCreatedEvent</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
</code></pre></div>
<h4 id="eloquentcrud">▼ EloquentモデルのCRUDイベント<a class="headerlink" href="#eloquentcrud" title="Permanent link">&para;</a></h4>
<p>Eloquentモデルでは、DBアクセスに関するメソッドの実行開始や終了の処理タイミングをイベントクラスに紐付けられる。</p>
<p>紐付けるために、プロパティで定義するか、あるいは各タイミングで実行されるクロージャーでイベントを発生させる必要がある。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/eloquent.html#events">https://readouble.com/laravel/8.x/ja/eloquent.html#events</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<p>プロパティにて、CREATE処理とDELETE処理に独自イベントクラスに紐付ける。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserDeleted</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\UserSaved</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dispatchesEvents</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">// 処理タイミングを独自イベントに紐付ける</span>
        <span class="s1">&#39;saved&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserSaved</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;deleted&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserDeleted</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>＊実装例＊</strong></p>
<p>クロージャーにて、CREATE処理に独自イベントクラスに紐付ける。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="na">created</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserCreated</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="listener">Listener<a class="headerlink" href="#listener" title="Permanent link">&para;</a></h3>
<h4 id="listener_1">▼ Listenerとは<a class="headerlink" href="#listener_1" title="Permanent link">&para;</a></h4>
<p>イベントが発生した時に、これに紐付いてコールされるオブジェクトのこと。</p>
<h4 id="_11">▼ 構成<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>Listenerクラスがコールされた時に実行する処理を<code>handle</code>関数に定義する。</p>
<p><strong>＊実装例＊</strong></p>
<p>ユーザーが作成された時に、メールアドレスにメッセージを送信する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserCreatedEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Notification</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">UserCreatedEventListener</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param UserCreatedEvent $userEvent</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">UserCreatedEvent</span> <span class="nv">$userEvent</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// UserクラスがNotifiableトレイトに依存せずに通知を実行できるように、オンデマンド通知を使用します。</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="nv">$userEvent</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">userEmailAddress</span><span class="o">-&gt;</span><span class="na">emailAddress</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserCreatedEventNotification</span><span class="p">(</span><span class="nv">$userEvent</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>任意の場所でイベントを発行すると、リスナーが自動的にコールされる。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserCreatedEvent</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
</code></pre></div>
<h4 id="_12">▼ イベントとリスナーの紐付け<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>EventServiceProviderクラスにて、Eventクラスに紐付ける1つ以上のListenerクラスを設定する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserCreatedEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Listeners\UserCreatedEventListener</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\EventServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EventServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$listen</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">UserCreatedEvent</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="nx">UserCreatedEventListener</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">boot</span><span class="p">();</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="eloquentcrud_1">▼ 任意のEloquentモデルCRUDイベントの検知<a class="headerlink" href="#eloquentcrud_1" title="Permanent link">&para;</a></h4>
<p>Laravelの多くのコンポーネントに、<code>boot</code>メソッドが定義されている。</p>
<p>Eloquentモデルでは、インスタンス作成時に<code>boot</code>メソッドがコールされ、これによりに<code>bootTraits</code>メソッドが実行される。</p>
<p>Traitに<code>boot+&lt;クラス名&gt;</code>という名前の静的メソッドが定義されていると、<code>bootTraits</code>メソッドはこれをコールする。</p>
<p><code>bootTraits</code>メソッドの中でEloquentモデルのイベントを発生させることにより、全てのEloquentモデルのイベントを一括で発火させられる。</p>
<p><strong>＊実装例＊</strong></p>
<p>あらかじめTraitを定義する。</p>
<p><code>saved</code>メソッドにEloquentモデルの更新イベントを登録可能にする。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models\Traits</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\UpdatedModelEvent</span><span class="p">;</span>

<span class="k">trait</span> <span class="nx">UpdatedModelTrait</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">bootUpdatedModelTrait</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// 任意のEloquentモデルのsaveメソッド実行時</span>
        <span class="k">static</span><span class="o">::</span><span class="na">saved</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Model</span> <span class="nv">$updatedModel</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// イベントを発生させる。</span>
            <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">UpdatedModelEvent</span><span class="p">(</span><span class="nv">$updatedModel</span><span class="p">));</span>
        <span class="p">});</span>

        <span class="c1">// 任意のEloquentモデルのdeleteメソッド実行時</span>
        <span class="k">static</span><span class="o">::</span><span class="na">deleted</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Model</span> <span class="nv">$updatedModel</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// イベントを発生させる。</span>
            <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">UpdatedModelEvent</span><span class="p">(</span><span class="nv">$updatedModel</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * イベントを発火させずにModelを保存します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">saveWithoutEvents</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// 無限ループを防ぐために、save実行時にイベントが発火しないようにする。</span>
        <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="na">withoutEvents</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$options</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// プロパティの変更を保存。</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>イベントを定義する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UpdatedModelEvent</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Model</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$updatedModel</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param Model</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Model</span> <span class="nv">$updatedModel</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$updatedModel</span> <span class="o">=</span> <span class="nv">$updatedModel</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Model更新イベントが発火してコールされるリスナーを定義する。</p>
<p><code>create_by</code>カラムまたは<code>updated_by</code>カラムを指定した更新者名に更新可能にする。</p>
<p>注意点として、イベントとリスナーの対応関係は、EventServiceProviderで登録する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UpdatedModelEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Constants\ExecutorConstant</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UpdatedModelListener</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param UpdatedModelEvent</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">UpdatedModelEvent</span> <span class="nv">$updatedModelEvent</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$by</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModelUpdater</span><span class="p">();</span>

        <span class="c1">// create_byプロパティに値が設定されているかを判定。</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$updatedModelEvent</span><span class="o">-&gt;</span><span class="na">updatedModel</span><span class="o">-&gt;</span><span class="na">created_by</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$updatedModelEvent</span><span class="o">-&gt;</span><span class="na">updatedModel</span><span class="o">-&gt;</span><span class="na">created_by</span> <span class="o">=</span> <span class="nv">$by</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$updatedModelEvent</span><span class="o">-&gt;</span><span class="na">updatedModel</span><span class="o">-&gt;</span><span class="na">updated_by</span> <span class="o">=</span> <span class="nv">$by</span><span class="p">;</span>

        <span class="nv">$updatedModelEvent</span><span class="o">-&gt;</span><span class="na">updatedModel</span><span class="o">-&gt;</span><span class="na">saveWithoutEvents</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 更新処理の実行者を取得します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">getModelUpdater</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="c1">// コンソール経由で実行されたかを判定。</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">runningInConsole</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">ARTISAN_COMMAND</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// API認証に成功したかを判定。</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">check</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">STAFF</span> <span class="o">.</span> <span class="s2">&quot;:&quot;</span> <span class="o">.</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">GUEST</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>実行者名は、定数として管理しておくと良い。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Constants</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * 実行者定数クラス</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">ExecutorConstant</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Artisanコマンド</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">ARTISAN_COMMAND</span> <span class="o">=</span> <span class="s2">&quot;Artisan Command&quot;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * スタッフ</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">STAFF</span> <span class="o">=</span> <span class="s2">&quot;Staff&quot;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * ゲスト</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">GUEST</span> <span class="o">=</span> <span class="s2">&quot;Guest&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<ul>
<li><a href="https://github.com/laravel/framework/blob/9362a29ce298428591369be8d101d51876406fc8/src/Illuminate/Database/Eloquent/Model.php#L255-L285">https://github.com/laravel/framework/blob/9362a29ce298428591369be8d101d51876406fc8/src/Illuminate/Database/Eloquent/Model.php#L255-L285</a></li>
</ul>
</blockquote>
<p><br></p>
<h2 id="07-exception">07. Exception<a class="headerlink" href="#07-exception" title="Permanent link">&para;</a></h2>
<h3 id="laravel_1">Laravelにおけるエラーハンドリング<a class="headerlink" href="#laravel_1" title="Permanent link">&para;</a></h3>
<p>エラーハンドリングは<code>4</code>個のステップからなる。</p>
<p>LaravelではデフォルトでHandlerクラスが全てのステップをカバーしている。</p>
<p>また加えて、異常系レスポンスを自動的に返信してくれる。</p>
<p>エラーハンドリングのステップのうち、エラー検出については言及しないこととする。</p>
<blockquote>
<ul>
<li><a href="https://hiroki-it.github.io/tech-notebook/language/language_php_logic_error_and_error_handling.html">https://hiroki-it.github.io/tech-notebook/language/language_php_logic_error_and_error_handling.html</a></li>
</ul>
</blockquote>
<p><br></p>
<h3 id="_13">例外スロー<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<h4 id="_14">▼ 例外<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<p>ドキュメントとしてまとめられていないが、デフォルトで様々な例外が備わっている。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/search.html?search=exception">https://laravel.com/api/8.x/search.html?search=exception</a></li>
</ul>
</blockquote>
<h4 id="_15">▼ スタックトレース<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>Laravelはスローされる例外のメッセージをスタックトレースで作成する。</p>
<p>また、Laravel内部で例外キャッチと新たな例外の投げ直しが行われるため、<code>[previous exception]</code>によって例外が結合される。</p>
<p>スタックトレースには機密性の高い情報が含まれるため、クライアントへの異常系レスポンスのエラーメッセージには割り当てずに、ロギングだけしておく。</p>
<p>エラーが複数行にまたがるため、CloudWatchやFluentBitなどのログ収集ツールでは、各行を繋げて扱えるように設定が必要である。</p>
<p>補足として、ログの詳細度は<code>APP_DEBUG</code>環境変数で制御できる。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/errors.html#configuration">https://readouble.com/laravel/8.x/ja/errors.html#configuration</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="m">2021</span>-09-00<span class="w"> </span><span class="m">00</span>:00:00<span class="o">]</span><span class="w"> </span>local.ERROR:<span class="w"> </span>*****<span class="w"> </span><span class="o">(</span>エラーメッセージ<span class="o">)</span>
<span class="o">[</span>stacktrace<span class="o">]</span>
<span class="c1">#0 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(652): Illuminate\\Database\\Connection-&gt;runQueryCallback(&#39;insert into `us...&#39;, Array, Object(Closure))</span>
<span class="c1">#1 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(486): Illuminate\\Database\\Connection-&gt;run(&#39;insert into `us...&#39;, Array, Object(Closure))</span>
<span class="c1">#2 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(438): Illuminate\\Database\\Connection-&gt;statement(&#39;insert into `us...&#39;, Array)</span>

...

<span class="c1">#60 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(141): Illuminate\\Pipeline\\Pipeline-&gt;then(Object(Closure))</span>
<span class="c1">#61 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(110): Illuminate\\Foundation\\Http\\Kernel-&gt;sendRequestThroughRouter(Object(Illuminate\\Http\\Request))</span>
<span class="c1">#62 /var/www/foo-app/public/index.php(55): Illuminate\\Foundation\\Http\\Kernel-&gt;handle(Object(Illuminate\\Http\\Request))</span>
<span class="c1">#63 {main}</span>

<span class="o">[</span>previous<span class="w"> </span>exception<span class="o">]</span><span class="w"> </span><span class="o">[</span>object<span class="o">]</span><span class="w"> </span>*****<span class="w"> </span><span class="o">(</span>エラーメッセージ<span class="o">)</span>
<span class="o">[</span>stacktrace<span class="o">]</span>
<span class="c1">#0 /var/www/foo-app/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php(114): Doctrine\\DBAL\\Driver\\PDO\\Exception::new(Object(PDOException))</span>
<span class="c1">#1 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(485): Doctrine\\DBAL\\Driver\\PDOStatement-&gt;execute()</span>
<span class="c1">#2 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(685): Illuminate\\Database\\Connection-&gt;Illuminate\\Database\\{closure}(&#39;insert into `us...&#39;, Array)</span>

...

<span class="c1">#63 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(141): Illuminate\\Pipeline\\Pipeline-&gt;then(Object(Closure))</span>
<span class="c1">#64 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(110): Illuminate\\Foundation\\Http\\Kernel-&gt;sendRequestThroughRouter(Object(Illuminate\\Http\\Request))</span>
<span class="c1">#65 /var/www/foo-app/public/index.php(55): Illuminate\\Foundation\\Http\\Kernel-&gt;handle(Object(Illuminate\\Http\\Request))</span>
<span class="c1">#66 {main}</span>

<span class="o">[</span>previous<span class="w"> </span>exception<span class="o">]</span><span class="w"> </span><span class="o">[</span>object<span class="o">]</span><span class="w"> </span>*****<span class="w"> </span><span class="o">(</span>エラーメッセージ<span class="o">)</span>
<span class="o">[</span>stacktrace<span class="o">]</span>
<span class="c1">#0 /var/www/foo-app/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php(112): PDOStatement-&gt;execute(NULL)</span>
<span class="c1">#1 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(485): Doctrine\\DBAL\\Driver\\PDOStatement-&gt;execute()</span>
<span class="c1">#2 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(685): Illuminate\\Database\\Connection-&gt;Illuminate\\Database\\{closure}(&#39;insert into `us...&#39;, Array)</span>

...

<span class="c1">#63 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(141): Illuminate\\Pipeline\\Pipeline-&gt;then(Object(Closure))</span>
<span class="c1">#64 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(110): Illuminate\\Foundation\\Http\\Kernel-&gt;sendRequestThroughRouter(Object(Illuminate\\Http\\Request))</span>
<span class="c1">#65 /var/www/foo-app/public/index.php(55): Illuminate\\Foundation\\Http\\Kernel-&gt;handle(Object(Illuminate\\Http\\Request))</span>
<span class="c1">#66 {main}</span>
<span class="s2">&quot;}</span>
</code></pre></div>
<p><br></p>
<h3 id="_16">ロギング<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<h4 id="report">▼ <code>report</code>メソッド<a class="headerlink" href="#report" title="Permanent link">&para;</a></h4>
<p>Laravel内部でキャッチされた例外を基に、ロギングを実行する。</p>
<blockquote>
<ul>
<li><a href="https://cpoint-lab.co.jp/article/201905/9841/">https://cpoint-lab.co.jp/article/201905/9841/</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Throwable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Exceptions\Handler</span> <span class="k">as</span> <span class="nx">ExceptionHandler</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Handler</span> <span class="k">extends</span> <span class="nx">ExceptionHandler</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$dontReport</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">//</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">report</span><span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">report</span><span class="p">(</span><span class="nv">$exception</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">...</span>

<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_17">異常系レスポンスの返信<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<h4 id="render">▼ <code>render</code>メソッド<a class="headerlink" href="#render" title="Permanent link">&para;</a></h4>
<p>Laravel内部でキャッチされた例外を基に、異常系レスポンスを自動的に返信する。</p>
<p>異常系レスポンスの返信処理もこれに追加できるが、異常系レスポンス間が密結合になるため、できるだけいじらない。</p>
<p>代わりとして、各コントローラーに<code>try-catch</code>と異常系レスポンスの返信処理を実装する。</p>
<blockquote>
<ul>
<li><a href="https://cpoint-lab.co.jp/article/201905/9841/">https://cpoint-lab.co.jp/article/201905/9841/</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Throwable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Exceptions\Handler</span> <span class="k">as</span> <span class="nx">ExceptionHandler</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Handler</span> <span class="k">extends</span> <span class="nx">ExceptionHandler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Throwable</span> <span class="nv">$exception</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h2 id="08-facade">08. Facade<a class="headerlink" href="#08-facade" title="Permanent link">&para;</a></h2>
<h3 id="facade">Facade<a class="headerlink" href="#facade" title="Permanent link">&para;</a></h3>
<h4 id="facade_1">▼ Facadeとは<a class="headerlink" href="#facade_1" title="Permanent link">&para;</a></h4>
<p>Facadeに登録されたクラス (Facadeクラス) とServiceContainerを繋ぐ静的プロキシとして働く。</p>
<p>メソッドをコールできるようになる。</p>
<h4 id="facade_2">▼ Facadeを使用しない場合<a class="headerlink" href="#facade_2" title="Permanent link">&para;</a></h4>
<p>new演算子でインスタンスを作成する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Domain\DTO</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// 通常</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
</code></pre></div>
<h4 id="facade_3">▼ Facadeの静的プロキシを使用する場合<a class="headerlink" href="#facade_3" title="Permanent link">&para;</a></h4>
<p>静的メソッドの記法でコールできる。</p>
<p>ただし、自作クラスをFacadeを使用してインスタンス化すると、スパゲッティな『Composition (合成) 』の依存関係を生じさせてしまう。</p>
<p>例えば、Facadeの中でも、<code>Route</code>のような、代替するよりもFacadeを使用したほうが断然便利である部分以外は、使用しないほうが良い。</p>
<p><strong>＊実装例＊</strong></p>
<p>Facadeとして使用したいクラスを定義する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Domain\DTO</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>エイリアスとクラスの名前空間を<code>config/app.php</code>ファイルを<code>aliases</code>キーに登録すると、そのエイリアスでインスタンス化とメソッドコールを行えるようになる。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="s2">&quot;aliases&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Foo&quot;</span> <span class="o">=&gt;</span> <span class="nx">App\Models\Foo</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>
<p>インスタンス化とメソッドコールを行う。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Foo</span><span class="p">;</span>

<span class="c1">// Facade利用</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">Foo</span><span class="o">::</span><span class="na">method</span><span class="p">();</span>
</code></pre></div>
<h4 id="facade_4">▼ Facadeを使用した方が良い場合<a class="headerlink" href="#facade_4" title="Permanent link">&para;</a></h4>
<p>Facadeがトレイトの代わりになる場合、Facadeを使用することにより、責務がドメインモデルに集中せずにすむ。</p>
<p><strong>＊例＊</strong></p>
<p>NotifiableトレイトをUserクラスで使用せずに、Notificationファサードによるオンデマンド通知を使用することにより、Userクラスが通知処理の責務を持たずに済む。</p>
<h4 id="facade_5">▼ 標準登録されたFacadeクラスの種類<a class="headerlink" href="#facade_5" title="Permanent link">&para;</a></h4>
<p>以下のクラスは、デフォルトで登録されているFacadeである。</p>
<table>
<thead>
<tr>
<th style="text-align: left;">エイリアス</th>
<th style="text-align: left;">クラス名</th>
<th style="text-align: left;">サービスコンテナ結合キー</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">App</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Foundation/Application.html">Illuminate\Foundation\Application</a></td>
<td style="text-align: left;"><code>app</code></td>
</tr>
<tr>
<td style="text-align: left;">Artisan</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Console/Kernel.html">Illuminate\Contracts\Console\Kernel</a></td>
<td style="text-align: left;"><code>artisan</code></td>
</tr>
<tr>
<td style="text-align: left;">Auth</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Auth/AuthManager.html">Illuminate\Auth\AuthManager</a></td>
<td style="text-align: left;"><code>auth</code></td>
</tr>
<tr>
<td style="text-align: left;">Auth (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Auth/Guard.html">Illuminate\Contracts\Auth\Guard</a></td>
<td style="text-align: left;"><code>auth.driver</code></td>
</tr>
<tr>
<td style="text-align: left;">Blade</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/View/Compilers/BladeCompiler.html">Illuminate\View\Compilers\BladeCompiler</a></td>
<td style="text-align: left;"><code>blade.compiler</code></td>
</tr>
<tr>
<td style="text-align: left;">Broadcast</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Broadcasting/Factory.html">Illuminate\Contracts\Broadcasting\Factory</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Broadcast (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Broadcasting/Broadcaster.html">Illuminate\Contracts\Broadcasting\Broadcaster</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Bus</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Bus/Dispatcher.html">Illuminate\Contracts\Bus\Dispatcher</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Cache</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Cache/CacheManager.html">Illuminate\Cache\CacheManager</a></td>
<td style="text-align: left;"><code>cache</code></td>
</tr>
<tr>
<td style="text-align: left;">Cache (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Cache/Repository.html">Illuminate\Cache\Repository</a></td>
<td style="text-align: left;"><code>cache.store</code></td>
</tr>
<tr>
<td style="text-align: left;">Config</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Config/Repository.html">Illuminate\Config\Repository</a></td>
<td style="text-align: left;"><code>config</code></td>
</tr>
<tr>
<td style="text-align: left;">Cookie</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Cookie/CookieJar.html">Illuminate\Cookie\CookieJar</a></td>
<td style="text-align: left;"><code>cookie</code></td>
</tr>
<tr>
<td style="text-align: left;">Crypt</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Encryption/Encrypter.html">Illuminate\Encryption\Encrypter</a></td>
<td style="text-align: left;"><code>encrypter</code></td>
</tr>
<tr>
<td style="text-align: left;">DB</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Database/DatabaseManager.html">Illuminate\Database\DatabaseManager</a></td>
<td style="text-align: left;"><code>db</code></td>
</tr>
<tr>
<td style="text-align: left;">DB (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Database/Connection.html">Illuminate\Database\Connection</a></td>
<td style="text-align: left;"><code>db.connection</code></td>
</tr>
<tr>
<td style="text-align: left;">Event</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Events/Dispatcher.html">Illuminate\Events\Dispatcher</a></td>
<td style="text-align: left;"><code>events</code></td>
</tr>
<tr>
<td style="text-align: left;">File</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Filesystem/Filesystem.html">Illuminate\Filesystem\Filesystem</a></td>
<td style="text-align: left;"><code>files</code></td>
</tr>
<tr>
<td style="text-align: left;">Gate</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Auth/Access/Gate.html">Illuminate\Contracts\Auth\Access\Gate</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Hash</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Hashing/Hasher.html">Illuminate\Contracts\Hashing\Hasher</a></td>
<td style="text-align: left;"><code>hash</code></td>
</tr>
<tr>
<td style="text-align: left;">Lang</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Translation/Translator.html">Illuminate\Translation\Translator</a></td>
<td style="text-align: left;"><code>translator</code></td>
</tr>
<tr>
<td style="text-align: left;">Log</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Log/LogManager.html">Illuminate\Log\LogManager</a></td>
<td style="text-align: left;"><code>log</code></td>
</tr>
<tr>
<td style="text-align: left;">Mail</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Mail/Mailer.html">Illuminate\Mail\Mailer</a></td>
<td style="text-align: left;"><code>mailer</code></td>
</tr>
<tr>
<td style="text-align: left;">Notification</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Notifications/ChannelManager.html">Illuminate\Notifications\ChannelManager</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Password</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Auth/Passwords/PasswordBrokerManager.html">Illuminate\Auth\Passwords\PasswordBrokerManager</a></td>
<td style="text-align: left;"><code>auth.password</code></td>
</tr>
<tr>
<td style="text-align: left;">Password (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Auth/Passwords/PasswordBroker.html">Illuminate\Auth\Passwords\PasswordBroker</a></td>
<td style="text-align: left;"><code>auth.password.broker</code></td>
</tr>
<tr>
<td style="text-align: left;">Queue</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Queue/QueueManager.html">Illuminate\Queue\QueueManager</a></td>
<td style="text-align: left;"><code>queue</code></td>
</tr>
<tr>
<td style="text-align: left;">Queue (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Queue/Queue.html">Illuminate\Contracts\Queue\Queue</a></td>
<td style="text-align: left;"><code>queue.connection</code></td>
</tr>
<tr>
<td style="text-align: left;">Queue (Base Class)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Queue/Queue.html">Illuminate\Queue\Queue</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Redirect</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Routing/Redirector.html">Illuminate\Routing\Redirector</a></td>
<td style="text-align: left;"><code>redirect</code></td>
</tr>
<tr>
<td style="text-align: left;">Redis</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Redis/RedisManager.html">Illuminate\Redis\RedisManager</a></td>
<td style="text-align: left;"><code>redis</code></td>
</tr>
<tr>
<td style="text-align: left;">Redis (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Redis/Connections/Connection.html">Illuminate\Redis\Connections\Connection</a></td>
<td style="text-align: left;"><code>redis.connection</code></td>
</tr>
<tr>
<td style="text-align: left;">Request</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Http/Request.html">Illuminate\Http\Request</a></td>
<td style="text-align: left;"><code>request</code></td>
</tr>
<tr>
<td style="text-align: left;">Response</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Routing/ResponseFactory.html">Illuminate\Contracts\Routing\ResponseFactory</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Response (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Http/Response.html">Illuminate\Http\Response</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Route</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Routing/Router.html">Illuminate\Routing\Router</a></td>
<td style="text-align: left;"><code>router</code></td>
</tr>
<tr>
<td style="text-align: left;">Schema</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Database/Schema/Builder.html">Illuminate\Database\Schema\Builder</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Session</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Session/SessionManager.html">Illuminate\Session\SessionManager</a></td>
<td style="text-align: left;"><code>session</code></td>
</tr>
<tr>
<td style="text-align: left;">Session (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Session/Store.html">Illuminate\Session\Store</a></td>
<td style="text-align: left;"><code>session.store</code></td>
</tr>
<tr>
<td style="text-align: left;">Storage</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Filesystem/FilesystemManager.html">Illuminate\Filesystem\FilesystemManager</a></td>
<td style="text-align: left;"><code>filesystem</code></td>
</tr>
<tr>
<td style="text-align: left;">Storage (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Contracts/Filesystem/Filesystem.html">Illuminate\Contracts\Filesystem\Filesystem</a></td>
<td style="text-align: left;"><code>filesystem.disk</code></td>
</tr>
<tr>
<td style="text-align: left;">URL</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Routing/UrlGenerator.html">Illuminate\Routing\UrlGenerator</a></td>
<td style="text-align: left;"><code>url</code></td>
</tr>
<tr>
<td style="text-align: left;">Validator</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Validation/Factory.html">Illuminate\Validation\Factory</a></td>
<td style="text-align: left;"><code>validator</code></td>
</tr>
<tr>
<td style="text-align: left;">Validator (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/Validation/Validator.html">Illuminate\Validation\Validator</a></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">View</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/View/Factory.html">Illuminate\View\Factory</a></td>
<td style="text-align: left;"><code>view</code></td>
</tr>
<tr>
<td style="text-align: left;">View (Instance)</td>
<td style="text-align: left;"><a href="https://laravel.com/api/8.x/Illuminate/View/View.html">Illuminate\View\View</a></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="auth">Authファサード<a class="headerlink" href="#auth" title="Permanent link">&para;</a></h3>
<h4 id="auth_1">▼ Authファサードとは<a class="headerlink" href="#auth_1" title="Permanent link">&para;</a></h4>
<p>認証に関する処理を提供する。</p>
<p>Laravelからあらかじめ提供されている認証を使用しない場合、Authファサードを使用して、認証ロジックを実装できる。</p>
<p><br></p>
<h3 id="db_1">DBファサード<a class="headerlink" href="#db_1" title="Permanent link">&para;</a></h3>
<h4 id="db_2">▼ DBファサードとは<a class="headerlink" href="#db_2" title="Permanent link">&para;</a></h4>
<p>DBの操作処理を提供する。</p>
<p>Eloquentの代わりとして、DBファサードを使用しても良い。</p>
<p>Active Recordのロジックを持たないため、Repositoryパターンのロジックとして使用できる。</p>
<h4 id="transaction">▼ <code>transaction</code>メソッド<a class="headerlink" href="#transaction" title="Permanent link">&para;</a></h4>
<p>一連のトランザクション処理を実行する。</p>
<p>引数として渡した無名関数が例外を返却した場合、ロールバックを自動的に実行する。</p>
<p>例外が発生しなかった場合、無名関数の返却値が、そのまま<code>transaction</code>メソッドの返却値になる。</p>
<p>加えて<code>transaction</code>メソッドの返却値を返却するようにすれば、無名関数の返却値をそのまま使用できる。</p>
<p>補足として、トランザクション処理は必須ではなく、使用するとアプリケーションがDBを操作するために要する時間が増えるため、使用しなくても良い。</p>
<p>参考リンクによると、MongoDBに対してトランザクション処理を行う/行わない場合を比較して、処理時間が17%弱長くなったとのこと。</p>
<blockquote>
<ul>
<li><a href="https://rightcode.co.jp/blog/information-technology/node-js-mongodb-transaction-function-use#i-5">https://rightcode.co.jp/blog/information-technology/node-js-mongodb-transaction-function-use#i-5</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Infrastructure\Repositories</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Domain\Foo\Entities\Foo</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Domain\Foo\Repositories\FooRepository</span> <span class="k">as</span> <span class="nx">DomainFooRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Infrastructure\Foo\DTO\FooDTO</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Throwable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooRepository</span> <span class="k">extends</span> <span class="nx">Repository</span> <span class="k">implements</span> <span class="nx">DomainFooRepository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var FooDTO</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nx">FooDTO</span> <span class="nv">$fooDTO</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">FooDTO</span> <span class="nv">$fooDTO</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fooDTO</span> <span class="o">=</span> <span class="nv">$fooDTO</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param Foo $foo</span>
<span class="sd">     * @throws Throwable</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">(</span><span class="nx">Foo</span> <span class="nv">$foo</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// トランザクション処理を開始する。</span>
        <span class="nx">DB</span><span class="o">::</span><span class="na">beginTransaction</span><span class="p">();</span>

        <span class="k">try</span> <span class="p">{</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fooDTO</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">([</span>
                    <span class="s2">&quot;name&quot;</span>  <span class="o">=&gt;</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(),</span>
                    <span class="s2">&quot;age&quot;</span>   <span class="o">=&gt;</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">(),</span>
                <span class="p">])</span>
                <span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

            <span class="c1">// コミットメントを実行する。</span>
            <span class="nx">DB</span><span class="o">::</span><span class="na">commit</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// ロールバックする。</span>
            <span class="nx">DB</span><span class="o">::</span><span class="na">rollback</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="begintransactioncommitrollback">▼ <code>beginTransaction</code>メソッド、<code>commit</code>メソッド、<code>rollback</code>メソッド、<a class="headerlink" href="#begintransactioncommitrollback" title="Permanent link">&para;</a></h4>
<p>トランザクション処理の各操作を分割して実行する。</p>
<p>基本的には、<code>transaction</code>メソッドを使用してトランザクション処理を実行すれば良い。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Infrastructure\Repositories</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Domain\Foo\Entities\Foo</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Domain\Foo\Repositories\FooRepository</span> <span class="k">as</span> <span class="nx">DomainFooRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Infrastructure\Foo\DTO\FooDTO</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooRepository</span> <span class="k">extends</span> <span class="nx">Repository</span> <span class="k">implements</span> <span class="nx">DomainFooRepository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var FooDTO</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nx">FooDTO</span> <span class="nv">$fooDTO</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">FooDTO</span> <span class="nv">$fooDTO</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fooDTO</span> <span class="o">=</span> <span class="nv">$fooDTO</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Fooを更新します。</span>


<span class="sd">     *</span>
<span class="sd">     * @param Foo $foo</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">(</span><span class="nx">Foo</span> <span class="nv">$foo</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// トランザクション処理を開始する。</span>
        <span class="nx">DB</span><span class="o">::</span><span class="na">beginTransaction</span><span class="p">();</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fooDTO</span>
            <span class="c1">// オブジェクトにデータを設定する。</span>
            <span class="o">-&gt;</span><span class="na">fill</span><span class="p">([</span>
                <span class="s2">&quot;name&quot;</span>  <span class="o">=&gt;</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(),</span>
                <span class="s2">&quot;age&quot;</span>   <span class="o">=&gt;</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">(),</span>
                <span class="s2">&quot;email&quot;</span> <span class="o">=&gt;</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">()</span>
            <span class="p">])</span>
            <span class="c1">// update文を実行する。</span>
            <span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

            <span class="c1">// コミットメントを実行する。</span>
            <span class="nx">DB</span><span class="o">::</span><span class="na">commit</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// ロールバックする。</span>
            <span class="nx">DB</span><span class="o">::</span><span class="na">rollback</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="route">Routeファサード<a class="headerlink" href="#route" title="Permanent link">&para;</a></h3>
<h4 id="route_1">▼ Routeファサードとは<a class="headerlink" href="#route_1" title="Permanent link">&para;</a></h4>
<p>ルーティング処理を提供する。</p>
<h4 id="_18">▼ ヘルスチェックへの対応<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p>ALBやGlobal Acceleratorから『<code>/healthcheck</code>』に対してヘルスチェックを設定した上で、<code>200</code>ステータスを含むレスポンスを返信する。</p>
<p>Nginxでヘルスチェックを実装もできるが、アプリケーションの死活管理としては、Laravelに実装する方が適切である。</p>
<p>RouteServiceProviderも参照せよ。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1"># ヘルスチェックを受信するパス</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/healthcheck&quot;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="middleware">▼ <code>middleware</code>メソッド<a class="headerlink" href="#middleware" title="Permanent link">&para;</a></h4>
<p>コントローラーへのルーティング時に実行するMiddlewareクラスを設定する。</p>
<p>引数として、<code>App\Http\Kernel.php</code>ファイルで定義されたMiddlewareクラスのエイリアスを設定する。</p>
<p><strong>＊実装例＊</strong></p>
<p>認証方法としてWebガードを使用する場合、<code>auth</code>エイリアスを設定する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Foo\FooController</span><span class="p">;</span>

<span class="c1">// authエイリアスを設定する。</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">middleware</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/foo&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;getFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/foo/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s2">&quot;/foo&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;createFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s2">&quot;/foo/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;updateFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s2">&quot;/foo/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;deleteFoo&quot;</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>デフォルトでは、<code>App\Http\Kernel.php</code>ファイルにて、<code>auth</code>エイリアスに<code>\App\Http\Middleware\Authenticate</code>クラスが紐付けられている。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Middleware\BeforeMiddleware\FooIdConverterMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\Kernel</span> <span class="k">as</span> <span class="nx">HttpKernel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Kernel</span> <span class="k">extends</span> <span class="nx">HttpKernel</span>
<span class="p">{</span>

    <span class="o">...</span>

    <span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>

        <span class="s2">&quot;auth&quot;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>

    <span class="p">];</span>

    <span class="o">...</span>

<span class="p">}</span>
</code></pre></div>
<p>一方で、認証方法としてAPIガードを使用する場合、<code>auth:api</code>エイリアスを設定する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// authエイリアスのMiddlewareクラスが使用される。</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">middleware</span><span class="p">(</span><span class="s2">&quot;auth:api&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 何らのルーティング</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="prefix">▼ <code>prefix</code>メソッド<a class="headerlink" href="#prefix" title="Permanent link">&para;</a></h4>
<p>エンドポイントが共通として持つ最初のパスを、接頭辞として定義する。</p>
<p><strong>＊実装例＊</strong></p>
<p>各エンドポイントの最初の『<code>foos</code>』を接頭辞として定義する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Foo\FooController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">prefix</span><span class="p">(</span><span class="s2">&quot;foos&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;getFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;createFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;updateFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;deleteFoo&quot;</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="wherepattern">▼ <code>where</code>メソッド、<code>pattern</code>メソッド<a class="headerlink" href="#wherepattern" title="Permanent link">&para;</a></h4>
<p>パスパラメーターに対するバリデーションルールを正規表現で定義し、加えて実行する。</p>
<p>RouteServiceProviderの<code>boot</code>メソッドにて、<code>pattern</code>メソッドで制約を設定することによって、ルーティング時にwhereを使用する必要がなくなる。</p>
<p><strong>＊実装例＊</strong></p>
<p>userIdの形式を『0〜9が1つ以上』に設定している。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Foo\FooController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">prefix</span><span class="p">(</span><span class="s2">&quot;foos&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;getFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">])</span>
        <span class="c1">// バリデーションルール</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;fooId&quot;</span><span class="p">,</span> <span class="s2">&quot;[0-9]+&quot;</span><span class="p">);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;createFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;updateFoo&quot;</span><span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;fooId&quot;</span><span class="p">,</span> <span class="s2">&quot;[0-9]+&quot;</span><span class="p">);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;deleteFoo&quot;</span><span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;fooId&quot;</span><span class="p">,</span> <span class="s2">&quot;[0-9]+&quot;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>または、RouteServiceProviderクラスに<code>pattern</code>メソッドを定義すると、各エンドポイントに対する正規表現を一括で実行できる。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/routing.html#parameters-global-constraints">https://readouble.com/laravel/8.x/ja/routing.html#parameters-global-constraints</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\RouteServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RouteServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ルーティングの設定ファイルをコールします。</span>


<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// バリデーションルールとして『0〜9が1つ以上』を定義する。</span>
        <span class="nx">Route</span><span class="o">::</span><span class="na">pattern</span><span class="p">(</span><span class="s1">&#39;fooId&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>

        <span class="c1">// 〜 中略 〜</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="group">▼ <code>group</code>メソッド<a class="headerlink" href="#group" title="Permanent link">&para;</a></h4>
<p>複数のグループを組み合わせる場合、<code>group</code>メソッドを使用する。</p>
<p><strong>＊実装例＊</strong></p>
<p>エンドポイントの接頭辞とミドルウェアの指定を定義する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span><span class="s2">&quot;prefix&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;foo&quot;</span> <span class="p">,</span> <span class="s2">&quot;middleware&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;auth&quot;</span><span class="p">],</span> <span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;getFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;createFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;updateFoo&quot;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s2">&quot;/{fooId}&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s2">&quot;deleteFoo&quot;</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p><br></p>
<h3 id="storage">Storageファサード<a class="headerlink" href="#storage" title="Permanent link">&para;</a></h3>
<h4 id="storage_1">▼ Storageファサードとは<a class="headerlink" href="#storage_1" title="Permanent link">&para;</a></h4>
<p>ファイルの入出力処理を提供する。</p>
<h4 id="_19">▼ ローカルストレージ (非公開) の場合<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>ファイルを<code>/storage/app</code>ディレクトリ配下に保存する。</p>
<p>このファイルは非公開であり、リクエストによってアクセスできない。</p>
<p>事前に、シンボリックリンクを作成する、また、<code>filesystems.php</code>ファイルに設定が必要である。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>storage:link
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="x">return [</span>

<span class="x">    &quot;default&quot; =&gt; env(&quot;FILESYSTEM_DRIVER&quot;, &quot;local&quot;),</span>

<span class="x">     ...</span>

<span class="x">    &quot;disks&quot; =&gt; [</span>

<span class="x">        &quot;local&quot; =&gt; [</span>
<span class="x">            &quot;driver&quot; =&gt; &quot;local&quot;,</span>
<span class="x">            &quot;root&quot;   =&gt; storage_path(&quot;app&quot;),</span>
<span class="x">        ],</span>

<span class="x">     ...</span>

<span class="x">    // シンボリックリンクの関係を定義</span>
<span class="x">    &quot;links&quot; =&gt; [</span>

<span class="x">        // 『/var/www/project/public/storage』から『/var/www/project/storage/app/public』へのリンク</span>
<span class="x">        public_path(&quot;storage&quot;) =&gt; storage_path(&quot;app/public&quot;),</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>
<p><strong>＊実装例＊</strong></p>
<p>Storageファサードの<code>disk</code>メソッドを使用してlocalディスクを指定する。</p>
<p><code>file.txt</code>ファイルを<code>storage/app/file.txt</code>として保存する。</p>
<div class="highlight"><pre><span></span><code><span class="x">Storage::disk(&quot;local&quot;)-&gt;put(&quot;file.txt&quot;, &quot;file.txt&quot;);</span>
</code></pre></div>
<p>ただし、<code>filesytems.php</code>ファイルでデフォルトディスクは<code>local</code>になっているため、<code>put</code>メソッドを直接的に使用できる。</p>
<div class="highlight"><pre><span></span><code><span class="x">Storage::put(&quot;file.txt&quot;, &quot;file.txt&quot;);</span>
</code></pre></div>
<h4 id="_20">▼ ローカルストレージ (公開) の場合<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<p>ファイルを<code>storage/app/public</code>ディレクトリ配下に保存する。</p>
<p>このファイルは公開であり、リクエストによってアクセスできる。</p>
<p>事前に、<code>filesystems.php</code>ファイルに設定が必要である。</p>
<div class="highlight"><pre><span></span><code><span class="x">return [</span>

<span class="x">    &quot;default&quot; =&gt; env(&quot;FILESYSTEM_DRIVER&quot;, &quot;local&quot;),</span>

<span class="x">     ...</span>

<span class="x">    &quot;disks&quot; =&gt; [</span>

<span class="x">        ...</span>

<span class="x">        &quot;public&quot; =&gt; [</span>
<span class="x">            &quot;driver&quot;     =&gt; &quot;local&quot;,</span>
<span class="x">            &quot;root&quot;       =&gt; storage_path(&quot;app/public&quot;),</span>
<span class="x">            &quot;url&quot;        =&gt; env(&quot;APP_URL&quot;) . &quot;/storage&quot;,</span>
<span class="x">            &quot;visibility&quot; =&gt; &quot;public&quot;,</span>
<span class="x">        ],</span>

<span class="x">        ...</span>

<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>
<p><strong>＊実装例＊</strong></p>
<p>Storageファサードの<code>disk</code>メソッドを使用してpublicディスクを指定する。</p>
<p>また、<code>file.txt</code>ファイルを<code>storage/app/public/file.txt</code>として保存する。</p>
<div class="highlight"><pre><span></span><code><span class="x">Storage::disk(&quot;s3&quot;)-&gt;put(&quot;file.txt&quot;, &quot;file.txt&quot;);</span>
</code></pre></div>
<p>ただし、環境変数を使用して、<code>filesytems.php</code>ファイルでデフォルトディスクを<code>s3</code>に変更すると、<code>put</code>メソッドを直接的に使用できる。</p>
<div class="highlight"><pre><span></span><code><span class="x">FILESYSTEM_DRIVER=s3</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="x">Storage::put(&quot;file.txt&quot;, &quot;file.txt&quot;);</span>
</code></pre></div>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Storage</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileSystemPublicController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ファイルをpublicディスクに保存する</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">putContentsInPublicDisk</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 保存先をpublicに設定する。</span>
        <span class="nv">$disk</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s2">&quot;public&quot;</span><span class="p">);</span>

        <span class="c1">// 保存先のファイルを読み込む</span>
        <span class="nv">$file_path</span> <span class="o">=</span> <span class="s2">&quot;/path/to/public/foo.jpg&quot;</span>
        <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">);</span>

        <span class="c1">// 保存先パス (ディレクトリ+ファイル名)</span>
        <span class="nv">$saved_file_path</span> <span class="o">=</span> <span class="s2">&quot;/images/foo.jpg&quot;</span><span class="p">;</span>

        <span class="c1">// foo.jpgを『/images/foo.jpg』に保存</span>
        <span class="c1">// ルートディレクトリは『/storage/app/public』</span>
        <span class="nv">$disk</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="nv">$saved_file_path</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_21">▼ クラウドストレージの場合<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p>ファイルをS3バケット内のディレクトリ配下に保存する。</p>
<p>環境変数を<code>.env</code>ファイルに実装する必要がある。</p>
<p><code>filesystems.php</code>ファイルから、指定された設定が選択される。</p>
<p>AWSアカウントの認証情報を環境変数として設定するか、またはS3アクセスポリシーをEC2やECSタスクに付与することにより、S3にアクセスできるようになる。</p>
<p>事前に、<code>filesystems.php</code>ファイルに設定が必要である。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># S3アクセスポリシーをEC2やECSタスクに付与しても良い</span>
<span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>&lt;アクセスキーID&gt;
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>&lt;シークレットアクセスキー&gt;
<span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>ap-northeast-1

<span class="c1"># 必須</span>
<span class="nv">AWS_BUCKET</span><span class="o">=</span>&lt;バケット名&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="x">return [</span>

<span class="x">    &quot;default&quot; =&gt; env(&quot;FILESYSTEM_DRIVER&quot;, &quot;local&quot;),</span>

<span class="x">     ...</span>

<span class="x">    &quot;disks&quot; =&gt; [</span>

<span class="x">        ...</span>

<span class="x">        &quot;s3&quot; =&gt; [</span>
<span class="x">            &quot;driver&quot;   =&gt; &quot;s3&quot;,</span>
<span class="x">            &quot;key&quot;      =&gt; env(&quot;AWS_ACCESS_KEY_ID&quot;),</span>
<span class="x">            &quot;secret&quot;   =&gt; env(&quot;AWS_SECRET_ACCESS_KEY&quot;),</span>
<span class="x">            &quot;region&quot;   =&gt; env(&quot;AWS_DEFAULT_REGION&quot;),</span>
<span class="x">            &quot;bucket&quot;   =&gt; env(&quot;AWS_BUCKET&quot;),</span>
<span class="x">            &quot;url&quot;      =&gt; env(&quot;AWS_URL&quot;),</span>
<span class="x">            &quot;endpoint&quot; =&gt; env(&quot;AWS_ENDPOINT&quot;),</span>
<span class="x">        ],</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>
<p><strong>＊実装例＊</strong></p>
<p>Storageファサードの<code>disk</code>メソッドを使用してs3ディスクを指定する。</p>
<p>また、<code>file.txt</code>ファイルをS3バケットのルートに<code>file.txt</code>として保存する。</p>
<div class="highlight"><pre><span></span><code><span class="x">Storage::disk(&quot;s3&quot;)-&gt;put(&quot;file.txt&quot;, &quot;file.txt&quot;);</span>
</code></pre></div>
<p>他の実装方法として、環境変数を使用して、<code>filesytems.php</code>ファイルでデフォルトディスクを<code>s3</code>に変更すると、<code>put</code>メソッドを直接的に使用できる。</p>
<div class="highlight"><pre><span></span><code><span class="nv">FILESYSTEM_DRIVER</span><span class="o">=</span>s3
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="x">Storage::put(&quot;file.txt&quot;, &quot;file.txt&quot;);</span>
</code></pre></div>
<p><br></p>
<h3 id="validator">Validatorファサード<a class="headerlink" href="#validator" title="Permanent link">&para;</a></h3>
<h4 id="validator_1">▼ Validatorファサードとは<a class="headerlink" href="#validator_1" title="Permanent link">&para;</a></h4>
<p>バリデーション処理を提供する。</p>
<p>FormRequestクラスの<code>validated</code>メソッドや<code>validate</code>メソッドの代わりとして、Validatorファサードを使用しても良い。</p>
<h4 id="validatorfails">▼ Validatorクラス、<code>fails</code>メソッド<a class="headerlink" href="#validatorfails" title="Permanent link">&para;</a></h4>
<p>Validateファサードの<code>make</code>メソッドを使用して、ルールを定義する。</p>
<p>この時、第一引数で、バリデーションを行うリクエストデータを渡す。</p>
<p>ルールに反すると、1つ目のルール名 (例：<code>required</code>) に基づき、<code>validation.php</code>ファイルから対応するエラーメッセージを自動的に選択する。</p>
<p>次に、<code>fails</code>メソッドを使用して、バリデーションでエラーが発生した場合の処理を定義する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Validator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 新しいブログポストの保存</span>
<span class="sd">     *</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義</span>
        <span class="nv">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span>
            <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;required|unique:posts|max:255&quot;</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="c1">// バリデーション時にエラーが発生した場合</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">fails</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// 指定したWebページにリダイレクト</span>
            <span class="c1">// validatorを渡すことにより、エラーメッセージをViewに渡せる。</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">withErrors</span><span class="p">(</span><span class="nv">$validator</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">withInput</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// 続きの処理</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="validate">▼ <code>validate</code>メソッド<a class="headerlink" href="#validate" title="Permanent link">&para;</a></h4>
<p>Validatorクラスの<code>validate</code>メソッドを使用すると、FormRequestクラスの<code>validate</code>メソッドと同様の処理が実行される。</p>
<p>バリデーションでエラーが発生した場合、Handlerクラスの<code>invalid</code>メソッドがコールされ、元のWebページにリダイレクトされる。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Validator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 新しいブログポストの保存</span>
<span class="sd">     *</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 元のWebページにリダイレクトする場合は、validateメソッドを使用する。</span>
        <span class="nv">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span>
            <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span>
            <span class="p">[</span>
                <span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;required|unique:posts|max:255&quot;</span><span class="p">,</span>
                <span class="s2">&quot;body&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span>
            <span class="p">])</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">();</span>

        <span class="c1">// バリデーション時にエラーが発生した場合</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">fails</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// 指定したWebページにリダイレクト</span>
            <span class="c1">// validatorを渡すことにより、エラーメッセージをViewに渡せる。</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">withErrors</span><span class="p">(</span><span class="nv">$validator</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">withInput</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// 続きの処理</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h2 id="08-02">08-02. よく使用するグローバルヘルパー関数<a class="headerlink" href="#08-02" title="Permanent link">&para;</a></h2>
<h3 id="_22">ヘルパー関数<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<h4 id="_23">▼ ヘルパー関数とは<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<p>グローバルにコールできるLaravel専用のメソッドのこと。</p>
<p>基本的には、ヘルパー関数で実行される処理は、Facadeの内部で実行されるものと同じである。</p>
<p>どちらを使用するかは好みである。</p>
<blockquote>
<ul>
<li><a href="https://stackoverflow.com/questions/31324226/laravel-performance-of-facades-vs-helper-methods">https://stackoverflow.com/questions/31324226/laravel-performance-of-facades-vs-helper-methods</a></li>
</ul>
</blockquote>
<h4 id="_24">▼ 一覧<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h4>
<p>以下リンクを参考にせよ。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/helpers.html#method-view">https://readouble.com/laravel/8.x/ja/helpers.html#method-view</a></li>
</ul>
</blockquote>
<p><br></p>
<h3 id="auth_2"><code>auth</code>ヘルパー<a class="headerlink" href="#auth_2" title="Permanent link">&para;</a></h3>
<h4 id="authmanager">▼ AuthManagerインスタンスの返却<a class="headerlink" href="#authmanager" title="Permanent link">&para;</a></h4>
<p>認証処理を持つAuthManagerクラスのインスタンスを返却する。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Auth/AuthManager.html">https://laravel.com/api/8.x/Illuminate/Auth/AuthManager.html</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// Illuminate\Auth\AuthManager</span>
<span class="nv">$auth</span> <span class="o">=</span> <span class="nx">auth</span><span class="p">();</span>
</code></pre></div>
<p><br></p>
<h3 id="config"><code>config</code>ヘルパー<a class="headerlink" href="#config" title="Permanent link">&para;</a></h3>
<h4 id="_25">▼ 環境変数ファイルの読み出し<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h4>
<p>環境変数ファイル名とキー名をドットで指定し、事前に設定された値を出力する。</p>
<p><strong>＊実装例＊</strong></p>
<p>デフォルトで搭載されている<code>app.php</code>ファイルの<code>timezone</code>キーの値を出力する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nv">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s2">&quot;app.timezone&quot;</span><span class="p">);</span>
</code></pre></div>
<h4 id="_26">▼ 独自環境変数ファイルの作成と読み出し<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h4>
<p>任意の名前のphp形式ファイルを<code>config</code>ディレクトリ配下に作成しておく。</p>
<p>これは、configヘルパーで読み込める。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nv">$requestUrl</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s2">&quot;api.foo.endpoint_url&quot;</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="s2">&quot;foo&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">&quot;endpoint_url&quot;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;ENDPOINT_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="s2">&quot;api_key&quot;</span>      <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;bar&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">&quot;endpoint_url&quot;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;ENDPOINT_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="s2">&quot;api_key&quot;</span>      <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">];</span>
</code></pre></div>
<p><br></p>
<h3 id="bcrypt"><code>bcrypt</code>ヘルパー<a class="headerlink" href="#bcrypt" title="Permanent link">&para;</a></h3>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/helpers.html#method-bcrypt">https://readouble.com/laravel/8.x/ja/helpers.html#method-bcrypt</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nv">$hash</span> <span class="o">=</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span> <span class="c1">// 『foo』をハッシュ化して、『$2y$10$ZkYG.whhdcogCCzbG.VlQ』としてDBで管理する。</span>
</code></pre></div>
<p><br></p>
<h3 id="redirect"><code>redirect</code>ヘルパー<a class="headerlink" href="#redirect" title="Permanent link">&para;</a></h3>
<blockquote>
<ul>
<li><a href="https://blog.capilano-fw.com/?p=566">https://blog.capilano-fw.com/?p=566</a></li>
</ul>
</blockquote>
<p><br></p>
<h3 id="response"><code>response</code>ヘルパー<a class="headerlink" href="#response" title="Permanent link">&para;</a></h3>
<h4 id="json">▼ JSON型データを含むレスポンス<a class="headerlink" href="#json" title="Permanent link">&para;</a></h4>
<p>返却されるResponseFactoryクラスの<code>json</code>メソッドにレンダリングしたいJSON型データを設定する。</p>
<p><code>response</code>ヘルパーは初期値として<code>200</code>ステータスが設定されているが、<code>view</code>メソッドや<code>setStatusCode</code>メソッドを使用して、明示的に設定しても良い。</p>
<blockquote>
<ul>
<li><a href="https://github.com/laravel/framework/blob/8.x/src/Illuminate/Contracts/Routing/ResponseFactory.php">https://github.com/laravel/framework/blob/8.x/src/Illuminate/Contracts/Routing/ResponseFactory.php</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="o">...</span>

        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
            <span class="s2">&quot;name&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;Abigail&quot;</span><span class="p">,</span>
            <span class="s2">&quot;state&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;CA&quot;</span>
        <span class="p">],</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="view">▼ Viewテンプレートのレスポンス<a class="headerlink" href="#view" title="Permanent link">&para;</a></h4>
<p>返却されるResponseFactoryクラスの<code>view</code>メソッドに、レンダリングしたいデータ (テンプレート、array型データ、ステータスコードなど) を設定する。</p>
<p>また、Viewクラスの<code>header</code>メソッドにHTTPヘッダーの値を設定する。</p>
<p><code>response</code>ヘルパーは初期値として<code>200</code>ステータスが設定されているが、<code>view</code>メソッドや<code>setStatusCode</code>メソッドを使用して、明示的に設定しても良い。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Foo</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="o">...</span>

        <span class="c1">// データ、ステータスコード、ヘッダーなどを設定する場合</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span>
            <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
            <span class="nv">$data</span><span class="p">,</span>
            <span class="mi">200</span>
        <span class="p">)</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span>
            <span class="nv">$type</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="o">...</span>

        <span class="c1">// ステータスコードのみ設定する場合</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="route_2"><code>route</code>ヘルパー<a class="headerlink" href="#route_2" title="Permanent link">&para;</a></h3>
<h4 id="url">▼ ルートエイリアスを基にURL作成<a class="headerlink" href="#url" title="Permanent link">&para;</a></h4>
<p>ルートにエイリアスがついている場合、エイリアスに応じてURLを作成する。</p>
<p>ドメインは自動的に補完される。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/helpers.html#method-route">https://readouble.com/laravel/8.x/ja/helpers.html#method-route</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">FooController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;foos_index&#39;</span><span class="p">);</span>

<span class="c1">// https://example.com/foo</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;foos_index&#39;</span><span class="p">);</span>
</code></pre></div>
<p><br></p>
<h3 id="path"><code>path</code>系ヘルパー<a class="headerlink" href="#path" title="Permanent link">&para;</a></h3>
<h4 id="base_path">▼ <code>base_path</code>ヘルパー<a class="headerlink" href="#base_path" title="Permanent link">&para;</a></h4>
<p>引数を設定しない場合、projectルートディレクトリの絶対パスを作成する。</p>
<p>また、projectルートディレクトリからの相対パスを引数として、絶対パスを作成する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// /var/www/project</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nx">base_path</span><span class="p">();</span>

<span class="c1">// /var/www/project/vendor/bin</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nx">base_path</span><span class="p">(</span><span class="s2">&quot;vendor/bin&quot;</span><span class="p">);</span>
</code></pre></div>
<h4 id="public_path">▼ <code>public_path</code>ヘルパー<a class="headerlink" href="#public_path" title="Permanent link">&para;</a></h4>
<p>引数を設定しない場合、publicディレクトリの絶対パスを作成する。</p>
<p>また、publicディレクトリからの相対パスを引数として、絶対パスを作成する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// /var/www/project/public</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nx">public_path</span><span class="p">();</span>

<span class="c1">// /var/www/project/public/css/app.css</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nx">public_path</span><span class="p">(</span><span class="s2">&quot;css/app.css&quot;</span><span class="p">);</span>
</code></pre></div>
<h4 id="storage_path">▼ <code>storage_path</code>ヘルパー<a class="headerlink" href="#storage_path" title="Permanent link">&para;</a></h4>
<p>引数を設定しない場合、storageディレクトリの絶対パスを作成する。</p>
<p>まあ、storageディレクトリからの相対パスを引数として、絶対パスを作成する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// /var/www/project/storage</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nx">storage_path</span><span class="p">();</span>

<span class="c1">// /var/www/project/storage/app/file.txt</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s2">&quot;app/file.txt&quot;</span><span class="p">);</span>
</code></pre></div>
<p><br></p>
<h3 id="url_1"><code>url</code>ヘルパー<a class="headerlink" href="#url_1" title="Permanent link">&para;</a></h3>
<h4 id="url_2">▼ パスを基にURL作成<a class="headerlink" href="#url_2" title="Permanent link">&para;</a></h4>
<p>指定したパスに応じてURLを作成する。</p>
<p>ドメインは自動的に補完される。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/5.7/ja/urls.html">https://readouble.com/laravel/5.7/ja/urls.html</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// https://example.com/foo</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">);</span>
</code></pre></div>
<p><br></p>
<h2 id="09-factory">09. Factory<a class="headerlink" href="#09-factory" title="Permanent link">&para;</a></h2>
<h3 id="_27">初期値レコードの定義<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<h4 id="faker">▼ Fakerによるランダム値作成<a class="headerlink" href="#faker" title="Permanent link">&para;</a></h4>
<p>Fakerはレコードの値をランダムに作成するためのパッケージである。</p>
<p>Farkerクラスは、プロパティにランダムなデータを保持している。</p>
<p>このプロパティを特に、Formattersという。</p>
<blockquote>
<ul>
<li><a href="https://fwhy.github.io/faker-docs/">https://fwhy.github.io/faker-docs/</a></li>
</ul>
</blockquote>
<h4 id="factory">▼ Factoryによるレコード定義<a class="headerlink" href="#factory" title="Permanent link">&para;</a></h4>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">Database\Factories</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Foo</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\Factory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooFactory</span> <span class="k">extends</span> <span class="nx">Factory</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$model</span> <span class="o">=</span> <span class="nx">Foo</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">definition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span>          <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">faker</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="s1">&#39;email_address&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">faker</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">safeEmail</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hasfactory">▼ HasFactoryトレイト<a class="headerlink" href="#hasfactory" title="Permanent link">&para;</a></h4>
<p>Factoryに対応するEloquentモデルで使用する必要がある。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/database-testing.html#creating-models-using-factories">https://readouble.com/laravel/8.x/ja/database-testing.html#creating-models-using-factories</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="x">class Foo</span>
<span class="x">{</span>
<span class="x">    use HasFactory;</span>
<span class="x">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_28">初期ダミーデータの量産<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<h4 id="seeder">▼ Seederによるダミーデータ量産<a class="headerlink" href="#seeder" title="Permanent link">&para;</a></h4>
<p>Factoryにおける定義を基にして、指定した数だけダミーデータを量産する。</p>
<p><strong>＊実装例＊</strong></p>
<p>FooSeederを定義し、<code>50</code>個のダミーユーザーデータを量産する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Models\Foo</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="no">NUM_TEST_DATA</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">NUM_TEST_DATA</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>また、BarSeederを定義し、<code>50</code>個のダミーユーザーデータを量産する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Models\Bar</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BarSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="no">NUM_TEST_DATA</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">NUM_TEST_DATA</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>DatabaseSeederにて、全てのSeederをまとめて実行する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 開発環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// ダミーデータ</span>
                <span class="nx">FooSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
                <span class="nx">BarSeeder</span><span class="o">::</span><span class="na">class</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// テスト環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;tes&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// リアルデータ</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// ステージング環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;stg&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// リアルデータ</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// 本番環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;prd&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// リアルデータ</span>
            <span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h2 id="10-httpcontroller">10. HTTP｜Controller<a class="headerlink" href="#10-httpcontroller" title="Permanent link">&para;</a></h2>
<p><br></p>
<h2 id="10-02-httpformrequest">10-02. HTTP｜FormRequest<a class="headerlink" href="#10-02-httpformrequest" title="Permanent link">&para;</a></h2>
<h3 id="_29">クエリパラメーター/メッセージボディのバリデーション<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<h4 id="_30">▼ ルール定義 ＆ バリデーション手動実行<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h4>
<p>同じくFormRequestクラスの<code>validate</code>メソッドを使用して、ルールを定義し、加えてバリデーションを実行する。</p>
<p><code>validated</code>メソッドと間違わないように注意する。</p>
<p>ルールに反すると、1つ目のルール名 (例：<code>required</code>) に基づき、<code>validation.php</code>ファイルから対応するエラーメッセージを自動的に選択する。</p>
<p>バリデーションでエラーが発生した場合、Handlerクラスの<code>invalid</code>メソッドがコールされ、元のWebページにリダイレクトされる。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/7.x/ja/validation.html#creating-form-requests">https://readouble.com/laravel/7.x/ja/validation.html#creating-form-requests</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Http/Request.html#method_validate">https://laravel.com/api/8.x/Illuminate/Http/Request.html#method_validate</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// クエリパラメーターのバリデーションを実行する。</span>
        <span class="c1">// エラーが発生した場合は元のWebページにリダイレクト</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s2">&quot;limit&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">in</span><span class="p">([</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">])],</span>
            <span class="s2">&quot;order&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">in</span><span class="p">([</span><span class="s2">&quot;ascend&quot;</span><span class="p">,</span> <span class="s2">&quot;descend&quot;</span><span class="p">])],</span>
        <span class="p">]);</span>

        <span class="c1">// 続きの処理</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義、バリデーションの実行</span>
        <span class="c1">// エラーが発生した場合は元のWebページにリダイレクト</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;max:255&quot;</span><span class="p">],</span>
            <span class="s2">&quot;body&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;max:255&quot;</span><span class="p">],</span>
            <span class="s2">&quot;date&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span>
        <span class="p">]);</span>

        <span class="c1">// 続きの処理</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>注意点として、ルールによっては、配列を使用せずとも定義できる。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義、メッセージボディのバリデーションを実行する。</span>
        <span class="c1">// エラーが発生した場合は元のWebページにリダイレクト</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;required|string|max:5255&quot;</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;required|string|max:255&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;required|date&quot;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="c1">// 続きの処理</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_31">▼ ルール定義 &amp; バリデーション自動実行<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h4>
<p>Controllerで、FormRequestクラスを引数に指定すると、コントローラーのメソッドをコールする前にバリデーションを自動的に実行する。</p>
<p>そのため、コントローラーの中ではバリデーションを実行する必要はない。</p>
<p>代わりとして、ルールをFormRequestクラスの<code>rule</code>メソッドに定義する必要がある。</p>
<p>FormRequestクラスの<code>validated</code>メソッドを使用して、バリデーション済みのデータを取得できる。</p>
<p>バリデーションでエラーが発生した場合、Handlerクラスの<code>invalid</code>メソッドがコールされ、元のWebページにリダイレクトされる。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// クエリパラメーターのバリデーションを実行する。</span>
        <span class="c1">// エラーが発生した場合は元のWebページにリダイレクト</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validated</span><span class="p">();</span>

        <span class="c1">// 続きの処理</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// メッセージボディのバリデーションを実行する。</span>
        <span class="c1">// エラーが発生した場合は元のWebページにリダイレクト</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validated</span><span class="p">();</span>

        <span class="c1">// 続きの処理</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>FormRequestクラスの<code>rules</code>メソッドを使用して、ルールを定義する。</p>
<p>ルールに反すると、1つ目のルール名 (例：<code>required</code>) に基づき、<code>validation.php</code>ファイルから対応するエラーメッセージを自動的に選択する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ルールを返却します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;title&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;max:255&quot;</span><span class="p">],</span>
            <span class="s2">&quot;body&quot;</span>   <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;max:255&quot;</span><span class="p">],</span>
            <span class="s2">&quot;type&quot;</span>   <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">in</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])],</span>
            <span class="s2">&quot;author&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">UppercaseRule</span><span class="p">()],</span>
            <span class="s2">&quot;date&quot;</span>   <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_32">パスパラメーターのバリデーション<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<h4 id="_33">▼ ルールの定義 ＆ バリデーション自動実行<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h4>
<p>Routeファサードの<code>pattern</code>メソッドまたは<code>where</code>メソッドで定義する。</p>
<p><br></p>
<h3 id="_34">エラーメッセージ<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<h4 id="_35">▼ 標準のエラーメッセージ<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h4>
<p>標準のバリデーションメッセージは、<code>resources/lang/ja/validation.php</code>ファイルで定義できる。</p>
<p>バリデーションルールの組み合わせによって、<code>validation.php</code>ファイルから自動的にメッセージが選択される。</p>
<p>例えばルールとして最大値を設定した場合は、データ型に合わせてメッセージが選択される。</p>
<p>日本語翻訳<code>validation.php</code>ファイルについては、以下のリンクを参考にせよ。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/validation-php.html">https://readouble.com/laravel/8.x/ja/validation-php.html</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="c1">// 〜 中略 〜</span>

    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;:attributeは必須です&#39;</span><span class="p">,</span>

    <span class="s1">&#39;string&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;:attribute は文字列のみ有効です&#39;</span><span class="p">,</span>

    <span class="s1">&#39;max&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;numeric&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;:attributeには、:max以下の数字を指定してください&#39;</span><span class="p">,</span>
        <span class="s1">&#39;file&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;:attributeには、:max kB以下のファイルを指定してください&#39;</span><span class="p">,</span>
        <span class="s1">&#39;string&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;:attributeは、:max文字以下で指定してください&#39;</span><span class="p">,</span>
        <span class="s1">&#39;array&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;:attributeは:max個以下指定してください&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;:attribute を有効な日付形式にしてください&#39;</span><span class="p">,</span>

    <span class="s1">&#39;attributes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;タイトル&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;本文&#39;</span><span class="p">,</span>
        <span class="s1">&#39;date&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;作成日&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="c1">// 〜 中略 〜</span>

<span class="p">];</span>
</code></pre></div>
<p>注意点として、言語設定を行わない場合、デフォルトでは<code>/resources/lang/en/validation.php</code>ファイルをバリデーションメッセージとして参照するため、<code>app.php</code>ファイルで言語を変更することと、日本語翻訳<code>validation.php</code>ファイルが必要である。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="c1">// 〜 中略 〜</span>

    <span class="s1">&#39;locale&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ja&#39;</span>

    <span class="c1">// 〜 中略 〜</span>

<span class="p">];</span>
</code></pre></div>
<h4 id="_36">▼ 画面上でのエラーメッセージ出力<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h4>
<p>バリデーションでエラーがあった場合、Handlerクラスの<code>invalid</code>メソッドがコールされ、MessageBagクラスがViewに渡される。</p>
<p>選択されたバリデーションメッセージが配列型でMessageBagクラスに格納されている。</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">(</span>
<span class="l l-Scalar l-Scalar-Plain">[title] =&gt; Array</span>
<span class="l l-Scalar l-Scalar-Plain">(</span>
<span class="l l-Scalar l-Scalar-Plain">[0] =&gt; タイトルの入力は必須です</span>
<span class="l l-Scalar l-Scalar-Plain">[1] =&gt; タイトルは、最大255文字以下で指定してください</span>
<span class="l l-Scalar l-Scalar-Plain">)</span>

<span class="l l-Scalar l-Scalar-Plain">[body] =&gt; Array</span>
<span class="l l-Scalar l-Scalar-Plain">(</span>
<span class="l l-Scalar l-Scalar-Plain">[0] =&gt; 本文の入力は必須です</span>
<span class="l l-Scalar l-Scalar-Plain">[1] =&gt; 本文は、最大255文字以下で指定してください</span>
<span class="l l-Scalar l-Scalar-Plain">)</span>
<span class="l l-Scalar l-Scalar-Plain">[data] =&gt; Array</span>
<span class="l l-Scalar l-Scalar-Plain">(</span>
<span class="l l-Scalar l-Scalar-Plain">[0] =&gt; 作成日の入力は必須です</span>
<span class="l l-Scalar l-Scalar-Plain">[1] =&gt; 作成日を有効な日付形式にしてください</span>
<span class="l l-Scalar l-Scalar-Plain">)</span>
<span class="l l-Scalar l-Scalar-Plain">)</span>
</code></pre></div>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Foundation/Exceptions/Handler.html#method_invalid">https://laravel.com/api/8.x/Illuminate/Foundation/Exceptions/Handler.html#method_invalid</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Support/MessageBag.html">https://laravel.com/api/8.x/Illuminate/Support/MessageBag.html</a></li>
</ul>
</blockquote>
<p><br></p>
<h3 id="rule">Rule<a class="headerlink" href="#rule" title="Permanent link">&para;</a></h3>
<h4 id="exists">▼ <code>exists</code>メソッド<a class="headerlink" href="#exists" title="Permanent link">&para;</a></h4>
<p>指定されたテーブルのカラムに値が存在しているかを検証する。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Validation/Rule.html#method_exists">https://laravel.com/api/8.x/Illuminate/Validation/Rule.html#method_exists</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ルールを返却します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;prefectureId&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">exists</span><span class="p">(</span><span class="s2">&quot;prefectures&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)],</span>
            <span class="s2">&quot;cityId&quot;</span>       <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">exists</span><span class="p">(</span><span class="s2">&quot;cities&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>テーブルにカラム数が多い場合は、Where句をつけることにより、特定のカラムのみ検証もできる。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ルールを返却します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;prefectureId&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">exists</span><span class="p">(</span><span class="s2">&quot;prefectures&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)],</span>
            <span class="s2">&quot;cityId&quot;</span>       <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">exists</span><span class="p">(</span><span class="s2">&quot;cities&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">whereNull</span><span class="p">(</span><span class="s2">&quot;deleted_at&quot;</span><span class="p">)],</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="in">▼ <code>in</code>メソッド<a class="headerlink" href="#in" title="Permanent link">&para;</a></h4>
<p>決められた複数の値に合致する値であるか否かを検証する。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Validation/Rule.html#method_in">https://laravel.com/api/8.x/Illuminate/Validation/Rule.html#method_in</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ルールを返却します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">in</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])],</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_37">▼ 独自ルール/メッセージ<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h4>
<p>独自ルールを定義する場合は、Ruleクラスを継承したクラスを用意し、<code>rule</code>メソッドの中でインスタンスを作成する。</p>
<p>独自Ruleクラスでは、<code>passes</code>メソッドでルールを定義する。</p>
<p>また、<code>messages</code>メソッドでバリデーションメッセージを定義する。</p>
<p><code>validation.php</code>ファイルでメッセージを定義し、これを参照しても良い。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/docs/8.x/validation#custom-validation-rules">https://laravel.com/docs/8.x/validation#custom-validation-rules</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Rules</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Validation\Rule</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UppercaseRule</span> <span class="k">implements</span> <span class="nx">Rule</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * バリデーションの成功を判定</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $attribute</span>
<span class="sd">     * @param  mixed  $value</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">passes</span><span class="p">(</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">===</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * バリデーションエラーメッセージの取得</span>
<span class="sd">     *</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">message</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;The :attribute must be uppercase.&#39;</span><span class="p">;</span>
        <span class="c1">// return trans(&#39;validation.uppercase&#39;); validation.phpファイルから参照する。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ルールを返却します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ルールの定義</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;author&quot;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">UppercaseRule</span><span class="p">()]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_38">セッション<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h3>
<h4 id="_39">▼ セッション変数の取得<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h4>
<p>FormRequestクラスの<code>session</code>メソッドを使用して、セッション変数を取得する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$session</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>全てのセッション変数を取得もできる。</p>
<div class="highlight"><pre><span></span><code><span class="x">$session = $request-&gt;session()-&gt;all();</span>
</code></pre></div>
<h4 id="_40">▼ フラッシュデータの設定<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h4>
<p>現在のセッションで、今回と次回のリクエストのみで有効な一時データを設定できる。</p>
<div class="highlight"><pre><span></span><code><span class="x">$request-&gt;session()</span>
<span class="x">    -&gt;flash(&quot;status&quot;, &quot;Task was successful!&quot;);</span>
</code></pre></div>
<p><br></p>
<h3 id="_41">認証<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h3>
<h4 id="authorize">▼ <code>authorize</code>メソッド<a class="headerlink" href="#authorize" title="Permanent link">&para;</a></h4>
<p>ユーザーがリソースに対してCRUDを行う権限を持っているかを、コントローラーのメソッドを実行する前に、判定する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="x">/**</span>
<span class="x"> * ユーザーがこのリクエストの権限を持っているかを判断する</span>
<span class="x"> *</span>
<span class="x"> * @return bool</span>
<span class="x"> */</span>
<span class="x">public function authorize()</span>
<span class="x">{</span>
<span class="x">    $comment = Comment::find($this-&gt;route(&quot;comment&quot;));</span>

<span class="x">    return $comment&amp;&amp; $this-&gt;user()-&gt;can(&quot;update&quot;, $comment);</span>
<span class="x">}</span>
</code></pre></div>
<h4 id="auth_3">▼ Authファサード<a class="headerlink" href="#auth_3" title="Permanent link">&para;</a></h4>
<p>ノート内の『Authファサード』の項目を参照せよ。</p>
<p><br></p>
<h2 id="10-03-httpmiddleware">10-03. HTTP｜Middleware<a class="headerlink" href="#10-03-httpmiddleware" title="Permanent link">&para;</a></h2>
<h3 id="middleware_1">Middlewareの仕組み<a class="headerlink" href="#middleware_1" title="Permanent link">&para;</a></h3>
<h4 id="middleware_2">▼ Middlewareの種類<a class="headerlink" href="#middleware_2" title="Permanent link">&para;</a></h4>
<p>ルーティング後にコントローラーメソッドの前にコールされるBeforeMiddleと、レスポンスの実行時にコールされるAfterMiddlewareがある</p>
<p><img alt="Laravelのミドルウェア" src="https://raw.githubusercontent.com/hiroki-it/tech-notebook-images/master/images/LaravelのMiddlewareクラスの仕組み.png" /></p>
<h4 id="beforemiddleware">▼ BeforeMiddleware<a class="headerlink" href="#beforemiddleware" title="Permanent link">&para;</a></h4>
<p>ルーティング時のコントローラーメソッドのコール前に実行する処理を設定できる。</p>
<p>一連の処理を終えた後、FormRequestクラスを、次のMiddlewareクラスやControllerクラスに渡す必要がある。</p>
<p>これらのクラスはClosure (無名関数) として、<code>next</code>変数に格納されている。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooBeforeMiddleware</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 何らかの処理</span>

        <span class="c1">// 次のMiddlewareクラスやControllerクラスに、FormRequestクラスを渡す。</span>
        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="aftermiddleware">▼ AfterMiddleware<a class="headerlink" href="#aftermiddleware" title="Permanent link">&para;</a></h4>
<p>コントローラーメソッドのレスポンスの実行後 (テンプレートのレンダリングを含む) に実行する処理を設定できる。</p>
<p>あらかじめ、FormRequestクラスを、前のMiddlewareクラスやControllerクラスから受け取る必要がある。</p>
<p>これらのクラスはClosure (無名関数) として、<code>next</code>変数に格納されている。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooAfterMiddleware</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// 何らかの処理</span>

        <span class="c1">// 前のMiddlewareクラスやControllerクラスから、FormRequestクラスを受け取る。</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="middleware_3">標準のMiddleware<a class="headerlink" href="#middleware_3" title="Permanent link">&para;</a></h3>
<h4 id="encryptcookies">▼ EncryptCookies<a class="headerlink" href="#encryptcookies" title="Permanent link">&para;</a></h4>
<p>レスポンス時に、<code>Cookie</code>ヘッダーの全ての値を暗号化する。</p>
<p>暗号化したくない場合は、<code>Cookie</code>ヘッダーのキー名を<code>except</code>プロパティに設定する。</p>
<blockquote>
<ul>
<li><a href="https://reffect.co.jp/laravel/laravel-sessions-understand#cookie-2">https://reffect.co.jp/laravel/laravel-sessions-understand#cookie-2</a></li>
</ul>
</blockquote>
<h4 id="startsession">▼ StartSession<a class="headerlink" href="#startsession" title="Permanent link">&para;</a></h4>
<p>セッションの開始の開始点になる。</p>
<blockquote>
<ul>
<li><a href="https://qiita.com/wim/items/b1db5202cce6b38bc47b">https://qiita.com/wim/items/b1db5202cce6b38bc47b</a></li>
</ul>
</blockquote>
<p>また、同一セッションで一意なCSRFトークンを作成する。</p>
<p>CSRFトークンによるCSRFの防御については、以下のリンクを参考にせよ。</p>
<blockquote>
<ul>
<li><a href="https://hiroki-it.github.io/tech-notebook/security/security_cyber_attacks.html">https://hiroki-it.github.io/tech-notebook/security/security_cyber_attacks.html</a></li>
</ul>
</blockquote>
<h4 id="verifycsrftoken">▼ VerifyCsrfToken<a class="headerlink" href="#verifycsrftoken" title="Permanent link">&para;</a></h4>
<p>セッションデータに書かれたCSRFトークンと、リクエストボディに割り当てられたトークンを比較する。</p>
<p>セッションデータは<code>storage/framework/sessions</code>ディレクトリ配下に配置されている。</p>
<p>一般的に、CSRFトークンは<code>Cookie</code>ヘッダーに割り当てることもできるが、Laravelではリクエストボディを使用する必要がある。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/csrf.html#preventing-csrf-requests">https://readouble.com/laravel/8.x/ja/csrf.html#preventing-csrf-requests</a></li>
</ul>
</blockquote>
<p><br></p>
<h3 id="_42">コール方法のカスタマイズ<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h3>
<h4 id="kernel">▼ Kernel<a class="headerlink" href="#kernel" title="Permanent link">&para;</a></h4>
<p>Middlewareクラスをコールする時の方法をカスタマイズできる。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\Kernel</span> <span class="k">as</span> <span class="nx">HttpKernel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Kernel</span> <span class="k">extends</span> <span class="nx">HttpKernel</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 全てのHTTPリクエストに適用するミドルウェアを定義します。</span>


<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$middleware</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">\App\Http\Middleware\Auth\TrustProxies</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\App\Http\Middleware\Auth\CheckForMaintenanceMode</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\Illuminate\Foundation\Http\Middleware\ValidatePostSize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\App\Http\Middleware\Auth\TrimStrings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * エイリアスとミドルウェアグループを定義します。</span>


<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$middlewareGroups</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;web&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">],</span>

        <span class="s1">&#39;api&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;throttle:60,1&#39;</span><span class="p">,</span>
            <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * エイリアスと個別のミドルウェアを定義します。</span>


<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;auth&#39;</span>                 <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Auth\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;auth.basic&#39;</span>           <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;bindings&#39;</span>             <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;cache.headers&#39;</span>        <span class="o">=&gt;</span> <span class="nx">\Illuminate\Http\Middleware\SetCacheHeaders</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;can&#39;</span>                  <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\Authorize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;guest&#39;</span>                <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Auth\RedirectIfAuthenticated</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;password.confirm&#39;</span>     <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\RequirePassword</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;signed&#39;</span>               <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\ValidateSignature</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;throttle&#39;</span>             <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\ThrottleRequests</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;verified&#39;</span>             <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\EnsureEmailIsVerified</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>

        <span class="c1">// Fooミドルウェアクラス</span>
        <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Before\FooMiddleware</span><span class="o">::</span><span class="na">class</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * ミドルウェアをコールする順番を定義します。</span>


<span class="sd">     *</span>
<span class="sd">     * @var string[]</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$middlewarePriority</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">\Illuminate\Session\Middleware\StartSession</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\Illuminate\View\Middleware\ShareErrorsFromSession</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\App\Http\Middleware\Auth\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\Illuminate\Routing\Middleware\ThrottleRequests</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\Illuminate\Session\Middleware\AuthenticateSession</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\Illuminate\Auth\Middleware\Authorize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h2 id="10-04-httprequest">10-04. HTTP｜Request<a class="headerlink" href="#10-04-httprequest" title="Permanent link">&para;</a></h2>
<h3 id="_43">リクエストパラメーターの取得<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h3>
<h4 id="_44">▼ クエリパラメーター/メッセージボディ<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h4>
<p>クエリパラメーターとメッセージボディの両方を取得する。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/requests.html#retrieving-input">https://readouble.com/laravel/8.x/ja/requests.html#retrieving-input</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span> <span class="c1">// 全てのパラメーターを連想配列で取得する。</span>

        <span class="nv">$foo</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span> <span class="c1">// 指定したパラメーターの値を取得する。</span>

        <span class="nv">$qux</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;foo.qux&#39;</span><span class="p">);</span> <span class="c1">// ネストされたパラメーターの値を取得する。</span>

        <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span> <span class="c1">// 指定したパラメーターを連想配列で取得する。</span>

        <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">except</span><span class="p">([</span><span class="s1">&#39;baz&#39;</span><span class="p">]);</span> <span class="c1">// 指定したパラメータ以外を連想配列で取得する。</span>

        <span class="nv">$foo</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">;</span> <span class="c1">// 指定したパラメーターの値を取得する。</span>

        <span class="nv">$foo</span> <span class="o">=</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span> <span class="c1">// 指定したパラメーターの値を取得する。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_45">▼ クエリパラメーター<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h4>
<p>クエリパラメーターを取得する。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/requests.html#retrieving-input">https://readouble.com/laravel/8.x/ja/requests.html#retrieving-input</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">();</span> <span class="c1">// 全てのパラメーターを連想配列で取得する。</span>

        <span class="nv">$foo</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span> <span class="c1">// 指定したパラメーターの値を取得する。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_46">▼ パスパラメータ<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h4>
<p>パスパラメーターを取得する。</p>
<blockquote>
<ul>
<li><a href="https://technote.space/posts/wpdb-laravel-get-url-parameter/">https://technote.space/posts/wpdb-laravel-get-url-parameter/</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Http/Request.html#method_route">https://laravel.com/api/8.x/Illuminate/Http/Request.html#method_route</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Routing/Route.html#method_parameter">https://laravel.com/api/8.x/Illuminate/Routing/Route.html#method_parameter</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">();</span> <span class="c1">// 全てのパラメーターを連想配列で取得する。</span>

        <span class="nv">$fooId</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;fooId&#39;</span><span class="p">);</span> <span class="c1">// 指定したパラメーターの値を取得する。</span>

        <span class="nv">$fooId</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">route</span><span class="o">-&gt;</span><span class="na">parameter</span><span class="p">(</span><span class="s1">&#39;fooId&#39;</span><span class="p">);</span> <span class="c1">// 指定したパラメーターの値を取得する。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>代わりとして、コントローラーの第二引数にパスパラメーター名を記述することにより、パスパラメーターの値を取得しても良い。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Request $request</span>
<span class="sd">     * @param         $fooId</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$fooId</span><span class="p">)</span>
    <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_47">バリデーション<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h3>
<p>Requestではなく、FormRequestを使用した方がバリデーションがおすすめである。</p>
<blockquote>
<ul>
<li><a href="https://www.larajapan.com/2020/03/09/formrequest%E3%82%92%E4%BD%BF%E3%81%86/">https://www.larajapan.com/2020/03/09/formrequest%E3%82%92%E4%BD%BF%E3%81%86/</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="x">namespace App\Http\Controllers;</span>

<span class="x">use Illuminate\Http\Request;</span>

<span class="x">class FooController extends Controller</span>
<span class="x">{</span>
<span class="x">    public function update(Request $request)</span>
<span class="x">    {</span>
<span class="x">        // リクエストのバリデーション</span>
<span class="x">        $validated = $request-&gt;validate([</span>
<span class="x">            &#39;name&#39;  =&gt; &#39;required&#39;,</span>
<span class="x">            &#39;email&#39; =&gt; &#39;required|email&#39;,</span>
<span class="x">        ]);</span>

<span class="x">        // 〜 中略 〜</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<p><br></p>
<h2 id="11-logging">11. Logging<a class="headerlink" href="#11-logging" title="Permanent link">&para;</a></h2>
<h3 id="_48">ログの出力先<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h3>
<h4 id="_49">▼ 設定方法<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h4>
<p>環境変数を<code>.env</code>ファイルに実装する。</p>
<p><code>logging.php</code>ファイルから、指定された設定が選択される。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/logging.html#available-channel-drivers">https://readouble.com/laravel/8.x/ja/logging.html#available-channel-drivers</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code>LOG_CHANNEL=&lt;オプション名&gt;
</code></pre></div>
<p>注意点として、<code>storage</code>ディレクトリ配下にログファイルを作成するようなログチャンネルを設定した場合、phpがこのディレクトリへの認可スコープを持たないため、アクセス可能にする必要がある。</p>
<p>権限を変更したファイルは差分としてGitに認識されるため、これを共有すればチーム内で権限変更を共有できる。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Failed to open stream: Permission denied</span>
$<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">777</span><span class="w"> </span>/var/www/foo/storage
</code></pre></div>
<h4 id="php-fpm">▼ PHP-FPMのログについて<a class="headerlink" href="#php-fpm" title="Permanent link">&para;</a></h4>
<p>LaravelとPHP-FPMのプロセスはそれぞれ独立しているため、Laravelのログの出力先を変更しても、PHP-FPMのログの出力先は変更されない。</p>
<blockquote>
<ul>
<li><a href="https://hiroki-it.github.io/tech-notebook/software/software_middleware_application_gi_fastcgi_php_fpm.html">https://hiroki-it.github.io/tech-notebook/software/software_middleware_application_gi_fastcgi_php_fpm.html</a></li>
</ul>
</blockquote>
<h4 id="stack">▼ <code>stack</code>キー<a class="headerlink" href="#stack" title="Permanent link">&para;</a></h4>
<p>他の単一/複数のチャンネルを利用するチャンネル。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="o">...</span>

    <span class="s2">&quot;default&quot;</span>  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;LOG_CHANNEL&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">),</span>
    <span class="s2">&quot;channels&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">&quot;stack&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s2">&quot;driver&quot;</span>            <span class="o">=&gt;</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span>
            <span class="c1">// 複数チャンネルを設定できる。</span>
            <span class="c1">// (例) [&quot;single&quot;, &quot;stack&quot;]</span>
            <span class="s2">&quot;channels&quot;</span>          <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ignore_exceptions&quot;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="o">...</span>

    <span class="p">]</span>
<span class="p">];</span>
</code></pre></div>
<h4 id="single">▼ <code>single</code>キー<a class="headerlink" href="#single" title="Permanent link">&para;</a></h4>
<p>全てのログを<code>/storage/logs/laravel.log</code>ファイルに対して出力する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="o">...</span>

    <span class="s2">&quot;default&quot;</span>  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;LOG_CHANNEL&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">),</span>
    <span class="s2">&quot;channels&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">&quot;daily&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s2">&quot;driver&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path&quot;</span>   <span class="o">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s2">&quot;logs/laravel.log&quot;</span><span class="p">),</span>
            <span class="s2">&quot;level&quot;</span>  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;LOG_LEVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">),</span>
            <span class="s2">&quot;days&quot;</span>   <span class="o">=&gt;</span> <span class="mi">14</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="o">...</span>

    <span class="p">]</span>
<span class="p">];</span>
</code></pre></div>
<h4 id="daily">▼ <code>daily</code>キー<a class="headerlink" href="#daily" title="Permanent link">&para;</a></h4>
<p>全てのログを<code>/storage/logs/laravel-&lt;日付&gt;.log</code>ファイルに対して出力する。</p>
<div class="highlight"><pre><span></span><code><span class="x">return [</span>

<span class="x">    ...</span>

<span class="x">    &quot;default&quot;  =&gt; env(&quot;LOG_CHANNEL&quot;, &quot;stack&quot;),</span>
<span class="x">    &quot;channels&quot; =&gt; [</span>
<span class="x">        &quot;stderr&quot; =&gt; [</span>
<span class="x">            &quot;driver&quot;    =&gt; &quot;monolog&quot;,</span>
<span class="x">            &quot;handler&quot;   =&gt; StreamHandler::class,</span>
<span class="x">            &quot;formatter&quot; =&gt; env(&quot;LOG_STDERR_FORMATTER&quot;),</span>
<span class="x">            &quot;with&quot;      =&gt; [</span>
<span class="x">                &quot;stream&quot; =&gt; &quot;php://stderr&quot;,</span>
<span class="x">            ],</span>
<span class="x">        ],</span>

<span class="x">        ...</span>

<span class="x">    ]</span>
<span class="x">];</span>
</code></pre></div>
<h4 id="stderr">▼ <code>stderr</code>キー<a class="headerlink" href="#stderr" title="Permanent link">&para;</a></h4>
<p>全てのログを標準エラー出力に対して出力する。</p>
<p>Docker上でLaravelを稼働させる場合は、作成されるログファイルでコンテナのサイズが肥大化することを防ぐために、これを選択する。</p>
<p>注意点として、独自カスタマイズとして、<code>stream</code>キーをstdout変更すれば、標準出力にログを出力もできる。</p>
<div class="highlight"><pre><span></span><code><span class="x">return [</span>

<span class="x">    ...</span>

<span class="x">    &quot;default&quot;  =&gt; env(&quot;LOG_CHANNEL&quot;, &quot;stack&quot;),</span>
<span class="x">    &quot;channels&quot; =&gt; [</span>
<span class="x">        &quot;stderr&quot; =&gt; [</span>
<span class="x">            &quot;driver&quot;    =&gt; &quot;monolog&quot;,</span>
<span class="x">            &quot;handler&quot;   =&gt; StreamHandler::class,</span>
<span class="x">            &quot;formatter&quot; =&gt; env(&quot;LOG_STDERR_FORMATTER&quot;),</span>
<span class="x">            &quot;with&quot;      =&gt; [</span>
<span class="x">                &quot;stream&quot; =&gt; &quot;php://stderr&quot;,</span>
<span class="x">            ],</span>
<span class="x">        ],</span>

<span class="x">        ...</span>

<span class="x">    ]</span>
<span class="x">];</span>
</code></pre></div>
<p><br></p>
<h3 id="_50">ログの出力<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h3>
<h4 id="error">▼ <code>error</code>メソッド<a class="headerlink" href="#error" title="Permanent link">&para;</a></h4>
<p>エラーメッセージを定義する時、<code>sprintf</code>メソッドを使用すると便利である。</p>
<p><strong>＊実装例＊</strong></p>
<p>外部のAPIに対してリクエストを送信し、データを取得する。</p>
<p>取得したJSON型データを、クライアントにレスポンスする。</p>
<p>この時、リクエスト処理のために、Guzzleパッケージを使用している。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">GuzzleHttp\Exception\GuzzleException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>
        <span class="nv">$requestUrl</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s2">&quot;api.foo.endpoint_url&quot;</span><span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>

            <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
                <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                <span class="nv">$requestUrl</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="s2">&quot;headers&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                        <span class="s2">&quot;Content-Type&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;X-API-Key&quot;</span>    <span class="o">=&gt;</span> <span class="s2">&quot;api.foo.api_key&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">);</span>

            <span class="c1">// JSONをクライアントにレスポンス</span>
            <span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">getContents</span><span class="p">();</span>

        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">GuzzleException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span>
                    <span class="s2">&quot;%s : %s at %s line %s&quot;</span><span class="p">,</span>
                    <span class="nb">get_class</span><span class="p">(</span><span class="nv">$e</span><span class="p">),</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getFile</span><span class="p">(),</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getLine</span><span class="p">())</span>
            <span class="p">);</span>

            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span>
                <span class="p">[],</span>
                <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">()</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="s2">&quot;foo&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">&quot;endpoint_url&quot;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;ENDPOINT_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="s2">&quot;api_key&quot;</span>      <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;bar&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">&quot;endpoint_url&quot;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;ENDPOINT_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="s2">&quot;api_key&quot;</span>      <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">];</span>
</code></pre></div>
<h4 id="info">▼ <code>info</code>メソッド<a class="headerlink" href="#info" title="Permanent link">&para;</a></h4>
<p><br></p>
<h2 id="12-migration">12. Migration<a class="headerlink" href="#12-migration" title="Permanent link">&para;</a></h2>
<h3 id="_51">テーブルの作成/削除<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h3>
<h4 id="updown">▼ <code>up</code>メソッド、<code>down</code>メソッド<a class="headerlink" href="#updown" title="Permanent link">&para;</a></h4>
<p>コマンドによるDBマイグレーション時にコールされる。</p>
<p><code>up</code>メソッドでテーブル、カラム、インデックスのCREATEを実行する。</p>
<p><code>down</code>メソッドで<code>up</code>メソッドの結果をロールバックする。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateFooTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s2">&quot;foos&quot;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">bigIncrements</span><span class="p">(</span><span class="s2">&quot;foo_id&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;名前&quot;</span><span class="p">);</span>

            <span class="c1">// MigrationMacroServiceProviderのメソッドを使用する。</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">systemColumns</span><span class="p">();</span>

            <span class="c1">// deleted_atカラムを追加する。</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">softDeletes</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s2">&quot;foos&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_52">カラムの追加/変更/削除<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h3>
<h4 id="_53">▼ なし<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h4>
<p>指定したカラムを追加する。</p>
<p><strong>＊実装例＊</strong></p>
<p>カラムを追加するためだけにDBマイグレーションファイルを作成する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>add_column<span class="w"> </span>--table<span class="o">=</span>foos
</code></pre></div>
<p>追加したいカラムのみを定義する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AddColumn</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;foos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;foo_name&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>DBマイグレーションを実行すると、指定したテーブルのカラムが追加される。</p>
<p>実行後は、作成したDBマイグレーションファイルを削除する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>
<h4 id="renamecolumn">▼ <code>renameColumn</code>メソッド<a class="headerlink" href="#renamecolumn" title="Permanent link">&para;</a></h4>
<p>指定したカラムの名前を変更する。</p>
<p><strong>＊実装例＊</strong></p>
<p>カラム名を変更するためだけにDBマイグレーションファイルを作成する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>rename_column<span class="w"> </span>--table<span class="o">=</span>foos
</code></pre></div>
<p>テーブルのカラム名を定義し、<code>renameColumn</code>メソッドをコールする。</p>
<p>変更後でも、ロールバックできるように、<code>down</code>メソッドも定義しておく。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RenameColumn</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;foos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">renameColumn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;foo_id&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// データ型の変更後でも、ロールバックできるようにしておく。</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;foos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">renameColumn</span><span class="p">(</span><span class="s1">&#39;foo_id&#39;</span><span class="p">,</span> <span class="s1">&#39;foo_id&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>DBマイグレーションを実行すると、指定したテーブルのカラム名が変更される。</p>
<p>実行後は、作成したDBマイグレーションファイルを削除する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>
<h4 id="change">▼ <code>change</code>メソッド<a class="headerlink" href="#change" title="Permanent link">&para;</a></h4>
<p>指定したカラムのデータ型を変更する。</p>
<p><strong>＊実装例＊</strong></p>
<p>データ型を変更するためだけにDBマイグレーションファイルを作成する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>change_column_data_type<span class="w"> </span>--table<span class="o">=</span>foos
</code></pre></div>
<p>テーブルのカラムのデータ型を定義し、<code>change</code>メソッドをコールする。</p>
<p>変更後でも、ロールバックできるように、<code>down</code>メソッドも定義しておく。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ChangeColumnDataType</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;foos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">change</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// データ型の変更後でも、ロールバックできるようにしておく。</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;foos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">change</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>DBマイグレーションを実行すると、指定したテーブルのカラムのデータ型が変更される。</p>
<p>実行後は、作成したDBマイグレーションファイルを削除する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>
<h4 id="dropcolumn">▼ <code>dropColumn</code>メソッド<a class="headerlink" href="#dropcolumn" title="Permanent link">&para;</a></h4>
<p>指定したカラムを削除する。</p>
<p><strong>＊実装例＊</strong></p>
<p>カラムを削除するためだけにDBマイグレーションファイルを作成する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>drop_column<span class="w"> </span>--table<span class="o">=</span>foos
</code></pre></div>
<p>削除するカラムを<code>dropColumn</code>メソッドで指定する。</p>
<p>変更後でも、ロールバックできるように、<code>down</code>メソッドも定義しておく。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DropColumn</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;foos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span><span class="s1">&#39;foo_name&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;foos&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;foo_name&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>DBマイグレーションを実行すると、指定したテーブルのカラムが追加される。</p>
<p>実行後は、作成したDBマイグレーションファイルを削除する。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>
<p><br></p>
<h3 id="_54">よく使用するカラムタイプ<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h3>
<h4 id="bigincrements">▼ <code>bigIncrements</code>メソッド<a class="headerlink" href="#bigincrements" title="Permanent link">&para;</a></h4>
<p>自動増分ありのinteger型カラムを作成する。</p>
<p>プライマリーキーとするIDカラムのために使用する。</p>
<p>自動増分のカラムは<code>1</code>個のテーブルに1つしか定義できず、他のIDカラムは<code>unsignedBigInteger</code>メソッドを使用して定義する。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/migrations.html#column-method-bigIncrements">https://readouble.com/laravel/8.x/ja/migrations.html#column-method-bigIncrements</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="x">Schema::create(&quot;foos&quot;, function (Blueprint $table) {</span>

<span class="x">    ...</span>

<span class="x">    $table-&gt;bigIncrements(&quot;foo_id&quot;);</span>

<span class="x">    ...</span>

<span class="x">});</span>
</code></pre></div>
<h4 id="unsignedbiginteger">▼ <code>unsignedBigInteger</code>メソッド<a class="headerlink" href="#unsignedbiginteger" title="Permanent link">&para;</a></h4>
<p>自動増分なしのinteger型カラムを作成する。</p>
<p>プライマリーキーではないIDカラムのために使用する。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/migrations.html#column-method-unsignedBigInteger">https://readouble.com/laravel/8.x/ja/migrations.html#column-method-unsignedBigInteger</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="x">Schema::create(&quot;foos&quot;, function (Blueprint $table) {</span>

<span class="x">    ...</span>

<span class="x">    $table-&gt;bigIncrements(&quot;foo_id&quot;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&quot;bar_id&quot;);</span>

<span class="x">    ...</span>

<span class="x">});</span>
</code></pre></div>
<h4 id="string">▼ <code>string</code>メソッド<a class="headerlink" href="#string" title="Permanent link">&para;</a></h4>
<p>VARCHAR型カラムを作成する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="x">Schema::create(&quot;foos&quot;, function (Blueprint $table) {</span>

<span class="x">    ...</span>

<span class="x">    $table-&gt;string(&quot;name&quot;);</span>

<span class="x">    ...</span>

<span class="x">});</span>
</code></pre></div>
<h4 id="timestamp">▼ <code>timestamp</code>メソッド<a class="headerlink" href="#timestamp" title="Permanent link">&para;</a></h4>
<p>TIMESTAMP型カラムを作成する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="x">Schema::create(&quot;foos&quot;, function (Blueprint $table) {</span>

<span class="x">    ...</span>

<span class="x">    $table-&gt;timestamp(&quot;created_at&quot;);</span>

<span class="x">    ...</span>
<span class="x">});</span>
</code></pre></div>
<p><br></p>
<h2 id="13-notification">13. Notification<a class="headerlink" href="#13-notification" title="Permanent link">&para;</a></h2>
<h3 id="artisan">artisanコマンド<a class="headerlink" href="#artisan" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<p><br></p>
<h3 id="_55">通知内容<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h3>
<h4 id="notification">▼ Notification<a class="headerlink" href="#notification" title="Permanent link">&para;</a></h4>
<p>通知内容を定義する。</p>
<p><code>via</code>メソッドで受信チャンネルを定義する。</p>
<p>この時、Laravelがデフォルトで用意しているチャンネル (Mail、SMS、Slackチャンネル、Databaseチャンネル) 以外に送信したい場合、Channelクラスを定義する必要がある。</p>
<p>複数の値を設定した場合は、それぞれに通信が送信される。</p>
<p><code>toMail</code>メソッド、<code>toSms</code>メソッド、<code>toSlack</code>メソッド、<code>toArray</code>メソッド、を使用して、Laravelの標準のチャンネルに渡す通知内容を定義できる。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Notifications</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\EmailChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\AwsSnsChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Messages\MailMessage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TfaTokenNotification</span> <span class="k">extends</span> <span class="nx">Notification</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">via</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 受信チャンネルを選択します。</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toSms</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// SMSのメッセージ内容を返却します。</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return MailMessage</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toMail</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Emailのメッセージ内容を返却します。</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// DBへの保存方法を返却します。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="e">▼ Eメール通知内容の定義<a class="headerlink" href="#e" title="Permanent link">&para;</a></h4>
<p>MailMessageクラスのメソッドを使用して、Eメール通知の内容を作成する。</p>
<p><code>markdown</code>メソッドを使用することにより、マークダウン形式で定義できる。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/notifications.html#writing-the-message">https://readouble.com/laravel/8.x/ja/notifications.html#writing-the-message</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Notifications/Messages/MailMessage.html#method_markdown">https://laravel.com/api/8.x/Illuminate/Notifications/Messages/MailMessage.html#method_markdown</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Notifications</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\EmailChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\AwsSnsChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Messages\MailMessage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TfaTokenNotification</span> <span class="k">extends</span> <span class="nx">Notification</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">via</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">prefers_sms</span> <span class="o">?</span> <span class="p">[</span><span class="nx">AwsSnsChannel</span><span class="o">::</span><span class="na">class</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">EmailChannel</span><span class="o">::</span><span class="na">class</span><span class="p">],</span> <span class="c1">// SMSでない場合は、Eメール通知とします。</span>
            <span class="s1">&#39;database&#39;</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return MailMessage</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toMail</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Emailのメッセージ内容を返却します。</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s2">&quot;コードを送信いたしました。&quot;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">markdown</span><span class="p">(</span><span class="s2">&quot;template.mail&quot;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s2">&quot;tfa_token&quot;</span> <span class="o">=&gt;</span> <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">tfaToken</span><span class="p">()</span>
            <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>@component(&quot;mail::message&quot;) 認証コード『{ $tfa_token }}』を入力して下さい。<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>

+++++++++++++++++++++++++++++++++++++<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
本アドレスは送信専用です。 ご返信頂いてもお答えできませんので、ご了承ください。
@endcomponent
</code></pre></div>
<h4 id="sms">▼ SMS通知内容の定義<a class="headerlink" href="#sms" title="Permanent link">&para;</a></h4>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/notifications.html#formatting-sms-notifications">https://readouble.com/laravel/8.x/ja/notifications.html#formatting-sms-notifications</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Notifications</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\EmailChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\AwsSnsChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TfaTokenNotification</span> <span class="k">extends</span> <span class="nx">Notification</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">via</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">prefers_sms</span> <span class="o">?</span> <span class="p">[</span><span class="nx">AwsSnsChannel</span><span class="o">::</span><span class="na">class</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">EmailChannel</span><span class="o">::</span><span class="na">class</span><span class="p">],</span> <span class="c1">// SMSの場合は、AWS-SNSを使用します。</span>
            <span class="s1">&#39;database&#39;</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toSms</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// SMSのメッセージ内容を返却します。</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s2">&quot;template.sms&quot;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s2">&quot;subject&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;コードを送信いたしました。&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tfa_token&quot;</span> <span class="o">=&gt;</span> <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">tfaToken</span><span class="p">()</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="slack">▼ Slack通知内容の定義<a class="headerlink" href="#slack" title="Permanent link">&para;</a></h4>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/notifications.html#formatting-slack-notifications">https://readouble.com/laravel/8.x/ja/notifications.html#formatting-slack-notifications</a></li>
</ul>
</blockquote>
<h4 id="db_3">▼ DB通知内容の定義<a class="headerlink" href="#db_3" title="Permanent link">&para;</a></h4>
<p>配列でDBに保存する内容を定義する。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/7.x/ja/notifications.html#database-notifications">https://readouble.com/laravel/7.x/ja/notifications.html#database-notifications</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Notifications</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\EmailChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Notifications\Channels\AwsSnsChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TfaTokenNotification</span> <span class="k">extends</span> <span class="nx">Notification</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">via</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">prefers_sms</span> <span class="o">?</span> <span class="p">[</span><span class="nx">AwsSnsChannel</span><span class="o">::</span><span class="na">class</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">EmailChannel</span><span class="o">::</span><span class="na">class</span><span class="p">],</span>
            <span class="s1">&#39;database&#39;</span> <span class="c1">// DB受信チャンネル</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $notifiable</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// notificationsテーブルのdataカラムに、JSONで保存されます。</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;tfa_token&quot;</span> <span class="o">=&gt;</span> <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">tfaToken</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_56">受信チャンネル (通知方法)<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h3>
<h4 id="channel">▼ Channel<a class="headerlink" href="#channel" title="Permanent link">&para;</a></h4>
<p>Laravelがデフォルトで用意しているチャンネル以外に送信したい場合、ユーザー定義の受信チャンネルを定義する。</p>
<p>これは、Notificationクラスの<code>via</code>メソッドで使用される。</p>
<p><strong>＊実装例＊</strong></p>
<p>AWS SNSを受信チャンネルとする。</p>
<p>AWSから配布されているパッケージが必要である。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>composer<span class="w"> </span>require<span class="w"> </span>aws/aws-sdk-php-laravel
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Notifications\Channels</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Aws\Sns\SnsClient</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Aws\Exception\AwsException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AwsSnsChannel</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param SnsClient $awsSnsClient</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">SnsClient</span> <span class="nv">$awsSnsClient</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">awsSnsClient</span> <span class="o">=</span> <span class="nv">$awsSnsClient</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param              $notifiable</span>
<span class="sd">     * @param Notification $notification</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">send</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">,</span> <span class="nx">Notification</span> <span class="nv">$notification</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$notification</span><span class="o">-&gt;</span><span class="na">toSms</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">);</span>

            <span class="c1">// AWS SNSにメッセージを送信します。</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">awsSnsClient</span><span class="o">-&gt;</span><span class="na">publish</span><span class="p">([</span>
                <span class="s2">&quot;Message&quot;</span>     <span class="o">=&gt;</span> <span class="nv">$message</span><span class="p">,</span>
                <span class="s2">&quot;PhoneNumber&quot;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">toE164nizeInJapan</span><span class="p">(</span>
                    <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">phoneNumber</span><span class="p">()</span>
                <span class="p">),</span>
            <span class="p">]);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">AwsException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span>
                    <span class="s2">&quot;%s : %s at %s line %s&quot;</span><span class="p">,</span>
                    <span class="nb">get_class</span><span class="p">(</span><span class="nv">$e</span><span class="p">),</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getFile</span><span class="p">(),</span>
                    <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getLine</span><span class="p">())</span>
            <span class="p">);</span>

            <span class="k">throw</span> <span class="k">new</span> <span class="nx">AwsException</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param string</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">toE164nizeInJapan</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$phoneNumeber</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="c1">// E.164形式の日本電話番号を返却します。</span>
        <span class="k">return</span> <span class="s2">&quot;+81&quot;</span> <span class="o">.</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$phoneNumeber</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_57">通知対象モデル<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h3>
<h4 id="notifiablenotify">▼ Notifiableトレイトの<code>notify</code>メソッド<a class="headerlink" href="#notifiablenotify" title="Permanent link">&para;</a></h4>
<p>通知対象となるモデルを定義する。</p>
<p>Notifiableトレイトを継承する。</p>
<p>これにより、<code>notify</code>メソッドを使用できるようになる。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Notifications/Notifiable.html">https://laravel.com/api/8.x/Illuminate/Notifications/Notifiable.html</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>通知先のクラスから<code>notify</code>メソッドをコールし、任意のNotificationクラスを渡す。</p>
<p>これにより、通知処理が実行される。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Notifications/RoutesNotifications.html#method_notify">https://laravel.com/api/8.x/Illuminate/Notifications/RoutesNotifications.html#method_notify</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">FooNotification</span><span class="p">());</span>
</code></pre></div>
<h4 id="notification_1">▼ Notificationファサード<a class="headerlink" href="#notification_1" title="Permanent link">&para;</a></h4>
<p>通知対象となるモデルを定義する。</p>
<p>Notifiableトレイトを継承する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Notificationファサードに通知先のモデルと通知クラスを渡す。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nx">Notification</span><span class="o">::</span><span class="na">send</span><span class="p">(</span><span class="nv">$users</span><span class="p">,</span> <span class="k">new</span> <span class="nx">FooNotification</span><span class="p">());</span>
</code></pre></div>
<h4 id="_58">▼ オンデマンド通知<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h4>
<p>オンデマンド通知を使用すると、通知対象となるモデルがNotificableトレイトに依存せずに通知を実行できる。</p>
<blockquote>
<ul>
<li><a href="https://laracasts.com/discuss/channels/laravel/notifications-without-eloquent-user-model">https://laracasts.com/discuss/channels/laravel/notifications-without-eloquent-user-model</a></li>
<li><a href="https://readouble.com/laravel/8.x/ja/notifications.html#on-demand-notifications">https://readouble.com/laravel/8.x/ja/notifications.html#on-demand-notifications</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nx">Notification</span><span class="o">::</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email_address</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;nexmo&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">phone_number</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;slack&#39;</span><span class="p">,</span> <span class="nv">$slackMessage</span><span class="o">-&gt;</span><span class="na">usl</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">FooMotification</span><span class="p">());</span>
</code></pre></div>
<p><br></p>
<h2 id="14-resource">14. Resource<a class="headerlink" href="#14-resource" title="Permanent link">&para;</a></h2>
<h3 id="_59">レスポンスデータ作成前のデータ型変換<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h3>
<h4 id="_60">▼ データ型変換の必要性<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h4>
<p>EloquentモデルをJSON型データとしてレスポンスする時に、一旦、配列データに変換する必要がある。</p>
<h4 id="eloquent">▼ 単一のEloquentモデルの配列化<a class="headerlink" href="#eloquent" title="Permanent link">&para;</a></h4>
<p>単一のEloquentモデルを配列に変換する。</p>
<p>Resourceクラスの<code>toArray</code>メソッドにて、<code>this</code>変数は自身ではなく、Resourceクラス名につくEloquentモデル名になる。</p>
<p>また、<code>this</code>変数からゲッターを経由せずに直接的にプロパティにアクセスできる。</p>
<p>Controllerにて、ResouceクラスにEloquentモデルを渡すようにする。</p>
<p>LaravelはレスポンスのJSON型データを作成するために、まず<code>toArray</code>メソッドにより配列化し、加えてこれをJSON型データに変換する。</p>
<p><strong>＊実装例＊</strong></p>
<p>Fooクラスからデータを取り出し、配列化する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\JsonResource</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooJsonResource</span> <span class="k">extends</span> <span class="nx">JsonResource</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * オブジェクトを配列に変換します。</span>


<span class="sd">     *</span>
<span class="sd">     * @param  Request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;id&quot;</span>       <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span>     <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span><span class="nx">。</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * クライアントにデータを返却します。</span>


<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ここに、EloquentモデルをDBから取得する処理</span>

        <span class="c1">// Eloquentモデルを渡す。</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">FooResource</span><span class="p">(</span><span class="nv">$foo</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="eloquent-collection">▼ 複数のEloquentモデル (Collection型) の配列化<a class="headerlink" href="#eloquent-collection" title="Permanent link">&para;</a></h4>
<p>複数のEloquentモデル (Collection型) を配列に変換する。</p>
<div class="highlight"><pre><span></span><code><span class="x">// ここに実装例</span>
</code></pre></div>
<p><br></p>
<h2 id="15-routing">15. Routing<a class="headerlink" href="#15-routing" title="Permanent link">&para;</a></h2>
<h3 id="apiphp"><code>api.php</code>ファイル<a class="headerlink" href="#apiphp" title="Permanent link">&para;</a></h3>
<h4 id="middleware_4">▼ Middlewareの適用<a class="headerlink" href="#middleware_4" title="Permanent link">&para;</a></h4>
<p>APIのエンドポイントとして働くルーティング処理を実装する。</p>
<p>実装したルーティング処理時には、Kernelクラスの<code>middlewareGroups</code>プロパティの<code>api</code>キーで設定したミドルウェアが実行される。</p>
<p>APIのエンドポイントは外部公開する必要があるため、<code>web</code>キーと比較して、セキュリティのためのミドルウェアが設定されていない。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Middleware\BeforeMiddleware\FooIdConverterMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\Kernel</span> <span class="k">as</span> <span class="nx">HttpKernel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Kernel</span> <span class="k">extends</span> <span class="nx">HttpKernel</span>
<span class="p">{</span>
    <span class="c1">// 〜 中略 〜</span>

    <span class="sd">/**</span>
<span class="sd">     * The application&quot;s route middleware groups.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$middlewareGroups</span> <span class="o">=</span> <span class="p">[</span>

        <span class="c1">// 〜 中略 〜</span>

        <span class="s2">&quot;api&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s2">&quot;throttle:60,1&quot;</span><span class="p">,</span>
            <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>

    <span class="c1">// 〜 中略 〜</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="webphp"><code>web.php</code>ファイル<a class="headerlink" href="#webphp" title="Permanent link">&para;</a></h3>
<h4 id="middleware_5">▼ Middlewareの適用<a class="headerlink" href="#middleware_5" title="Permanent link">&para;</a></h4>
<p>API以外のルーティング処理を実装する。</p>
<p>実装したルーティング処理時には、Kernelクラスの<code>middlewareGroups</code>プロパティの<code>web</code>キーで設定したミドルウェアが実行される。</p>
<p>API以外のルーティングは外部公開する必要がないため、<code>api</code>キーと比較して、セキュリティのためのミドルウェアが多く設定されている。</p>
<p>例えば、CSRF対策のためのVerifyCsrfTokenクラスがある。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Middleware\BeforeMiddleware\FooIdConverterMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\Kernel</span> <span class="k">as</span> <span class="nx">HttpKernel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Kernel</span> <span class="k">extends</span> <span class="nx">HttpKernel</span>
<span class="p">{</span>
    <span class="c1">// 〜 中略 〜</span>

    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$middlewareGroups</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;web&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="nx">\App\Http\Middleware\EncryptCookies</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nx">\Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nx">\Illuminate\Session\Middleware\StartSession</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="c1">// \Illuminate\Session\Middleware\AuthenticateSession::class,</span>
            <span class="nx">\Illuminate\View\Middleware\ShareErrorsFromSession</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nx">\App\Http\Middleware\VerifyCsrfToken</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="c1">// 〜 中略 〜</span>

    <span class="p">];</span>

    <span class="c1">// 〜 中略 〜</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="guestphp"><code>guest.php</code>ファイル<a class="headerlink" href="#guestphp" title="Permanent link">&para;</a></h3>
<p>ヘルスチェックなど、API認証が不要なルーティング処理を実装する。</p>
<p><br></p>
<h3 id="_61">暗黙のモデル結合<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h3>
<h4 id="_62">▼ コントローラー使用時<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h4>
<p>ルーティング時に使用するパラメーター名とコントローラーのメソッドの引数型と変数名が同じであり、かつパラメーターに数値が割り当てられた場合、その数値をIDとするEloquentモデルが自動的にインジェクションされる。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/routing.html#implicit-binding">https://readouble.com/laravel/8.x/ja/routing.html#implicit-binding</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<p>ルーティング時に、パスパラメーター名を<code>user</code>としておく。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/{user}&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@index&#39;</span><span class="p">);</span>
</code></pre></div>
<p>かつ、コントローラーのメソッドの引数型/変数名を<code>User</code>/<code>$user</code>とする。</p>
<p>または。</p>
<p>この時、『<code>/users/1</code>』に対してリクエストを送信すると、ユーザーIDが<code>1</code>のユーザーがDBから読み出され、コントローラーにインジェクションされる。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param User $user</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span> <span class="c1">// パスパラメーターのidに紐付くユーザーが自動的に渡されている。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h2 id="16-security">16. Security<a class="headerlink" href="#16-security" title="Permanent link">&para;</a></h2>
<h3 id="csrf">CSRF対策<a class="headerlink" href="#csrf" title="Permanent link">&para;</a></h3>
<h4 id="_63">▼ アプリケーション側の対応<a class="headerlink" href="#_63" title="Permanent link">&para;</a></h4>
<p>セッション開始時にCSRFトークンが作成される。</p>
<p>Bladeを使用してサーバ側のCSRFトークンを取り出し、inputタグのhidden属性にCSRFトークンを割り当て送信する。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/csrf.html">https://readouble.com/laravel/8.x/ja/csrf.html</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/profile&quot;</span><span class="p">&gt;</span>@csrf ...<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
<p>Bladeを使用しない場合、セッション開始時のレスポンスの<code>Set-Cookie</code>にCSRFトークンが割り当てられるため、これを取り出して<code>X-CSRF-TOKEN</code>ヘッダーや<code>X-XSRF-TOKEN</code>ヘッダーに割り当てるようにする。リクエストのたびに異なるCSRFトークンがレスポンスされ、これを次のリクエストで使用する必要がある。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/csrf.html#csrf-x-csrf-token">https://readouble.com/laravel/8.x/ja/csrf.html#csrf-x-csrf-token</a></li>
<li><a href="https://readouble.com/laravel/8.x/ja/csrf.html#csrf-x-xsrf-token">https://readouble.com/laravel/8.x/ja/csrf.html#csrf-x-xsrf-token</a></li>
<li><a href="https://stackoverflow.com/questions/42408177/what-is-the-difference-between-x-xsrf-token-and-x-csrf-token">https://stackoverflow.com/questions/42408177/what-is-the-difference-between-x-xsrf-token-and-x-csrf-token</a></li>
</ul>
</blockquote>
<h4 id="http">▼ HTTPクライアントツール側の対応<a class="headerlink" href="#http" title="Permanent link">&para;</a></h4>
<p>PostmanなどのHTTPクライアントツールをフロントエンドの代わりに使用する場合は、レスポンスで返信されるCSRFトークを扱えない、そこで、各リクエストで事前にルートパスのエンドポイントをコールし、CSRFトークンをPostmanの環境変数に保存するようなスクリプトを設定しておくと良い。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pm</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="nx">pm</span><span class="p">.</span><span class="nx">sendRequest</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8000&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">cookies</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">xsrfTokenHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookies</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s2">&quot;XSRF-TOKEN&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">xsrfTokenHeader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;トークンがありません&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// laravelによってエンコードされたトークンをデコードする。</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">xsrfToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">xsrfTokenHeader</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>
<span class="w">  </span><span class="c1">// 環境変数を挿入するために、該当する実行環境名をCollection全体に適用しておく必要がある。</span>
<span class="w">  </span><span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;XSRF_TOKEN&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">xsrfToken</span><span class="p">);</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xsrfToken</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="xss">▼ XSS対策<a class="headerlink" href="#xss" title="Permanent link">&para;</a></h4>
<h4 id="https">▼ 常時HTTPS化<a class="headerlink" href="#https" title="Permanent link">&para;</a></h4>
<p><br></p>
<h2 id="17-seeder">17. Seeder<a class="headerlink" href="#17-seeder" title="Permanent link">&para;</a></h2>
<h3 id="_64">初期データの定義<a class="headerlink" href="#_64" title="Permanent link">&para;</a></h3>
<h4 id="db_4">▼ DBファサードによる定義<a class="headerlink" href="#db_4" title="Permanent link">&para;</a></h4>
<p>DBファサードを使用して、初期データを定義する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Constants\ExecutorConstant</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProductsSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Seederを実行します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s2">&quot;products&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span>
                <span class="s2">&quot;product_name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;シャープペンシル&quot;</span><span class="p">,</span>
                <span class="s2">&quot;price&quot;</span>        <span class="o">=&gt;</span> <span class="mi">300</span><span class="p">,</span>
                <span class="s2">&quot;product_type&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;created_by&quot;</span>   <span class="o">=&gt;</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">ARTISAN_COMMAND</span><span class="p">,</span>
                <span class="s2">&quot;updated_by&quot;</span>   <span class="o">=&gt;</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">ARTISAN_COMMAND</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span>   <span class="o">=&gt;</span> <span class="nx">NOW</span><span class="p">(),</span>
                <span class="s2">&quot;updated_at&quot;</span>   <span class="o">=&gt;</span> <span class="nx">NOW</span><span class="p">(),</span>
                <span class="s2">&quot;deleted_at&quot;</span>   <span class="o">=&gt;</span> <span class="k">NULL</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;product_name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;ノート&quot;</span><span class="p">,</span>
                <span class="s2">&quot;price&quot;</span>        <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">,</span>
                <span class="s2">&quot;product_type&quot;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;created_by&quot;</span>   <span class="o">=&gt;</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">ARTISAN_COMMAND</span><span class="p">,</span>
                <span class="s2">&quot;updated_by&quot;</span>   <span class="o">=&gt;</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">ARTISAN_COMMAND</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span>   <span class="o">=&gt;</span> <span class="nx">NOW</span><span class="p">(),</span>
                <span class="s2">&quot;updated_at&quot;</span>   <span class="o">=&gt;</span> <span class="nx">NOW</span><span class="p">(),</span>
                <span class="s2">&quot;deleted_at&quot;</span>   <span class="o">=&gt;</span> <span class="k">NULL</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;product_name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;消しゴム&quot;</span><span class="p">,</span>
                <span class="s2">&quot;price&quot;</span>        <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s2">&quot;product_type&quot;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;created_by&quot;</span>   <span class="o">=&gt;</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">ARTISAN_COMMAND</span><span class="p">,</span>
                <span class="s2">&quot;updated_by&quot;</span>   <span class="o">=&gt;</span> <span class="nx">ExecutorConstant</span><span class="o">::</span><span class="na">ARTISAN_COMMAND</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span>   <span class="o">=&gt;</span> <span class="nx">NOW</span><span class="p">(),</span>
                <span class="s2">&quot;updated_at&quot;</span>   <span class="o">=&gt;</span> <span class="nx">NOW</span><span class="p">(),</span>
                <span class="s2">&quot;deleted_at&quot;</span>   <span class="o">=&gt;</span> <span class="k">NULL</span>
            <span class="p">],</span>

            <span class="o">...</span>

        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>実行者名は、定数として管理しておくと良い。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Constants</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * 実行者定数クラス</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">ExecutorConstant</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Artisanコマンド</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">ARTISAN_COMMAND</span> <span class="o">=</span> <span class="s2">&quot;Artisan Command&quot;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * スタッフ</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">STAFF</span> <span class="o">=</span> <span class="s2">&quot;Staff&quot;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * ゲスト</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">GUEST</span> <span class="o">=</span> <span class="s2">&quot;Guest&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="csv">▼ CSVファイルによる定義<a class="headerlink" href="#csv" title="Permanent link">&para;</a></h4>
<p>CSVファイルを使用して、初期データを定義する。</p>
<p>DBファサードを使用するよりも。</p>
<p>大サイズのデータを定義しやすい。</p>
<p>この時、<code>LOAD DATA LOCAL INFILE</code>文を使用すると、高速で処理できる。</p>
<blockquote>
<ul>
<li><a href="https://i-407.com/blog/tech/n3/">https://i-407.com/blog/tech/n3/</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Constants\ExecutorConstant</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProductsSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Seederを実行します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 〜 中略 〜</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">importCsv</span><span class="p">();</span>

        <span class="c1">// 〜 中略 〜</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * CSVを読み込んでDBにデータを保存します。</span>


<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">importCsv</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tables</span> <span class="k">as</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// S3に保存してあるCSVファイルを読み込む。</span>
            <span class="nv">$csv</span> <span class="o">=</span> <span class="nx">\Storage</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nx">migrations</span><span class="o">/</span><span class="nx">csv</span><span class="o">/</span> <span class="o">.</span> <span class="nv">$table</span> <span class="o">.</span> <span class="s1">&#39;.csv&#39;</span><span class="p">);</span>

            <span class="c1">// 一時CSVファイルに書き込む。</span>
            <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">&#39;/tmp/csv&#39;</span><span class="p">,</span> <span class="nv">$csv</span><span class="p">);</span>

            <span class="c1">// 一時ファイルを使用して、DBにCSVファイルの中身を書き込む。</span>
            <span class="nx">\DB</span><span class="o">::</span><span class="na">statement</span><span class="p">(</span>
                <span class="s2">&quot;LOAD DATA LOCAL INFILE &#39;/tmp/csv&#39;</span>
<span class="s2">                INTO TABLE </span><span class="si">{</span><span class="nv">$table</span><span class="si">}</span>
<span class="s2">                FIELDS terminated by &#39;,&#39;</span>
<span class="s2">                ENCLOSED BY &#39;</span><span class="se">\&quot;</span><span class="s2">&#39;</span>
<span class="s2">                ESCAPED BY &#39;</span><span class="se">\\</span><span class="s2">\&#39;</span>
<span class="s2">                LINES TERMINATED BY &#39;</span><span class="se">\n</span><span class="s2">&#39;</span>
<span class="s2">                IGNORE 1 LINES&quot;</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="seeder_1">Seederの実行<a class="headerlink" href="#seeder_1" title="Permanent link">&para;</a></h3>
<p>DatabaseSeederにて、全てのSeederをまとめて実行する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Seederを実行します。</span>


<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 開発環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// ダミーデータ</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// テスト環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;tes&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// リアルデータ</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// ステージング環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;stg&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// リアルデータ</span>
                <span class="nx">ProductsSeeder</span><span class="o">::</span><span class="na">class</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// 本番環境用の初期データ</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="na">environment</span><span class="p">(</span><span class="s2">&quot;prd&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span>
                <span class="c1">// リアルデータ</span>
                <span class="nx">ProductsSeeder</span><span class="o">::</span><span class="na">class</span>
            <span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h2 id="18-serviceprovider">18. ServiceProvider<a class="headerlink" href="#18-serviceprovider" title="Permanent link">&para;</a></h2>
<h3 id="serviceprovider">ServiceProvider<a class="headerlink" href="#serviceprovider" title="Permanent link">&para;</a></h3>
<h4 id="serviceprovider_1">▼ ServiceProviderの用途<a class="headerlink" href="#serviceprovider_1" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>用途の種類</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppServiceProvider</td>
<td>・ServiceContainerへのクラスのバインド (登録) <br>・ServiceContainerからのインスタンスのリゾルブ (作成)</td>
</tr>
<tr>
<td>MacroServiceProvider</td>
<td>ServiceContainerへのメソッドのバインド (登録)</td>
</tr>
<tr>
<td>RouteServiceProvider<br>(<code>app.php</code>、<code>web.php</code>も使用)</td>
<td>ルーティングとコントローラーの対応関係の定義</td>
</tr>
<tr>
<td>EventServiceProvider</td>
<td>EventListenerとEventhandler関数の対応関係の定義</td>
</tr>
</tbody>
</table>
<h4 id="serviceprovider_2">▼ ServiceProviderのコール<a class="headerlink" href="#serviceprovider_2" title="Permanent link">&para;</a></h4>
<p>クラスの名前空間を、<code>config/app.php</code>ファイルの<code>providers</code>配列に登録すると、アプリケーションの起動時にServiceProviderをコールできるため、ServiceContainerへのクラスのバインドが自動的に完了する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="s2">&quot;providers&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span>

    <span class="c1">// 複数のServiceProviderが実装されている</span>

    <span class="nx">App\Providers\ComposerServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">],</span>
</code></pre></div>
<p><br></p>
<h3 id="servicecontainer">ServiceContainer<a class="headerlink" href="#servicecontainer" title="Permanent link">&para;</a></h3>
<h4 id="servicecontainer_1">▼ ServiceContainer、バインド、リゾルブとは<a class="headerlink" href="#servicecontainer_1" title="Permanent link">&para;</a></h4>
<p>ServiceContainer、バインド、リゾルブについては、以下のリンクを参考にせよ。</p>
<blockquote>
<ul>
<li><a href="https://hiroki-it.github.io/tech-notebook/language/language_php_class_based.html">https://hiroki-it.github.io/tech-notebook/language/language_php_class_based.html</a></li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Contracts\Container</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Psr\Container\ContainerInterface</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Container</span> <span class="k">extends</span> <span class="nx">ContainerInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 通常のバインディングとして、自身にバインドする。</span>


<span class="sd">     * 第二引数は、クロージャー、もしくはクラス名前空間</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $abstract</span>
<span class="sd">     * @param  \Closure|string|null  $concrete</span>
<span class="sd">     * @param  bool  $shared</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bind</span><span class="p">(</span><span class="nv">$abstract</span><span class="p">,</span> <span class="nv">$concrete</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$shared</span> <span class="o">=</span> <span class="k">false</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * singletonとして、自身にバインドする。</span>


<span class="sd">     *</span>
<span class="sd">     * @param  string  $abstract</span>
<span class="sd">     * @param  \Closure|string|null  $concrete</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">singleton</span><span class="p">(</span><span class="nv">$abstract</span><span class="p">,</span> <span class="nv">$concrete</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="appserviceprovider">AppServiceProvider<a class="headerlink" href="#appserviceprovider" title="Permanent link">&para;</a></h3>
<h4 id="_65">▼ 単一のクラスをバインド/リゾルブ<a class="headerlink" href="#_65" title="Permanent link">&para;</a></h4>
<p>AppSeriveProviderにて、ServiceContainerにクラスをバインドすることによって、ServiceContainerがインスタンスをリゾルブできるようになる。</p>
<p>これにより、メソッドの引数でクラスを指定しさえすれば、そのクラスのインスタンスが渡されるため、自動的に依存オブジェクト注入が実行されたことになる。</p>
<p>Laravelでは、クラスはServiceContainerに自動的にバインドされており、引数でクラスを指定するのみでインスタンスが作成されるため、以下の実装を実行する必要はない。</p>
<p>ただし、混合型の場合は引数の型を指定できないため、リゾルブは実行できない。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/container.html#automatic-injection">https://readouble.com/laravel/8.x/ja/container.html#automatic-injection</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<p>バインドする。</p>
<p>注意点として、Laravelでは不要である。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Bar</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Baz</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Foo</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * コンテナにバインド</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="nx">Foo</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">(</span><span class="k">new</span> <span class="nx">Bar</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Baz</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>引数の型を元に、クラスのインスタンスがリゾルブされる。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Qux</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Foo $foo</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">method</span><span class="p">(</span><span class="nx">Foo</span> <span class="nv">$foo</span><span class="p">)</span> <span class="c1">// リゾルブされる。</span>
    <span class="p">{</span>
        <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">;</span>
        <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">baz</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>引数の型を指定しない場合は、手動で渡す必要がある。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Models\Foo</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Qux</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Foo $foo</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$foo</span><span class="p">)</span> <span class="c1">// 引数の型を指定しない場合、リゾルブされない。</span>
    <span class="p">{</span>
        <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">;</span>
        <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">baz</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nv">$qux</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Qux</span><span class="p">(</span><span class="nv">$foo</span><span class="p">);</span> <span class="c1">// 手動で渡す</span>
</code></pre></div>
<p>混合型の場合は、引数の型を指定できないため、リゾルブを実行できない。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Models\Foo1</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Foo2</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Foo3</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Qux</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param Foo1|Foo2|Foo3 $mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$mixed</span><span class="p">)</span> <span class="c1">// 混合型では引数の型を指定できない</span>
    <span class="p">{</span>
        <span class="nv">$mixed</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">;</span>
        <span class="nv">$mixed</span><span class="o">-&gt;</span><span class="na">baz</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$foo1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo1</span><span class="p">();</span>
<span class="nv">$foo2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo2</span><span class="p">();</span>
<span class="nv">$foo3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo3</span><span class="p">();</span>

<span class="nv">$qux</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Qux</span><span class="p">(</span><span class="nv">$foo1</span><span class="p">);</span>
</code></pre></div>
<h4 id="_66">▼ 複数のクラスをバインド/リゾルブ<a class="headerlink" href="#_66" title="Permanent link">&para;</a></h4>
<p>メソッドの引数でクラスを指定しさえすれば、そのクラスのインスタンスが渡されるため、自動的に依存オブジェクト注入が実行されたことになる。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Foo\Entities</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Bar</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Baz</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FoosServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
     <span class="sd">/**</span>
<span class="sd">     * 各registerメソッドをコール</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerFoo</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerBar</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerBaz</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">    * 1つ目のクラスをバインド</span>
<span class="sd">    */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">registerFoo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="nx">Foo</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">    * 2つ目のクラスをバインド</span>
<span class="sd">    */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">registerBar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="nx">Bar</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">    * 3つ目のクラスをバインド</span>
<span class="sd">    */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">registerBaz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="nx">Baz</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Baz</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_67">▼ インターフェースをバインドし、実装クラスをリゾルブ<a class="headerlink" href="#_67" title="Permanent link">&para;</a></h4>
<p>Laravelではクラスが自動的にバインドされ、これのインスタンスがリゾルブされる、しかし、バインドされたクラスとは別のクラスのインスタンスをリゾルブしたい場合は、ServiceProviderにそれを定義すれば、自動的なバインドを上書きできる。</p>
<p>これを使用して、インターフェースをバインドし、実装クラスをリゾルブ可能にする。</p>
<p>この方法は、上位レイヤーが抽象に依存することが必要な場面 (例：依存性逆転の原則) で役立つ。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Domain\FooRepository</span> <span class="k">as</span> <span class="nx">FooRepositoryInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Infrastructure\FooRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * コンテナにバインド</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span>
            <span class="s2">&quot;App\Domain\Foo</span><span class="se">\R</span><span class="s2">epositories\FooRepositoryInterface&quot;</span><span class="p">,</span> <span class="c1">// インターフェース</span>
            <span class="s2">&quot;App\Infrastructure\Doo</span><span class="se">\R</span><span class="s2">epositories\FooRepository&quot;</span> <span class="c1">// 実装クラス</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Interactor</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var FooRepositoryIF</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nx">FooRepositoryIF</span> <span class="nv">$fooRepository</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param FooRepositoryIF $fooRepository</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__constructor</span><span class="p">(</span><span class="nx">FooRepositoryIF</span> <span class="nv">$fooRepository</span><span class="p">)</span> <span class="c1">// リゾルブされる。</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fooRepository</span> <span class="o">=</span> <span class="nv">$fooRepository</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="make">▼ <code>make</code>メソッド<a class="headerlink" href="#make" title="Permanent link">&para;</a></h4>
<p>引数の型でリゾルブを実行する以外に、<code>make</code>メソッドも使用できる。</p>
<p><code>make</code>メソッドの引数にクラスの名前空間を渡すことにより、インスタンスがリゾルブされる。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/container.html#the-make-method">https://readouble.com/laravel/8.x/ja/container.html#the-make-method</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Fooクラスをリゾルブし、そのままmethodをコール</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="nx">Foo</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>

<span class="c1">// Fooクラスをリゾルブ</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nx">Foo</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
</code></pre></div>
<h4 id="registerboot">▼ <code>register</code>メソッドと<code>boot</code>メソッドの違い<a class="headerlink" href="#registerboot" title="Permanent link">&para;</a></h4>
<p>Laravelのライフサイクルで、ServiceContainerへのクラスのバインドの時には、まずServiceProviderの<code>register</code>メソッドが実行され、その後に<code>boot</code>メソッドが実行される。</p>
<p>そのため、ServiceProviderが他のServiceProviderをコールするような処理を実装したいとき、これは<code>boot</code>メソッドに実装することが適している。</p>
<p><br></p>
<h3 id="migrationmacroserviceprovider">MigrationMacroServiceProvider<a class="headerlink" href="#migrationmacroserviceprovider" title="Permanent link">&para;</a></h3>
<p>複数のテーブルに共通のカラムを作成するDBマイグレーション処理を提供する。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * マイグレーションマクロサービスプロバイダクラス</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MigrationMacroServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * サービスコンテナにDBマイグレーションメソッドをバインドします。</span>


<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Blueprint</span><span class="o">::</span><span class="na">macro</span><span class="p">(</span><span class="s2">&quot;systemColumns&quot;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s2">&quot;created_by&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;レコードの作成者&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s2">&quot;updated_by&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;レコードの最終更新者&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;レコードの作成日&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;レコードの最終更新日&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s2">&quot;deleted_at&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;レコードの削除日&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
        <span class="p">});</span>

        <span class="nx">Blueprint</span><span class="o">::</span><span class="na">macro</span><span class="p">(</span><span class="s2">&quot;dropSystemColumns&quot;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span>
                <span class="s2">&quot;created_by&quot;</span><span class="p">,</span>
                <span class="s2">&quot;updated_by&quot;</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
                <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>
                <span class="s2">&quot;deleted_at&quot;</span>
            <span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>DBマイグレーションファイルにて、定義した<code>systemColumn</code>メソッドをコールする。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateFooTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * マイグレート</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s2">&quot;foos&quot;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">bigIncrements</span><span class="p">(</span><span class="s2">&quot;foo_id&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">comment</span><span class="p">(</span><span class="s2">&quot;名前&quot;</span><span class="p">);</span>

            <span class="c1">// MigrationMacroServiceProviderのメソッドを使用する。</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">systemColumns</span><span class="p">();</span>

            <span class="c1">// deleted_atカラムを追加する。</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">softDeletes</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * ロールバック</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s2">&quot;foos&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>最後に、<code>app.php</code>ファイルにて、MigrationMacroServiceProviderを新しく読み込む。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="o">...</span>

    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// マクロサービスプロバイダー</span>
        <span class="nx">App\Providers\MigrationMacroServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="o">...</span>

<span class="p">];</span>
</code></pre></div>
<p><br></p>
<h3 id="routeserviceprovider">RouteServiceProvider<a class="headerlink" href="#routeserviceprovider" title="Permanent link">&para;</a></h3>
<h4 id="_68">▼ 全てのルーティングへの処理<a class="headerlink" href="#_68" title="Permanent link">&para;</a></h4>
<p>ルーティングの設定ファイルをコールする。</p>
<p>また、全てのルーティングに適用する処理を定義する。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/routing.html#parameters-global-constraints">https://readouble.com/laravel/8.x/ja/routing.html#parameters-global-constraints</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\RouteServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RouteServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * ルーティングの設定ファイルをコールします。</span>


<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ヘルスチェック</span>
        <span class="nx">Route</span><span class="o">::</span><span class="na">prefix</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">namespace</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">namespace</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;routes/healthcheck.php&#39;</span><span class="p">));</span>

        <span class="c1">// API</span>
        <span class="nx">Route</span><span class="o">::</span><span class="na">prefix</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">namespace</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">namespace</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;routes/api.php&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_69">▼ リクエスト数制限<a class="headerlink" href="#_69" title="Permanent link">&para;</a></h4>
<p><code>1</code>分間当たりに許容するリクエスト数とその制限名を<code>configureRateLimiting</code>メソッドで定義する。</p>
<p>加えて、Throttleミドルウェアに制限名を渡し、指定したルートにリクエスト数制限を適用させる、もし制限を超えた場合、<code>configureRateLimiting</code>メソッドによって、<code>429</code>ステータスでレスポンスが返信される。</p>
<blockquote>
<ul>
<li><a href="https://readouble.com/laravel/8.x/ja/routing.html#rate-limiting">https://readouble.com/laravel/8.x/ja/routing.html#rate-limiting</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Cache\RateLimiting\Limit</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\RouteServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\RateLimiter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RouteServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$middlewareGroups</span> <span class="o">=</span> <span class="p">[</span>

        <span class="s1">&#39;web&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">],</span>

        <span class="s1">&#39;api&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="c1">// throttleミドルウェアを適用する。</span>
            <span class="s1">&#39;throttle:limit_per_minute&#39;</span><span class="p">,</span>
            <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureRateLimiting</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">RateLimiter</span><span class="o">::</span><span class="na">for</span><span class="p">(</span><span class="s1">&#39;limit_per_minute&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 一分間当たり1000リクエストまでを許可する。</span>
            <span class="k">return</span> <span class="nx">Limit</span><span class="o">::</span><span class="na">perMinute</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="eventserviceprovider">EventServiceProvider<a class="headerlink" href="#eventserviceprovider" title="Permanent link">&para;</a></h3>
<h4 id="eventlistener">▼ EventとListenerの登録<a class="headerlink" href="#eventlistener" title="Permanent link">&para;</a></h4>
<p>EventとListenerの対応関係を定義する。</p>
<p>注意点として、Eventを発火させてListenerを実行する方法は、Eventコンポーネントを参考にせよ。</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UpdatedModelEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Listeners\UpdatedModelListener</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\EventServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EventServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * イベントとリスナーの対応関係を配列で定義します。</span>


<span class="sd">     * [イベント =&gt; リスナー]</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$listen</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">// Eloquentモデル更新イベント</span>
        <span class="nx">UpdatedModelEvent</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="nx">UpdatedModelListener</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h2 id="19-session">19. Session<a class="headerlink" href="#19-session" title="Permanent link">&para;</a></h2>
<h3 id="_70">セッションの操作<a class="headerlink" href="#_70" title="Permanent link">&para;</a></h3>
<h4 id="_71">▼ 設定ファイル<a class="headerlink" href="#_71" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SESSION_DRIVER&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">),</span>

    <span class="s1">&#39;lifetime&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SESSION_LIFETIME&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>

    <span class="s1">&#39;expire_on_close&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>

    <span class="s1">&#39;encrypt&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>

    <span class="s1">&#39;files&#39;</span> <span class="o">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;framework/sessions&#39;</span><span class="p">),</span>

    <span class="s1">&#39;connection&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SESSION_CONNECTION&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>

    <span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sessions&#39;</span><span class="p">,</span>

    <span class="s1">&#39;store&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SESSION_STORE&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>

    <span class="s1">&#39;lottery&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>

    <span class="s1">&#39;cookie&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span>
        <span class="s1">&#39;SESSION_COOKIE&#39;</span><span class="p">,</span>
        <span class="nx">Str</span><span class="o">::</span><span class="na">slug</span><span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;laravel&#39;</span><span class="p">),</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;_session&#39;</span>
    <span class="p">),</span>

    <span class="s1">&#39;path&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>

    <span class="c1">// Set-Cookieヘッダーのdomain属性に値を割り当てる。</span>
    <span class="s1">&#39;domain&#39;</span>    <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SESSION_DOMAIN&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>

    <span class="c1">// Set-Cookieヘッダーのsecure属性を有効化する。</span>
    <span class="s1">&#39;secure&#39;</span>    <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SESSION_SECURE_COOKIE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>

    <span class="c1">// Set-CookieヘッダーのHttpOnly属性を有効化する。</span>
    <span class="s1">&#39;http_only&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>

    <span class="c1">// Set-CookieヘッダーのsameSite属性に値を割り当てる。nullの場合、Laxとなる。</span>
    <span class="s1">&#39;same_site&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
<span class="p">];</span>
</code></pre></div>
<h4 id="_72">▼ よく使用する操作メソッド<a class="headerlink" href="#_72" title="Permanent link">&para;</a></h4>
<p>FormRequestクラスの<code>session</code>メソッドはStoreクラスを返却する。</p>
<p>このクラスのメソッドを使用して、セッションを操作できる。</p>
<table>
<thead>
<tr>
<th>メソッド名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get</code></td>
<td>セッションのキー名を指定して、<code>1</code>個の値を取得する。</td>
</tr>
<tr>
<td><code>all</code></td>
<td>セッションの全ての値を取得する。</td>
</tr>
<tr>
<td><code>forget</code></td>
<td>セッションのキー名を指定して、値を取得する。キー名を配列で渡して、複数を削除することも可能。</td>
</tr>
<tr>
<td><code>flush</code></td>
<td>セッションの全ての値を取得する。</td>
</tr>
<tr>
<td><code>pull</code></td>
<td>セッションのキー名を指定して、<code>1</code>個の値を取得し、取得後に削除する。</td>
</tr>
<tr>
<td><code>has</code></td>
<td>セッションのキー名を指定して、値が存在しているかを検証する。<code>null</code>は<code>false</code>として判定する。</td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Store.html">https://laravel.com/api/8.x/Illuminate/Session/Store.html</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// getメソッド</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span>

        <span class="c1">// allメソッド</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

        <span class="c1">// forgetメソッド</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">forget</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">forget</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">]);</span>

        <span class="c1">// flush</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

        <span class="c1">// pullメソッド</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pull</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span>

        <span class="c1">// hasメソッド</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">))</span> <span class="p">{</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="store">▼ セッションデータがStoreクラスに至るまで<a class="headerlink" href="#store" title="Permanent link">&para;</a></h4>
<p>全てを追うことは難しいため、StartSessionクラスの<code>handle</code>メソッドが実行されるところから始めるものとする。</p>
<p>ここで、<code>handleStatefulRequest</code>メソッドの中の<code>startSession</code>メソッドが実行される。</p>
<p>これにより、Storeクラスの<code>start</code>メソッド、<code>loadSession</code>メソッド、<code>readFromHandler</code>メソッドが実行され、<code>SessionHandlerInterface</code>の実装クラスの<code>read</code>メソッドが実行される。</p>
<p><code>read</code>メソッドは、<code>storage/framework/sessions</code>にあるセッションデータに書き込まれたセッションを読み出し、<code>attribute</code>プロパティに格納する。</p>
<p>Sessionクラスのメソッドは、<code>attribute</code>プロパティを使用して、セッションを操作する。</p>
<p>最終的に,<code>handleStatefulRequest</code>では、<code>saveSession</code>メソッドの中の<code>save</code>メソッドが実行され、セッションデータに新しい値が書き込まれる。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_handle">https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_handle</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_handleStatefulRequest">https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_handleStatefulRequest</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_startSession">https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_startSession</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_start">https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_start</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_loadSession">https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_loadSession</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_readFromHandler">https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_readFromHandler</a></li>
<li><a href="https://www.php.net/manual/ja/sessionhandlerinterface.read.php">https://www.php.net/manual/ja/sessionhandlerinterface.read.php</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_saveSession">https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_saveSession</a></li>
<li><a href="https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_save">https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_save</a></li>
<li><a href="https://www.php.net/manual/ja/sessionhandlerinterface.write.php">https://www.php.net/manual/ja/sessionhandlerinterface.write.php</a></li>
</ul>
</blockquote>
<p><br></p>
<h2 id="20-views">20. Views<a class="headerlink" href="#20-views" title="Permanent link">&para;</a></h2>
<h3 id="_73">データの出力<a class="headerlink" href="#_73" title="Permanent link">&para;</a></h3>
<h4 id="_74">▼ データの出力<a class="headerlink" href="#_74" title="Permanent link">&para;</a></h4>
<p>Controllerクラスから返却されたデータは、<code>{{ 変数名 }}</code>で取得できる。</p>
<p>`</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello!! {{ $data }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="_75">▼ バリデーションメッセージの出力<a class="headerlink" href="#_75" title="Permanent link">&para;</a></h4>
<p>バリデーションでエラーが発生した場合、バリデーションでエラーがあった場合、Handlerクラスの<code>invalid</code>メソッドがコールされ、MessageBagクラスがViewに渡される。</p>
<p>MessageBagクラスは、Blade上で<code>errors</code>変数に格納されており、各メソッドをコールしてエラーメッセージを出力できる。</p>
<blockquote>
<ul>
<li><a href="https://laravel.com/api/8.x/Illuminate/Support/MessageBag.html">https://laravel.com/api/8.x/Illuminate/Support/MessageBag.html</a></li>
</ul>
</blockquote>
<p><strong>＊実装例＊</strong></p>
<p>MessageBagクラスの<code>all</code>メソッドで、全てのエラーメッセージを出力する。</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- /resources/views/foo/create.blade.php --&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>ポスト作成<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

@if ($errors-&gt;any())
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  @foreach ($errors-&gt;all() as $error)
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-danger&quot;</span><span class="p">&gt;</span>{{ $error }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  @endforeach
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
@endif @isset ($status)
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;complete&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>登録が完了しました。<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
@endisset

<span class="cm">&lt;!-- ポスト作成フォーム --&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nc">errors</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c">/* 何らかのデザイン */</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">complete</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c">/* 何らかのデザイン */</span>
<span class="p">}</span>
</code></pre></div>
<p><br></p>
<h3 id="_76">要素の共通化<a class="headerlink" href="#_76" title="Permanent link">&para;</a></h3>
<h4 id="include">▼ <code>@include</code> (サブビュー)<a class="headerlink" href="#include" title="Permanent link">&para;</a></h4>
<p>読み込んだファイル全体を出力する。</p>
<p>読み込むファイルに対して、変数を渡すこともできる。</p>
<p><code>@extentds</code>との使い分けとして、親子関係のないテンプレートの間で使用するのが良い。</p>
<p>両者は、PHPでいう<code>extends</code> (クラスチェーン) と<code>require</code> (単なる読み出し) の関係に近い。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  @include(&quot;shared.errors&quot;)
  <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span><span class="cm">&lt;!-- フォームの内容 --&gt;</span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p><br></p>
<h3 id="_77">要素の継承<a class="headerlink" href="#_77" title="Permanent link">&para;</a></h3>
<h4 id="yieldextendssectionendsection">▼ <code>@yield</code>、<code>@extends</code>、<code>@section</code>、<code>@endsection</code><a class="headerlink" href="#yieldextendssectionendsection" title="Permanent link">&para;</a></h4>
<p>子テンプレートのレンダリング時に、子テンプレートで新しく定義したHTMLの要素を、親テンプレートの指定した場所に出力する。親テンプレートにて、<code>@yield("foo")</code>を定義する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 親テンプレート --&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ja&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>アプリケーション<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>タイトル<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    @yield(&quot;content&quot;)
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>これを子テンプレートで<code>@extends</code>で継承すると、レンダリング時に、子テンプレートの<code>@section("foo")</code>-<code>@endsection</code>で定義した要素が、親テンプレートの<code>@yieid</code>メソッド部分に出力される。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 子テンプレート --&gt;</span>

@extends(&quot;layouts.parent&quot;) @section(&quot;content&quot;)
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンプレートのレンダリング時に、yieldに出力される要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
@endsection
</code></pre></div>
<p>補足として、子テンプレートは、レンダリング時に以下の様に出力される。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 子テンプレート --&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ja&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>アプリケーション<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>タイトル<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンプレートのレンダリング時に、yieldに出力される要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="sectionshowextendsparent">▼ <code>@section</code>、<code>@show</code>、<code>@extends</code>、<code>@parent</code><a class="headerlink" href="#sectionshowextendsparent" title="Permanent link">&para;</a></h4>
<p>子テンプレートのレンダリング時に、親テンプレートと子テンプレートそれぞれで新しく定義したHTMLの要素を、親テンプレートの指定した場所に出力する。親テンプレートにて、<code>@section</code>-<code>@show</code>で要素を定義する。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 親テンプレート --&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ja&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>アプリケーション<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>タイトル<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    @section(&quot;sidebar&quot;)
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>親テンプレートのサイドバーとなる要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    @show
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>子テンプレートの<code>@section</code>にて、<code>@parent</code>を使用する。</p>
<p>親テンプレートと子テンプレートそれぞれの要素が出力される。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 子テンプレート --&gt;</span>

@extends(&quot;layouts.app&quot;) @section(&quot;sidebar&quot;) @parent
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンレプートのサイドバーに追加される要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
@endsection
</code></pre></div>
<p>補足として、子テンプレートは、レンダリング時に以下の様に出力される。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 子テンプレート --&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ja&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>アプリケーション<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>タイトル<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>親テンプレートのサイドバーとなる要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンレプートのサイドバーに追加される要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="stackpush">▼ <code>@stack</code>、<code>@push</code><a class="headerlink" href="#stackpush" title="Permanent link">&para;</a></h4>
<p>子テンプレートのレンダリング時に、<code>.css</code>ファイルと<code>.js</code>ファイルを動的に出力する場合に使用する。親テンプレートにて、<code>@stack("foo")</code>を定義する。これを継承した子テンプレートのレンダリング時に、<code>@push("foo")</code>-<code>@endpush</code>で定義した要素が、<code>@stack</code>メソッド部分に出力される。</p>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 親テンプレート --&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- Headの内容 --&gt;</span>

  @stack(&quot;scripts&quot;)
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 子テンプレート --&gt;</span>

@push(&quot;scripts&quot;)
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/foo.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
@endpush
</code></pre></div>
<p><br></p>
<h3 id="twig">Twigとの互換<a class="headerlink" href="#twig" title="Permanent link">&para;</a></h3>
<h4 id="blade">▼ Bladeで実装した場合<a class="headerlink" href="#blade" title="Permanent link">&para;</a></h4>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 親テンプレート --&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>@yield(&quot;title&quot;)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    @section(&quot;sidebar&quot;) 親テンプレートのサイドバーとなる要素 @show

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>@yield(&quot;content&quot;)<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 子テンプレート --&gt;</span>

@extends(&quot;layouts.master&quot;) @section(&quot;title&quot;,
&quot;子テンプレートのタイトルになる要素&quot;) @section(&quot;sidebar&quot;) @parent
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンレプートのサイドバーに追加される要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
@endsection @section(&quot;content&quot;)
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンプレートのコンテンツになる要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
@endsection
</code></pre></div>
<h4 id="twig_1">▼ Twigで実装した場合<a class="headerlink" href="#twig_1" title="Permanent link">&para;</a></h4>
<p><strong>＊実装例＊</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 親テンプレート --&gt;</span>

<span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    {% block sidebar %}
    <span class="cm">&lt;!-- @section(&quot;sidebar&quot;) に相当 --&gt;</span>
    親テンプレートのサイドバーとなる要素 {% endblock %}

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
      {% block content %}<span class="cm">&lt;!-- @yield(&quot;content&quot;) に相当 --&gt;</span>
      {% endblock %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 子テンプレート --&gt;</span>

{% extends &quot;layouts.master&quot; %}
<span class="cm">&lt;!-- @extends(&quot;layouts.master&quot;) に相当 --&gt;</span>

{% block title %}
<span class="cm">&lt;!-- @section(&quot;title&quot;, &quot;Page Title&quot;) に相当 --&gt;</span>
子テンプレートのタイトルになる要素 {% endblock %} {% block sidebar %}
<span class="cm">&lt;!-- @section(&quot;sidebar&quot;) に相当 --&gt;</span>
{{ parent() }}
<span class="cm">&lt;!-- @parent に相当 --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンレプートのサイドバーに追加される要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock %} {% block content %}
<span class="cm">&lt;!-- @section(&quot;content&quot;) に相当 --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>子テンプレートのコンテンツになる要素<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></div>

  <hr>
<div class="md-source-file">
  <small>
    
      最終更新日:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-08-16</span>
      
    
  </small>
</div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            ページトップへ戻る
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/hiroki-it" target="_blank" rel="noopener" title="GitHubアカウント" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/Hiroki__IT" target="_blank" rel="noopener" title="Twitterアカウント" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.indexes", "navigation.prune", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>